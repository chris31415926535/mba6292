<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Building a Shiny App | Telfer 2020 Directed Reading: Natural Language Processing</title>
  <meta name="description" content="This is Christopher Belanger’s work product for the Telfer School of Management course MBA6292, Directed Readings in Natural Language Processing." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Building a Shiny App | Telfer 2020 Directed Reading: Natural Language Processing" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is Christopher Belanger’s work product for the Telfer School of Management course MBA6292, Directed Readings in Natural Language Processing." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Building a Shiny App | Telfer 2020 Directed Reading: Natural Language Processing" />
  
  <meta name="twitter:description" content="This is Christopher Belanger’s work product for the Telfer School of Management course MBA6292, Directed Readings in Natural Language Processing." />
  

<meta name="author" content="Christopher Belanger" />


<meta name="date" content="2020-12-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="beyond-the-mvp-support-vector-machine-classification.html"/>
<link rel="next" href="references-2.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MBA6292: Directed Readings in NLP</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html"><i class="fa fa-check"></i><b>3</b> Web Scraping Our Data</a><ul>
<li class="chapter" data-level="3.1" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#foreword-ethics"><i class="fa fa-check"></i><b>3.1</b> Foreword: Ethics</a></li>
<li class="chapter" data-level="3.2" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#the-general-idea"><i class="fa fa-check"></i><b>3.2</b> The General Idea</a></li>
<li class="chapter" data-level="3.3" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#goodreads-css-selectors"><i class="fa fa-check"></i><b>3.3</b> Goodreads: CSS Selectors</a><ul>
<li class="chapter" data-level="3.3.1" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-index"><i class="fa fa-check"></i><b>3.3.1</b> Scraping the Index</a></li>
<li class="chapter" data-level="3.3.2" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-content"><i class="fa fa-check"></i><b>3.3.2</b> Scraping the Content</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#yelp-embedded-json"><i class="fa fa-check"></i><b>3.4</b> Yelp: Embedded JSON</a><ul>
<li class="chapter" data-level="3.4.1" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-index-1"><i class="fa fa-check"></i><b>3.4.1</b> Scraping the Index</a></li>
<li class="chapter" data-level="3.4.2" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-content-1"><i class="fa fa-check"></i><b>3.4.2</b> Scraping the Content</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#mec-reverse-engineering-client-side-api-calls"><i class="fa fa-check"></i><b>3.5</b> MEC: Reverse-Engineering Client-Side API Calls</a><ul>
<li class="chapter" data-level="3.5.1" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-index-2"><i class="fa fa-check"></i><b>3.5.1</b> Scraping the Index</a></li>
<li class="chapter" data-level="3.5.2" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#functions-for-api-calls"><i class="fa fa-check"></i><b>3.5.2</b> Functions for API Calls</a></li>
<li class="chapter" data-level="3.5.3" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-content-2"><i class="fa fa-check"></i><b>3.5.3</b> Scraping the Content</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#summary"><i class="fa fa-check"></i><b>3.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html"><i class="fa fa-check"></i><b>4</b> Data Summary, EDA, &amp; Initial Model Attempts</a><ul>
<li class="chapter" data-level="4.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#goodreads"><i class="fa fa-check"></i><b>4.2</b> Goodreads</a><ul>
<li class="chapter" data-level="4.2.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#star-ratings"><i class="fa fa-check"></i><b>4.2.1</b> Star Ratings</a></li>
<li class="chapter" data-level="4.2.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#word-count"><i class="fa fa-check"></i><b>4.2.2</b> Word Count</a></li>
<li class="chapter" data-level="4.2.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#reviewers"><i class="fa fa-check"></i><b>4.2.3</b> Reviewers</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#yelp"><i class="fa fa-check"></i><b>4.3</b> Yelp</a><ul>
<li class="chapter" data-level="4.3.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#star-ratings-1"><i class="fa fa-check"></i><b>4.3.1</b> Star Ratings</a></li>
<li class="chapter" data-level="4.3.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#word-count-1"><i class="fa fa-check"></i><b>4.3.2</b> Word Count</a></li>
<li class="chapter" data-level="4.3.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#reviewers-1"><i class="fa fa-check"></i><b>4.3.3</b> Reviewers</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#mountain-equipment-co-op-mec"><i class="fa fa-check"></i><b>4.4</b> Mountain Equipment Co-op (MEC)</a><ul>
<li class="chapter" data-level="4.4.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#star-ratings-2"><i class="fa fa-check"></i><b>4.4.1</b> Star Ratings</a></li>
<li class="chapter" data-level="4.4.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#word-counts"><i class="fa fa-check"></i><b>4.4.2</b> Word Counts</a></li>
<li class="chapter" data-level="4.4.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#reviewers-2"><i class="fa fa-check"></i><b>4.4.3</b> Reviewers</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#comparing-goodreads-mec-and-yelp"><i class="fa fa-check"></i><b>4.5</b> Comparing Goodreads, MEC, and Yelp</a><ul>
<li class="chapter" data-level="4.5.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#star-ratings-3"><i class="fa fa-check"></i><b>4.5.1</b> Star Ratings</a></li>
<li class="chapter" data-level="4.5.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#word-counts-1"><i class="fa fa-check"></i><b>4.5.2</b> Word Counts</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#reviews-over-time"><i class="fa fa-check"></i><b>4.6</b> Reviews Over Time</a><ul>
<li class="chapter" data-level="4.6.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#goodreads-1"><i class="fa fa-check"></i><b>4.6.1</b> Goodreads</a></li>
<li class="chapter" data-level="4.6.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#yelp-1"><i class="fa fa-check"></i><b>4.6.2</b> Yelp</a></li>
<li class="chapter" data-level="4.6.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#mec"><i class="fa fa-check"></i><b>4.6.3</b> MEC</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#proposed-next-steps"><i class="fa fa-check"></i><b>4.7</b> Proposed Next Steps</a></li>
<li class="chapter" data-level="4.8" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#sessioninfo"><i class="fa fa-check"></i><b>4.8</b> SessionInfo</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html"><i class="fa fa-check"></i><b>5</b> A First LASSO Attempt</a><ul>
<li class="chapter" data-level="5.1" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#introduction-1"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#a-first-regression-yelp-data"><i class="fa fa-check"></i><b>5.2</b> A First Regression: Yelp Data</a><ul>
<li class="chapter" data-level="5.2.1" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#splitting-the-data"><i class="fa fa-check"></i><b>5.2.1</b> Splitting the data</a></li>
<li class="chapter" data-level="5.2.2" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#evaluating-the-first-model"><i class="fa fa-check"></i><b>5.2.2</b> Evaluating the first model</a></li>
<li class="chapter" data-level="5.2.3" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#tuning-model-parameters"><i class="fa fa-check"></i><b>5.2.3</b> Tuning model parameters</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#trying-lasso-again"><i class="fa fa-check"></i><b>5.3</b> Trying lasso again</a><ul>
<li class="chapter" data-level="5.3.1" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#with-1000-tokens"><i class="fa fa-check"></i><b>5.3.1</b> With 1000 tokens</a></li>
<li class="chapter" data-level="5.3.2" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#short-reviews-only-125-words"><i class="fa fa-check"></i><b>5.3.2</b> Short reviews only: &lt;125 words</a></li>
<li class="chapter" data-level="5.3.3" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#longer-reviews-125-words"><i class="fa fa-check"></i><b>5.3.3</b> Longer reviews &gt; 125 words</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#removing-stop-words"><i class="fa fa-check"></i><b>5.4</b> Removing stop words</a></li>
<li class="chapter" data-level="5.5" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#adjusting-n-grams"><i class="fa fa-check"></i><b>5.5</b> Adjusting n-grams</a></li>
<li class="chapter" data-level="5.6" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#full-final-regression"><i class="fa fa-check"></i><b>5.6</b> Full final regression</a></li>
<li class="chapter" data-level="5.7" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#conclusion"><i class="fa fa-check"></i><b>5.7</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html"><i class="fa fa-check"></i><b>6</b> Yelp Classification and Sentiment Test</a><ul>
<li class="chapter" data-level="6.1" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#yelp-dataset"><i class="fa fa-check"></i><b>6.1</b> Yelp Dataset</a><ul>
<li class="chapter" data-level="6.1.1" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#afinn"><i class="fa fa-check"></i><b>6.1.1</b> AFINN</a></li>
<li class="chapter" data-level="6.1.2" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#classification-naive-bayes-classifier"><i class="fa fa-check"></i><b>6.1.2</b> Classification: Naive Bayes Classifier</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#kaggle-yelp-dataset"><i class="fa fa-check"></i><b>6.2</b> Kaggle Yelp dataset</a><ul>
<li class="chapter" data-level="6.2.1" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#naive-bayes-classifier"><i class="fa fa-check"></i><b>6.2.1</b> Naive Bayes Classifier</a></li>
<li class="chapter" data-level="6.2.2" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#logistic-regression"><i class="fa fa-check"></i><b>6.2.2</b> Logistic Regression</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#next-steps"><i class="fa fa-check"></i><b>6.3</b> NEXT STEPS</a></li>
<li class="chapter" data-level="6.4" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#sessioninfo-1"><i class="fa fa-check"></i><b>6.4</b> SessionInfo</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><i class="fa fa-check"></i><b>7</b> The MVP: Classification Accuracy as a Function of Review Length and Volume</a><ul>
<li class="chapter" data-level="7.1" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#introduction-2"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#preparing-the-data"><i class="fa fa-check"></i><b>7.2</b> Preparing the Data</a></li>
<li class="chapter" data-level="7.3" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#experiment-1-logistic-regression-on-globally-balanced-data"><i class="fa fa-check"></i><b>7.3</b> Experiment 1: Logistic Regression on Globally Balanced Data</a></li>
<li class="chapter" data-level="7.4" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#experiment-2-logistic-regression-on-micro-balanced-data"><i class="fa fa-check"></i><b>7.4</b> Experiment 2: Logistic Regression on Micro-Balanced Data</a></li>
<li class="chapter" data-level="7.5" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#conclusions"><i class="fa fa-check"></i><b>7.5</b> Conclusions</a></li>
<li class="chapter" data-level="7.6" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#next-steps-1"><i class="fa fa-check"></i><b>7.6</b> Next Steps</a></li>
<li class="chapter" data-level="7.7" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#sessioninfo-2"><i class="fa fa-check"></i><b>7.7</b> SessionInfo</a></li>
<li class="chapter" data-level="7.8" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#references"><i class="fa fa-check"></i><b>7.8</b> References</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html"><i class="fa fa-check"></i><b>8</b> Beyond the MVP: Looking at Longer Reviews</a><ul>
<li class="chapter" data-level="8.1" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#introduction-3"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#results-from-the-previous-section"><i class="fa fa-check"></i><b>8.2</b> Results from the Previous Section</a></li>
<li class="chapter" data-level="8.3" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#finding-misclassified-reviews"><i class="fa fa-check"></i><b>8.3</b> Finding Misclassified Reviews</a></li>
<li class="chapter" data-level="8.4" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#qualitative-analysis-of-misclassified-reviews"><i class="fa fa-check"></i><b>8.4</b> Qualitative Analysis of Misclassified Reviews</a></li>
<li class="chapter" data-level="8.5" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#negations"><i class="fa fa-check"></i><b>8.5</b> Negations</a><ul>
<li class="chapter" data-level="8.5.1" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#negations-and-prediction-accuracy"><i class="fa fa-check"></i><b>8.5.1</b> Negations and Prediction Accuracy</a></li>
<li class="chapter" data-level="8.5.2" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#negations-and-word-length"><i class="fa fa-check"></i><b>8.5.2</b> Negations and Word Length</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#readability"><i class="fa fa-check"></i><b>8.6</b> Readability</a></li>
<li class="chapter" data-level="8.7" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#summing-up-so-far"><i class="fa fa-check"></i><b>8.7</b> Summing Up So Far</a></li>
<li class="chapter" data-level="8.8" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#logistic-regression-on-afinn-negators"><i class="fa fa-check"></i><b>8.8</b> Logistic Regression on AFINN + negators</a></li>
<li class="chapter" data-level="8.9" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#logistic-regression-on-mean-afinn-negators"><i class="fa fa-check"></i><b>8.9</b> Logistic Regression on Mean AFINN + negators</a></li>
<li class="chapter" data-level="8.10" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#comparing-models-multiple-trials"><i class="fa fa-check"></i><b>8.10</b> Comparing Models: Multiple Trials</a></li>
<li class="chapter" data-level="8.11" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#re-running-the-big-analysis"><i class="fa fa-check"></i><b>8.11</b> Re-Running the Big Analysis</a></li>
<li class="chapter" data-level="8.12" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#conclusion-1"><i class="fa fa-check"></i><b>8.12</b> Conclusion</a></li>
<li class="chapter" data-level="8.13" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#sessioninfo-3"><i class="fa fa-check"></i><b>8.13</b> SessionInfo</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html"><i class="fa fa-check"></i><b>9</b> Beyond the MVP: Support Vector Machine Classification</a><ul>
<li class="chapter" data-level="9.1" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#introduction-4"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#svm-classifiers"><i class="fa fa-check"></i><b>9.2</b> SVM Classifiers</a></li>
<li class="chapter" data-level="9.3" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#preparing-the-data-1"><i class="fa fa-check"></i><b>9.3</b> Preparing the Data</a></li>
<li class="chapter" data-level="9.4" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#svm-classification"><i class="fa fa-check"></i><b>9.4</b> SVM Classification</a></li>
<li class="chapter" data-level="9.5" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#predicting-with-last_fit"><i class="fa fa-check"></i><b>9.5</b> Predicting with <code>last_fit()</code></a></li>
<li class="chapter" data-level="9.6" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#fitting-and-predicting-using-fit"><i class="fa fa-check"></i><b>9.6</b> Fitting and Predicting Using <code>fit()</code></a></li>
<li class="chapter" data-level="9.7" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#conclusions-1"><i class="fa fa-check"></i><b>9.7</b> Conclusions</a></li>
<li class="chapter" data-level="9.8" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#sessioninfo-4"><i class="fa fa-check"></i><b>9.8</b> SessionInfo</a></li>
<li class="chapter" data-level="9.9" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#references-1"><i class="fa fa-check"></i><b>9.9</b> References</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="building-a-shiny-app.html"><a href="building-a-shiny-app.html"><i class="fa fa-check"></i><b>10</b> Building a Shiny App</a><ul>
<li class="chapter" data-level="10.1" data-path="building-a-shiny-app.html"><a href="building-a-shiny-app.html#the-app"><i class="fa fa-check"></i><b>10.1</b> The App!</a></li>
<li class="chapter" data-level="10.2" data-path="building-a-shiny-app.html"><a href="building-a-shiny-app.html#exporting-our-models"><i class="fa fa-check"></i><b>10.2</b> Exporting Our Models</a></li>
<li class="chapter" data-level="10.3" data-path="building-a-shiny-app.html"><a href="building-a-shiny-app.html#prepping-and-testing-our-models"><i class="fa fa-check"></i><b>10.3</b> Prepping and Testing Our Models</a></li>
<li class="chapter" data-level="10.4" data-path="building-a-shiny-app.html"><a href="building-a-shiny-app.html#saving-the-data"><i class="fa fa-check"></i><b>10.4</b> Saving the Data</a></li>
<li class="chapter" data-level="10.5" data-path="building-a-shiny-app.html"><a href="building-a-shiny-app.html#the-logic-of-the-app"><i class="fa fa-check"></i><b>10.5</b> The Logic of the App</a></li>
<li class="chapter" data-level="10.6" data-path="building-a-shiny-app.html"><a href="building-a-shiny-app.html#putting-it-all-together"><i class="fa fa-check"></i><b>10.6</b> Putting it All Together</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-2.html"><a href="references-2.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Telfer 2020 Directed Reading: Natural Language Processing</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="building-a-shiny-app" class="section level1">
<h1><span class="header-section-number">Chapter 10</span> Building a Shiny App</h1>
<div id="the-app" class="section level2">
<h2><span class="header-section-number">10.1</span> The App!</h2>
<p>Let’s start with the fun stuff: the completed app. If the app doesn’t load in the window below, <a href="https://chris31415926535.shinyapps.io/11-shiny-app/">see it in action at this link.</a></p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="building-a-shiny-app.html#cb310-1"></a>knitr<span class="op">::</span><span class="kw">include_app</span>(<span class="dt">url=</span><span class="st">&quot;https://chris31415926535.shinyapps.io/11-shiny-app/&quot;</span>, <span class="dt">height =</span> <span class="st">&quot;600px&quot;</span>)</span></code></pre></div>
<iframe src="https://chris31415926535.shinyapps.io/11-shiny-app/?showcase=0" width="672" height="600px">
</iframe>
</div>
<div id="exporting-our-models" class="section level2">
<h2><span class="header-section-number">10.2</span> Exporting Our Models</h2>
<p>To start, we’ll train the model on the <em>full</em> balanced Yelp dataset of ~211k reviews. Recall that we broke input data into five quantiles and fit a logistic regression on each quantile. Then we’ll save the information we need to run this model in an app, namely the logistic regression coefficients and the quantile boundaries in word numbers.</p>
<p>But the model objects that we get from <code>glm</code> are enormous! Their size in memory is approximately 282 megabytes.</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="building-a-shiny-app.html#cb311-1"></a><span class="co"># create and extract a list of 5 models, one for each quintile</span></span>
<span id="cb311-2"><a href="building-a-shiny-app.html#cb311-2"></a>models &lt;-<span class="st"> </span>yelp_data <span class="op">%&gt;%</span></span>
<span id="cb311-3"><a href="building-a-shiny-app.html#cb311-3"></a><span class="st">  </span><span class="kw">group_by</span>(qtile) <span class="op">%&gt;%</span></span>
<span id="cb311-4"><a href="building-a-shiny-app.html#cb311-4"></a><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></span>
<span id="cb311-5"><a href="building-a-shiny-app.html#cb311-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">logit =</span> purrr<span class="op">::</span><span class="kw">map</span>(data, glm, </span>
<span id="cb311-6"><a href="building-a-shiny-app.html#cb311-6"></a>                     <span class="dt">formula =</span> rating_factor <span class="op">~</span><span class="st"> </span>afinn_mean <span class="op">+</span><span class="st"> </span>buts_nots,</span>
<span id="cb311-7"><a href="building-a-shiny-app.html#cb311-7"></a>                     <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb311-8"><a href="building-a-shiny-app.html#cb311-8"></a><span class="st">  </span><span class="kw">select</span>(qtile, logit) <span class="op">%&gt;%</span></span>
<span id="cb311-9"><a href="building-a-shiny-app.html#cb311-9"></a><span class="st">  </span><span class="kw">arrange</span>(qtile)</span></code></pre></div>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="building-a-shiny-app.html#cb312-1"></a><span class="kw">object.size</span>(models) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">format</span>(<span class="dt">units =</span> <span class="st">&quot;Kb&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;276215.9 Kb&quot;</code></pre>
<p>And according to <a href="https://blogs.oracle.com/r/is-the-size-of-your-lm-model-causing-you-headaches">this link</a>, it’s actually the <em>even larger</em> serialized size that matters. Either way that’s way too big, since all we actually need is some numeric coefficients.</p>
<p>The <code>glm</code> objects have a bunch of extra baggage in them including the entire dataset used to create the model and the residuals. I tried setting a lot of model pieces to <code>NULL</code> to get the size down, but I couldn’t get the 5 model objects below about 20 megs.</p>
<p>But all we need is the coefficients, so let’s try extracting those. Since we’ve <code>arranged()</code> the models by quantile, we can extract the coefficients into an ordered list.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="building-a-shiny-app.html#cb314-1"></a>model_coefs &lt;-<span class="st"> </span>models <span class="op">%&gt;%</span></span>
<span id="cb314-2"><a href="building-a-shiny-app.html#cb314-2"></a><span class="st">  </span><span class="kw">pull</span>(logit) <span class="op">%&gt;%</span></span>
<span id="cb314-3"><a href="building-a-shiny-app.html#cb314-3"></a><span class="st">  </span>purrr<span class="op">::</span><span class="kw">map</span>(coefficients)</span>
<span id="cb314-4"><a href="building-a-shiny-app.html#cb314-4"></a></span>
<span id="cb314-5"><a href="building-a-shiny-app.html#cb314-5"></a>model_coefs <span class="op">%&gt;%</span></span>
<span id="cb314-6"><a href="building-a-shiny-app.html#cb314-6"></a><span class="st">  </span><span class="kw">object.size</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">format</span>(<span class="dt">units =</span> <span class="st">&quot;Kb&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2.4 Kb&quot;</code></pre>
<p>This fits into about 2.4 Kb, for a compression ratio of roughly 8.688855310^{-6}.</p>
</div>
<div id="prepping-and-testing-our-models" class="section level2">
<h2><span class="header-section-number">10.3</span> Prepping and Testing Our Models</h2>
<p>Of course then to use these coefficients we need to put them into the right equation. A quick trip to <a href="https://en.wikipedia.org/wiki/Logistic_regression">the Wikipedia page for logistic regression</a> will remind us that, in this case, the probability that a text input has classification “POS” is:</p>
<p><span class="math inline">\(P = \frac{1}{1 + e^{-(\beta_0 + \beta_1x_1 + \beta_2x_2 )}}\)</span></p>
<p>So we can define a function to get this probability given some prepared input data and a named vector of coefficients:</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="building-a-shiny-app.html#cb316-1"></a><span class="co"># function to get probability of classification</span></span>
<span id="cb316-2"><a href="building-a-shiny-app.html#cb316-2"></a>get_prob &lt;-<span class="st"> </span><span class="cf">function</span> (input_data, coefs){</span>
<span id="cb316-3"><a href="building-a-shiny-app.html#cb316-3"></a>  </span>
<span id="cb316-4"><a href="building-a-shiny-app.html#cb316-4"></a>  <span class="co"># first get log odds</span></span>
<span id="cb316-5"><a href="building-a-shiny-app.html#cb316-5"></a>  log_odds &lt;-<span class="st"> </span>coefs[<span class="st">&quot;(Intercept)&quot;</span>] <span class="op">+</span><span class="st"> </span>coefs[<span class="st">&quot;afinn_mean&quot;</span>] <span class="op">*</span><span class="st"> </span>input_data<span class="op">$</span>afinn_mean <span class="op">+</span><span class="st"> </span>coefs[<span class="st">&quot;buts_nots&quot;</span>] <span class="op">*</span><span class="st"> </span>input_data<span class="op">$</span>buts_nots <span class="op">%&gt;%</span></span>
<span id="cb316-6"><a href="building-a-shiny-app.html#cb316-6"></a><span class="st">    </span><span class="kw">unname</span>()</span>
<span id="cb316-7"><a href="building-a-shiny-app.html#cb316-7"></a>  </span>
<span id="cb316-8"><a href="building-a-shiny-app.html#cb316-8"></a>  <span class="co"># then get prob</span></span>
<span id="cb316-9"><a href="building-a-shiny-app.html#cb316-9"></a>  prob &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>log_odds)) <span class="op">%&gt;%</span></span>
<span id="cb316-10"><a href="building-a-shiny-app.html#cb316-10"></a><span class="st">    </span><span class="kw">unname</span>()</span>
<span id="cb316-11"><a href="building-a-shiny-app.html#cb316-11"></a>  </span>
<span id="cb316-12"><a href="building-a-shiny-app.html#cb316-12"></a>  <span class="kw">return</span> (prob)</span>
<span id="cb316-13"><a href="building-a-shiny-app.html#cb316-13"></a>}</span></code></pre></div>
<p>Before we can test <code>get_prob()</code>, we need to define a helper function to prepare some input text by calculating its mean AFINN score and the number of buts and nots.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="building-a-shiny-app.html#cb317-1"></a><span class="co"># function to prepare a text vector and return a prepared tibble with afinn_mean and buts_nots</span></span>
<span id="cb317-2"><a href="building-a-shiny-app.html#cb317-2"></a>prepare &lt;-<span class="st"> </span><span class="cf">function</span>(text) {</span>
<span id="cb317-3"><a href="building-a-shiny-app.html#cb317-3"></a>  input_data &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">text =</span> text) </span>
<span id="cb317-4"><a href="building-a-shiny-app.html#cb317-4"></a>  </span>
<span id="cb317-5"><a href="building-a-shiny-app.html#cb317-5"></a>  input_data &lt;-<span class="st"> </span>input_data <span class="op">%&gt;%</span></span>
<span id="cb317-6"><a href="building-a-shiny-app.html#cb317-6"></a><span class="st">    </span>tidytext<span class="op">::</span><span class="kw">unnest_tokens</span>(<span class="dt">output =</span> word, <span class="dt">input =</span> text) <span class="op">%&gt;%</span></span>
<span id="cb317-7"><a href="building-a-shiny-app.html#cb317-7"></a><span class="st">    </span><span class="kw">left_join</span>(afinn, <span class="dt">by=</span><span class="st">&quot;word&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb317-8"><a href="building-a-shiny-app.html#cb317-8"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">afinn_mean =</span> <span class="kw">mean</span>(value, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span></span>
<span id="cb317-9"><a href="building-a-shiny-app.html#cb317-9"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">afinn_mean =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(afinn_mean) <span class="op">|</span><span class="st"> </span><span class="kw">is.nan</span>(afinn_mean), <span class="dv">0</span>, afinn_mean)) <span class="op">%&gt;%</span></span>
<span id="cb317-10"><a href="building-a-shiny-app.html#cb317-10"></a><span class="st">    </span><span class="kw">bind_cols</span>(input_data) <span class="op">%&gt;%</span></span>
<span id="cb317-11"><a href="building-a-shiny-app.html#cb317-11"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">buts =</span> stringr<span class="op">::</span><span class="kw">str_count</span>(text, <span class="st">&quot;but &quot;</span>),</span>
<span id="cb317-12"><a href="building-a-shiny-app.html#cb317-12"></a>           <span class="dt">nots =</span> stringr<span class="op">::</span><span class="kw">str_count</span>(text, <span class="st">&quot;not &quot;</span>),</span>
<span id="cb317-13"><a href="building-a-shiny-app.html#cb317-13"></a>           <span class="dt">buts_nots =</span> buts <span class="op">+</span><span class="st"> </span>nots)</span>
<span id="cb317-14"><a href="building-a-shiny-app.html#cb317-14"></a>  </span>
<span id="cb317-15"><a href="building-a-shiny-app.html#cb317-15"></a>  <span class="kw">return</span>(input_data)</span>
<span id="cb317-16"><a href="building-a-shiny-app.html#cb317-16"></a>}</span></code></pre></div>
<p>Now we can use our model to calculate the probability that a sample input text, say “I am happy,” is a positive review:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="building-a-shiny-app.html#cb318-1"></a><span class="kw">get_prob</span>(<span class="kw">prepare</span>(<span class="st">&quot;I am happy&quot;</span>), model_coefs[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## [1] 0.9520802</code></pre>
<p>95% seems good enough for me. As a check, we can calculate the same probability using our <code>glm</code> object and <code>predict()</code>:</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="building-a-shiny-app.html#cb320-1"></a>models<span class="op">$</span>logit[[<span class="dv">1</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">predict</span>(<span class="kw">prepare</span>(<span class="st">&quot;I am happy&quot;</span>),</span>
<span id="cb320-2"><a href="building-a-shiny-app.html#cb320-2"></a>                              <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb320-3"><a href="building-a-shiny-app.html#cb320-3"></a><span class="st">  </span><span class="kw">unname</span>()</span></code></pre></div>
<pre><code>## [1] 0.9520802</code></pre>
<p>We get the exact same result down to 7 decimal points, so we can be confident that we’ve set up the equations right.</p>
<p>We also need to extract the quantile boundaries, so that we know which model to apply to a given input text:</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="building-a-shiny-app.html#cb322-1"></a><span class="co"># how many quantiles?</span></span>
<span id="cb322-2"><a href="building-a-shiny-app.html#cb322-2"></a>num_qtiles &lt;-<span class="st"> </span><span class="dv">5</span></span>
<span id="cb322-3"><a href="building-a-shiny-app.html#cb322-3"></a><span class="co"># get the limits of the word-quantiles for display purposes</span></span>
<span id="cb322-4"><a href="building-a-shiny-app.html#cb322-4"></a>qtiles &lt;-<span class="st"> </span><span class="kw">quantile</span>(yelp_data<span class="op">$</span>words, <span class="dt">probs =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, (<span class="dv">1</span><span class="op">/</span>num_qtiles)))</span>
<span id="cb322-5"><a href="building-a-shiny-app.html#cb322-5"></a></span>
<span id="cb322-6"><a href="building-a-shiny-app.html#cb322-6"></a>qtiles</span></code></pre></div>
<pre><code>##   0%  20%  40%  60%  80% 100% 
##    1   39   65  102  169 1033</code></pre>
</div>
<div id="saving-the-data" class="section level2">
<h2><span class="header-section-number">10.4</span> Saving the Data</h2>
<p>Now we can save all of these values to file so we can load them and use them later. The final file size is about 13 kilobytes.</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="building-a-shiny-app.html#cb324-1"></a><span class="co"># save the models and quantile boundaries</span></span>
<span id="cb324-2"><a href="building-a-shiny-app.html#cb324-2"></a></span>
<span id="cb324-3"><a href="building-a-shiny-app.html#cb324-3"></a><span class="co">#save(list = c(&quot;model_coefs&quot;,&quot;qtiles&quot;), file = &quot;model_specs.Rdata&quot;)</span></span></code></pre></div>
</div>
<div id="the-logic-of-the-app" class="section level2">
<h2><span class="header-section-number">10.5</span> The Logic of the App</h2>
<p>The app should have two inputs:</p>
<ul>
<li>A text box for entering a review.</li>
<li>A button that says something like “Predict”.</li>
</ul>
<p>When the user pushes the button, the app should do the following:</p>
<ul>
<li>Take the text in the input box.</li>
<li><code>prepare()</code> it using our function.</li>
<li>Figure out which model applies (i.e. how many words is it, which quantile does it fall into).</li>
<li>Use the right model to predict the probability of a <code>POS</code> review.</li>
<li>Display the probability, and either <code>POS</code> or <code>NEG</code> depending on whether <span class="math inline">\(p&gt;0.5\)</span>.</li>
</ul>
<p>Let’s define a function to get a text’s quintile:</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="building-a-shiny-app.html#cb325-1"></a><span class="co"># function to get quintile</span></span>
<span id="cb325-2"><a href="building-a-shiny-app.html#cb325-2"></a>get_qtile &lt;-<span class="st"> </span><span class="cf">function</span>(text, <span class="dt">qtiles =</span> qtiles){</span>
<span id="cb325-3"><a href="building-a-shiny-app.html#cb325-3"></a>  <span class="co"># count words: count the number of spaces and add 1</span></span>
<span id="cb325-4"><a href="building-a-shiny-app.html#cb325-4"></a>  words &lt;-<span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_count</span>(text, <span class="st">&quot; &quot;</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb325-5"><a href="building-a-shiny-app.html#cb325-5"></a>  </span>
<span id="cb325-6"><a href="building-a-shiny-app.html#cb325-6"></a>  qtile &lt;-<span class="st"> </span><span class="kw">case_when</span>(</span>
<span id="cb325-7"><a href="building-a-shiny-app.html#cb325-7"></a>    words <span class="op">%in%</span><span class="st"> </span>qtiles[<span class="dv">1</span>]<span class="op">:</span>qtiles[<span class="dv">2</span>] <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb325-8"><a href="building-a-shiny-app.html#cb325-8"></a>    words <span class="op">%in%</span><span class="st"> </span>qtiles[<span class="dv">2</span>]<span class="op">:</span>qtiles[<span class="dv">3</span>] <span class="op">~</span><span class="st"> </span><span class="dv">2</span>,</span>
<span id="cb325-9"><a href="building-a-shiny-app.html#cb325-9"></a>    words <span class="op">%in%</span><span class="st"> </span>qtiles[<span class="dv">3</span>]<span class="op">:</span>qtiles[<span class="dv">4</span>] <span class="op">~</span><span class="st"> </span><span class="dv">3</span>,</span>
<span id="cb325-10"><a href="building-a-shiny-app.html#cb325-10"></a>    words <span class="op">%in%</span><span class="st"> </span>qtiles[<span class="dv">4</span>]<span class="op">:</span>qtiles[<span class="dv">5</span>] <span class="op">~</span><span class="st"> </span><span class="dv">4</span>,</span>
<span id="cb325-11"><a href="building-a-shiny-app.html#cb325-11"></a>    words <span class="op">&gt;</span><span class="st"> </span>qtiles[<span class="dv">5</span>] <span class="op">~</span><span class="st"> </span><span class="dv">5</span></span>
<span id="cb325-12"><a href="building-a-shiny-app.html#cb325-12"></a>  )  </span>
<span id="cb325-13"><a href="building-a-shiny-app.html#cb325-13"></a>  </span>
<span id="cb325-14"><a href="building-a-shiny-app.html#cb325-14"></a>  <span class="kw">return</span>(qtile)</span>
<span id="cb325-15"><a href="building-a-shiny-app.html#cb325-15"></a>}</span></code></pre></div>
<p>And a function that pulls it all together to predict the probability that a given review is positive:</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="building-a-shiny-app.html#cb326-1"></a>prob_text &lt;-<span class="st"> </span><span class="cf">function</span>(text, model_coefs, qtiles){</span>
<span id="cb326-2"><a href="building-a-shiny-app.html#cb326-2"></a>  <span class="co"># get quintile for text based on word length  </span></span>
<span id="cb326-3"><a href="building-a-shiny-app.html#cb326-3"></a>  qtile &lt;-<span class="st"> </span><span class="kw">get_qtile</span>(text, <span class="dt">qtiles =</span> qtiles)</span>
<span id="cb326-4"><a href="building-a-shiny-app.html#cb326-4"></a>  </span>
<span id="cb326-5"><a href="building-a-shiny-app.html#cb326-5"></a>  <span class="co"># prepare the text by getting afinn sentiment and counting buts/nots</span></span>
<span id="cb326-6"><a href="building-a-shiny-app.html#cb326-6"></a>  prepped_text &lt;-<span class="st"> </span><span class="kw">prepare</span>(text)</span>
<span id="cb326-7"><a href="building-a-shiny-app.html#cb326-7"></a>  </span>
<span id="cb326-8"><a href="building-a-shiny-app.html#cb326-8"></a>  <span class="co"># get the probability this text is positive</span></span>
<span id="cb326-9"><a href="building-a-shiny-app.html#cb326-9"></a>  prob &lt;-<span class="st"> </span><span class="kw">get_prob</span>(prepped_text, model_coefs[[qtile]])</span>
<span id="cb326-10"><a href="building-a-shiny-app.html#cb326-10"></a>  </span>
<span id="cb326-11"><a href="building-a-shiny-app.html#cb326-11"></a>  <span class="co"># return the probability</span></span>
<span id="cb326-12"><a href="building-a-shiny-app.html#cb326-12"></a>  <span class="kw">return</span>(prob)</span>
<span id="cb326-13"><a href="building-a-shiny-app.html#cb326-13"></a>}</span></code></pre></div>
<p>Let’s test:</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="building-a-shiny-app.html#cb327-1"></a>user_text &lt;-<span class="st"> &quot;I am happy.&quot;</span></span>
<span id="cb327-2"><a href="building-a-shiny-app.html#cb327-2"></a><span class="kw">prob_text</span>(user_text, model_coefs, qtiles)</span></code></pre></div>
<pre><code>## [1] 0.9520802</code></pre>
<p>And one with some negative words and a negator:</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="building-a-shiny-app.html#cb329-1"></a>user_text &lt;-<span class="st"> &quot;I am not happy, this place sucks.&quot;</span></span>
<span id="cb329-2"><a href="building-a-shiny-app.html#cb329-2"></a><span class="kw">prob_text</span>(user_text, model_coefs, qtiles)</span></code></pre></div>
<pre><code>## [1] 0.1634059</code></pre>
<p>And let’s make another very simple function that returns POS or NEG based on the probability. In practice it will give POS if the probability is &gt;50%, but in principle we could set the threshold anywhere depending on our cost function. We’ll test this function with the same negative review we just used.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="building-a-shiny-app.html#cb331-1"></a>pred_text &lt;-<span class="st"> </span><span class="cf">function</span>(prob, <span class="dt">threshold =</span> <span class="fl">0.5</span>){</span>
<span id="cb331-2"><a href="building-a-shiny-app.html#cb331-2"></a>    <span class="cf">if</span> (prob <span class="op">&gt;=</span><span class="st"> </span>threshold) result &lt;-<span class="st"> &quot;POS&quot;</span></span>
<span id="cb331-3"><a href="building-a-shiny-app.html#cb331-3"></a>    <span class="cf">if</span> (prob <span class="op">&lt;=</span><span class="st"> </span>threshold) result &lt;-<span class="st"> &quot;NEG&quot;</span></span>
<span id="cb331-4"><a href="building-a-shiny-app.html#cb331-4"></a>  <span class="kw">return</span> (result)</span>
<span id="cb331-5"><a href="building-a-shiny-app.html#cb331-5"></a>}</span>
<span id="cb331-6"><a href="building-a-shiny-app.html#cb331-6"></a></span>
<span id="cb331-7"><a href="building-a-shiny-app.html#cb331-7"></a><span class="kw">prob_text</span>(user_text, model_coefs, qtiles) <span class="op">%&gt;%</span></span>
<span id="cb331-8"><a href="building-a-shiny-app.html#cb331-8"></a><span class="st">  </span><span class="kw">pred_text</span>()</span></code></pre></div>
<pre><code>## [1] &quot;NEG&quot;</code></pre>
</div>
<div id="putting-it-all-together" class="section level2">
<h2><span class="header-section-number">10.6</span> Putting it All Together</h2>
<p>Now that we have our logic and basic design, the next step is to build and deploy the Shiny app. This is easier to show than it is to tell, so please check out:</p>
<ul>
<li><a href="https://chris31415926535.shinyapps.io/11-shiny-app/">The deployed app here on Shinyapps.io</a></li>
<li><a href="https://github.com/chris31415926535/yelp-shiny-app">The app code here on GitHub</a></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="beyond-the-mvp-support-vector-machine-classification.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references-2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/09-shiny-app.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["telfer-mba-nlp.pdf", "telfer-mba-nlp.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
