<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Beyond the MVP: Support Vector Machine Classification | Telfer 2020 Directed Reading: Natural Language Processing</title>
  <meta name="description" content="This is Christopher Belanger’s work product for the Telfer School of Management course MBA6292, Directed Readings in Natural Language Processing." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Beyond the MVP: Support Vector Machine Classification | Telfer 2020 Directed Reading: Natural Language Processing" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is Christopher Belanger’s work product for the Telfer School of Management course MBA6292, Directed Readings in Natural Language Processing." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Beyond the MVP: Support Vector Machine Classification | Telfer 2020 Directed Reading: Natural Language Processing" />
  
  <meta name="twitter:description" content="This is Christopher Belanger’s work product for the Telfer School of Management course MBA6292, Directed Readings in Natural Language Processing." />
  

<meta name="author" content="Christopher Belanger" />


<meta name="date" content="2020-12-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="beyond-the-mvp-looking-at-longer-reviews.html"/>
<link rel="next" href="building-a-shiny-app.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MBA6292: Directed Readings in NLP</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html"><i class="fa fa-check"></i><b>3</b> Web Scraping Our Data</a><ul>
<li class="chapter" data-level="3.1" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#foreword-ethics"><i class="fa fa-check"></i><b>3.1</b> Foreword: Ethics</a></li>
<li class="chapter" data-level="3.2" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#the-general-idea"><i class="fa fa-check"></i><b>3.2</b> The General Idea</a></li>
<li class="chapter" data-level="3.3" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#goodreads-css-selectors"><i class="fa fa-check"></i><b>3.3</b> Goodreads: CSS Selectors</a><ul>
<li class="chapter" data-level="3.3.1" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-index"><i class="fa fa-check"></i><b>3.3.1</b> Scraping the Index</a></li>
<li class="chapter" data-level="3.3.2" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-content"><i class="fa fa-check"></i><b>3.3.2</b> Scraping the Content</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#yelp-embedded-json"><i class="fa fa-check"></i><b>3.4</b> Yelp: Embedded JSON</a><ul>
<li class="chapter" data-level="3.4.1" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-index-1"><i class="fa fa-check"></i><b>3.4.1</b> Scraping the Index</a></li>
<li class="chapter" data-level="3.4.2" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-content-1"><i class="fa fa-check"></i><b>3.4.2</b> Scraping the Content</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#mec-reverse-engineering-client-side-api-calls"><i class="fa fa-check"></i><b>3.5</b> MEC: Reverse-Engineering Client-Side API Calls</a><ul>
<li class="chapter" data-level="3.5.1" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-index-2"><i class="fa fa-check"></i><b>3.5.1</b> Scraping the Index</a></li>
<li class="chapter" data-level="3.5.2" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#functions-for-api-calls"><i class="fa fa-check"></i><b>3.5.2</b> Functions for API Calls</a></li>
<li class="chapter" data-level="3.5.3" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-content-2"><i class="fa fa-check"></i><b>3.5.3</b> Scraping the Content</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#summary"><i class="fa fa-check"></i><b>3.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html"><i class="fa fa-check"></i><b>4</b> Data Summary, EDA, &amp; Initial Model Attempts</a><ul>
<li class="chapter" data-level="4.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#goodreads"><i class="fa fa-check"></i><b>4.2</b> Goodreads</a><ul>
<li class="chapter" data-level="4.2.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#star-ratings"><i class="fa fa-check"></i><b>4.2.1</b> Star Ratings</a></li>
<li class="chapter" data-level="4.2.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#word-count"><i class="fa fa-check"></i><b>4.2.2</b> Word Count</a></li>
<li class="chapter" data-level="4.2.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#reviewers"><i class="fa fa-check"></i><b>4.2.3</b> Reviewers</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#yelp"><i class="fa fa-check"></i><b>4.3</b> Yelp</a><ul>
<li class="chapter" data-level="4.3.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#star-ratings-1"><i class="fa fa-check"></i><b>4.3.1</b> Star Ratings</a></li>
<li class="chapter" data-level="4.3.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#word-count-1"><i class="fa fa-check"></i><b>4.3.2</b> Word Count</a></li>
<li class="chapter" data-level="4.3.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#reviewers-1"><i class="fa fa-check"></i><b>4.3.3</b> Reviewers</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#mountain-equipment-co-op-mec"><i class="fa fa-check"></i><b>4.4</b> Mountain Equipment Co-op (MEC)</a><ul>
<li class="chapter" data-level="4.4.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#star-ratings-2"><i class="fa fa-check"></i><b>4.4.1</b> Star Ratings</a></li>
<li class="chapter" data-level="4.4.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#word-counts"><i class="fa fa-check"></i><b>4.4.2</b> Word Counts</a></li>
<li class="chapter" data-level="4.4.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#reviewers-2"><i class="fa fa-check"></i><b>4.4.3</b> Reviewers</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#comparing-goodreads-mec-and-yelp"><i class="fa fa-check"></i><b>4.5</b> Comparing Goodreads, MEC, and Yelp</a><ul>
<li class="chapter" data-level="4.5.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#star-ratings-3"><i class="fa fa-check"></i><b>4.5.1</b> Star Ratings</a></li>
<li class="chapter" data-level="4.5.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#word-counts-1"><i class="fa fa-check"></i><b>4.5.2</b> Word Counts</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#reviews-over-time"><i class="fa fa-check"></i><b>4.6</b> Reviews Over Time</a><ul>
<li class="chapter" data-level="4.6.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#goodreads-1"><i class="fa fa-check"></i><b>4.6.1</b> Goodreads</a></li>
<li class="chapter" data-level="4.6.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#yelp-1"><i class="fa fa-check"></i><b>4.6.2</b> Yelp</a></li>
<li class="chapter" data-level="4.6.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#mec"><i class="fa fa-check"></i><b>4.6.3</b> MEC</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#proposed-next-steps"><i class="fa fa-check"></i><b>4.7</b> Proposed Next Steps</a></li>
<li class="chapter" data-level="4.8" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#sessioninfo"><i class="fa fa-check"></i><b>4.8</b> SessionInfo</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html"><i class="fa fa-check"></i><b>5</b> A First LASSO Attempt</a><ul>
<li class="chapter" data-level="5.1" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#introduction-1"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#a-first-regression-yelp-data"><i class="fa fa-check"></i><b>5.2</b> A First Regression: Yelp Data</a><ul>
<li class="chapter" data-level="5.2.1" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#splitting-the-data"><i class="fa fa-check"></i><b>5.2.1</b> Splitting the data</a></li>
<li class="chapter" data-level="5.2.2" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#evaluating-the-first-model"><i class="fa fa-check"></i><b>5.2.2</b> Evaluating the first model</a></li>
<li class="chapter" data-level="5.2.3" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#tuning-model-parameters"><i class="fa fa-check"></i><b>5.2.3</b> Tuning model parameters</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#trying-lasso-again"><i class="fa fa-check"></i><b>5.3</b> Trying lasso again</a><ul>
<li class="chapter" data-level="5.3.1" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#with-1000-tokens"><i class="fa fa-check"></i><b>5.3.1</b> With 1000 tokens</a></li>
<li class="chapter" data-level="5.3.2" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#short-reviews-only-125-words"><i class="fa fa-check"></i><b>5.3.2</b> Short reviews only: &lt;125 words</a></li>
<li class="chapter" data-level="5.3.3" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#longer-reviews-125-words"><i class="fa fa-check"></i><b>5.3.3</b> Longer reviews &gt; 125 words</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#removing-stop-words"><i class="fa fa-check"></i><b>5.4</b> Removing stop words</a></li>
<li class="chapter" data-level="5.5" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#adjusting-n-grams"><i class="fa fa-check"></i><b>5.5</b> Adjusting n-grams</a></li>
<li class="chapter" data-level="5.6" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#full-final-regression"><i class="fa fa-check"></i><b>5.6</b> Full final regression</a></li>
<li class="chapter" data-level="5.7" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#conclusion"><i class="fa fa-check"></i><b>5.7</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html"><i class="fa fa-check"></i><b>6</b> Yelp Classification and Sentiment Test</a><ul>
<li class="chapter" data-level="6.1" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#yelp-dataset"><i class="fa fa-check"></i><b>6.1</b> Yelp Dataset</a><ul>
<li class="chapter" data-level="6.1.1" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#afinn"><i class="fa fa-check"></i><b>6.1.1</b> AFINN</a></li>
<li class="chapter" data-level="6.1.2" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#classification-naive-bayes-classifier"><i class="fa fa-check"></i><b>6.1.2</b> Classification: Naive Bayes Classifier</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#kaggle-yelp-dataset"><i class="fa fa-check"></i><b>6.2</b> Kaggle Yelp dataset</a><ul>
<li class="chapter" data-level="6.2.1" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#naive-bayes-classifier"><i class="fa fa-check"></i><b>6.2.1</b> Naive Bayes Classifier</a></li>
<li class="chapter" data-level="6.2.2" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#logistic-regression"><i class="fa fa-check"></i><b>6.2.2</b> Logistic Regression</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#next-steps"><i class="fa fa-check"></i><b>6.3</b> NEXT STEPS</a></li>
<li class="chapter" data-level="6.4" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#sessioninfo-1"><i class="fa fa-check"></i><b>6.4</b> SessionInfo</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><i class="fa fa-check"></i><b>7</b> The MVP: Classification Accuracy as a Function of Review Length and Volume</a><ul>
<li class="chapter" data-level="7.1" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#introduction-2"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#preparing-the-data"><i class="fa fa-check"></i><b>7.2</b> Preparing the Data</a></li>
<li class="chapter" data-level="7.3" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#experiment-1-logistic-regression-on-globally-balanced-data"><i class="fa fa-check"></i><b>7.3</b> Experiment 1: Logistic Regression on Globally Balanced Data</a></li>
<li class="chapter" data-level="7.4" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#experiment-2-logistic-regression-on-micro-balanced-data"><i class="fa fa-check"></i><b>7.4</b> Experiment 2: Logistic Regression on Micro-Balanced Data</a></li>
<li class="chapter" data-level="7.5" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#conclusions"><i class="fa fa-check"></i><b>7.5</b> Conclusions</a></li>
<li class="chapter" data-level="7.6" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#next-steps-1"><i class="fa fa-check"></i><b>7.6</b> Next Steps</a></li>
<li class="chapter" data-level="7.7" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#sessioninfo-2"><i class="fa fa-check"></i><b>7.7</b> SessionInfo</a></li>
<li class="chapter" data-level="7.8" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#references"><i class="fa fa-check"></i><b>7.8</b> References</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html"><i class="fa fa-check"></i><b>8</b> Beyond the MVP: Looking at Longer Reviews</a><ul>
<li class="chapter" data-level="8.1" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#introduction-3"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#results-from-the-previous-section"><i class="fa fa-check"></i><b>8.2</b> Results from the Previous Section</a></li>
<li class="chapter" data-level="8.3" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#finding-misclassified-reviews"><i class="fa fa-check"></i><b>8.3</b> Finding Misclassified Reviews</a></li>
<li class="chapter" data-level="8.4" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#qualitative-analysis-of-misclassified-reviews"><i class="fa fa-check"></i><b>8.4</b> Qualitative Analysis of Misclassified Reviews</a></li>
<li class="chapter" data-level="8.5" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#negations"><i class="fa fa-check"></i><b>8.5</b> Negations</a><ul>
<li class="chapter" data-level="8.5.1" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#negations-and-prediction-accuracy"><i class="fa fa-check"></i><b>8.5.1</b> Negations and Prediction Accuracy</a></li>
<li class="chapter" data-level="8.5.2" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#negations-and-word-length"><i class="fa fa-check"></i><b>8.5.2</b> Negations and Word Length</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#readability"><i class="fa fa-check"></i><b>8.6</b> Readability</a></li>
<li class="chapter" data-level="8.7" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#summing-up-so-far"><i class="fa fa-check"></i><b>8.7</b> Summing Up So Far</a></li>
<li class="chapter" data-level="8.8" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#logistic-regression-on-afinn-negators"><i class="fa fa-check"></i><b>8.8</b> Logistic Regression on AFINN + negators</a></li>
<li class="chapter" data-level="8.9" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#logistic-regression-on-mean-afinn-negators"><i class="fa fa-check"></i><b>8.9</b> Logistic Regression on Mean AFINN + negators</a></li>
<li class="chapter" data-level="8.10" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#comparing-models-multiple-trials"><i class="fa fa-check"></i><b>8.10</b> Comparing Models: Multiple Trials</a></li>
<li class="chapter" data-level="8.11" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#re-running-the-big-analysis"><i class="fa fa-check"></i><b>8.11</b> Re-Running the Big Analysis</a></li>
<li class="chapter" data-level="8.12" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#conclusion-1"><i class="fa fa-check"></i><b>8.12</b> Conclusion</a></li>
<li class="chapter" data-level="8.13" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#sessioninfo-3"><i class="fa fa-check"></i><b>8.13</b> SessionInfo</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html"><i class="fa fa-check"></i><b>9</b> Beyond the MVP: Support Vector Machine Classification</a><ul>
<li class="chapter" data-level="9.1" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#introduction-4"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#svm-classifiers"><i class="fa fa-check"></i><b>9.2</b> SVM Classifiers</a></li>
<li class="chapter" data-level="9.3" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#preparing-the-data-1"><i class="fa fa-check"></i><b>9.3</b> Preparing the Data</a></li>
<li class="chapter" data-level="9.4" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#svm-classification"><i class="fa fa-check"></i><b>9.4</b> SVM Classification</a></li>
<li class="chapter" data-level="9.5" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#predicting-with-last_fit"><i class="fa fa-check"></i><b>9.5</b> Predicting with <code>last_fit()</code></a></li>
<li class="chapter" data-level="9.6" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#fitting-and-predicting-using-fit"><i class="fa fa-check"></i><b>9.6</b> Fitting and Predicting Using <code>fit()</code></a></li>
<li class="chapter" data-level="9.7" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#conclusions-1"><i class="fa fa-check"></i><b>9.7</b> Conclusions</a></li>
<li class="chapter" data-level="9.8" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#sessioninfo-4"><i class="fa fa-check"></i><b>9.8</b> SessionInfo</a></li>
<li class="chapter" data-level="9.9" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#references-1"><i class="fa fa-check"></i><b>9.9</b> References</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="building-a-shiny-app.html"><a href="building-a-shiny-app.html"><i class="fa fa-check"></i><b>10</b> Building a Shiny App</a><ul>
<li class="chapter" data-level="10.1" data-path="building-a-shiny-app.html"><a href="building-a-shiny-app.html#the-app"><i class="fa fa-check"></i><b>10.1</b> The App!</a></li>
<li class="chapter" data-level="10.2" data-path="building-a-shiny-app.html"><a href="building-a-shiny-app.html#exporting-our-models"><i class="fa fa-check"></i><b>10.2</b> Exporting Our Models</a></li>
<li class="chapter" data-level="10.3" data-path="building-a-shiny-app.html"><a href="building-a-shiny-app.html#prepping-and-testing-our-models"><i class="fa fa-check"></i><b>10.3</b> Prepping and Testing Our Models</a></li>
<li class="chapter" data-level="10.4" data-path="building-a-shiny-app.html"><a href="building-a-shiny-app.html#saving-the-data"><i class="fa fa-check"></i><b>10.4</b> Saving the Data</a></li>
<li class="chapter" data-level="10.5" data-path="building-a-shiny-app.html"><a href="building-a-shiny-app.html#the-logic-of-the-app"><i class="fa fa-check"></i><b>10.5</b> The Logic of the App</a></li>
<li class="chapter" data-level="10.6" data-path="building-a-shiny-app.html"><a href="building-a-shiny-app.html#putting-it-all-together"><i class="fa fa-check"></i><b>10.6</b> Putting it All Together</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-2.html"><a href="references-2.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Telfer 2020 Directed Reading: Natural Language Processing</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="beyond-the-mvp-support-vector-machine-classification" class="section level1">
<h1><span class="header-section-number">Chapter 9</span> Beyond the MVP: Support Vector Machine Classification</h1>
<div id="introduction-4" class="section level2">
<h2><span class="header-section-number">9.1</span> Introduction</h2>
<p>In this section, I will extend the minimum viable project (MVP) in the last section and build a <em>support vector machine</em> (SVM) classifier to predict Yelp reviews’ star ratings. This time, instead of just using AFINN sentiment as the model input, I’ll predict ratings based on each review’s text, its word length, and its AFINN sentiment. I will again be predicting positive (“POS”) and negative (“NEG”) ratings following <span class="citation">Liu (<a href="#ref-liu_sentiment_2015" role="doc-biblioref">2015</a>)</span>’s recommendation, and use the approaches outlined in <span class="citation">Silge and Hvitfeldt (<a href="#ref-silge_supervised_2020" role="doc-biblioref">2020</a>)</span> and <span class="citation">Silge and Robinson (<a href="#ref-silge_text_2020" role="doc-biblioref">2020</a>)</span>. In some cases I have used examples or hints from websites like Stack Overflow, and I’ve noted that where applicable.</p>
<p>Based on some initial experiments, after loading 200,000 Yelp reviews I will use an aggressive train/test split to use 5% of the data for model training and then test its performance on the other 95%. There are two reasons for this. The first reason is pragmatic: I have much more data than processing power, and 5% of the data amounts to 11,106 reviews which already takes nearly 20 minutes to run through an SVM on my machine. The second reason is optimistic: based on some earlier experiments, I have reason to think that roughly 10,000 reviews is enough to train a decent model, so I would like to seize on this huge dataset to do a really robust test.</p>
</div>
<div id="svm-classifiers" class="section level2">
<h2><span class="header-section-number">9.2</span> SVM Classifiers</h2>
<p>A support vector machine (SVM) classifier is a mathematical model that assigns observations to one of two classes. The mathematics are complicated, so here I will present a brief non-technical summary based on <span class="citation">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie_elements_2009" role="doc-biblioref">2009</a>)</span>’s exposition (pp. 417-438).</p>
<p>Imagine a dataset consisting of <span class="math inline">\(N\)</span> pairs <span class="math inline">\((x_1,y_1),(x_2,y_2),\ldots,(x_N,y_N)\)</span>, where the <span class="math inline">\(x_i\in\mathbb{R}^p\)</span> and the <span class="math inline">\(y_i\in\{-1,1\}\)</span>. In other words, our observations are situated somewhere in a <span class="math inline">\(p\)</span>-dimensional Euclidean space with coordinates <span class="math inline">\(x_i\)</span>, and also belong to one of two classes given by <span class="math inline">\(y_i\)</span>. Intuitively, we could set <span class="math inline">\(p=2\)</span> and imagine throwing a handful of pennies onto a tabletop: each penny has some position on the tabletop that we could label <span class="math inline">\(x_i\)</span>, and each penny is either heads or tails, which we could label <span class="math inline">\(y_i\)</span>.</p>
<p>For our tabletop example, if we’re lucky we might be able to draw a straight line separating all the heads and tails. In more general cases we may be able to define a hyperplane that separates all instances of the two classes. We can call these situations “separable,” and the general approach here is to find the hyperplane that divides the two classes with the widest margin <span class="math inline">\(M\)</span> possible on both sides.</p>
<p>In other cases, however, there might be some heads mixed in with the tails, so it may be impossible to draw a straight line or hyperplane that cleanly separates the two classes. If so, we can generalize our approach to permit some misclassifications. The problem then is to find the hyperplane that minimizes the number and degree of misclassifications: in other words, to minimize the number of points on the wrong side of the dividing line and to minimize their distance from it. This is the intuition behind a <em>support vector classifier.</em></p>
<p>A <em>support vector machine</em> classifier generalizes the support vector classifier to the case where the boundary is non-linear. Roughly, an SVM expands the input feature space (i.e. the <span class="math inline">\(x_i\)</span>) using potentially non-linear transformations and then solves the classification problem in this larger space. Linear boundaries in this larger space will generally correspond to non-linear boundaries in the original space, so intuitively this means we are now considering the possibility that we could draw <em>curved</em> lines in our original space to separate our two classes. The details, however, are highly technical, and the reader is referred to <span class="citation">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie_elements_2009" role="doc-biblioref">2009</a>)</span> (417-438) for more information.</p>
</div>
<div id="preparing-the-data-1" class="section level2">
<h2><span class="header-section-number">9.3</span> Preparing the Data</h2>
<p>I will again work with the large Yelp dataset available <a href="https://www.kaggle.com/yelp-dataset/yelp-dataset">at this link</a>, this time loading the first 500k reviews.</p>
<p>This code block does the following:</p>
<ul>
<li>Load our data;</li>
<li>Factor it into POS (4-5 stars) and NEG (1-2 stars);</li>
<li>Balance POS and NEG by random downsampling;</li>
<li>Get each review’s AFINN sentiment score; and</li>
<li>Get each review’s word count.</li>
</ul>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb285-2"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-2"></a></span>
<span id="cb285-3"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-3"></a><span class="co"># figure out how to do it reading between the lines of this stackoverflow:</span></span>
<span id="cb285-4"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-4"></a><span class="co"># https://stackoverflow.com/questions/53277351/read-first-1000-lines-from-very-big-json-lines-file-r</span></span>
<span id="cb285-5"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-5"></a></span>
<span id="cb285-6"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-6"></a>yelp_big_factor &lt;-<span class="st"> </span><span class="kw">readLines</span>(<span class="st">&quot;../tests/data/yelp_academic_dataset_review.json&quot;</span>, <span class="dt">n =</span> <span class="dv">500000</span>) <span class="op">%&gt;%</span></span>
<span id="cb285-7"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-7"></a><span class="st">  </span><span class="kw">textConnection</span>() <span class="op">%&gt;%</span></span>
<span id="cb285-8"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-8"></a><span class="st">  </span>jsonlite<span class="op">::</span><span class="kw">stream_in</span>(<span class="dt">verbose=</span><span class="ot">FALSE</span>) <span class="op">%&gt;%</span></span>
<span id="cb285-9"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-9"></a><span class="st">  </span><span class="kw">select</span>(stars, text) <span class="op">%&gt;%</span></span>
<span id="cb285-10"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rating_factor =</span> <span class="kw">case_when</span>(</span>
<span id="cb285-11"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-11"></a>    stars <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span> <span class="op">~</span><span class="st"> &quot;NEG&quot;</span>,</span>
<span id="cb285-12"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-12"></a>    stars <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span> <span class="op">~</span><span class="st"> &quot;POS&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb285-13"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-13"></a><span class="st">      </span><span class="kw">as.factor</span>()</span>
<span id="cb285-14"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-14"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb285-15"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-15"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>stars) <span class="op">%&gt;%</span></span>
<span id="cb285-16"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-16"></a><span class="st">  </span><span class="kw">drop_na</span>() </span>
<span id="cb285-17"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-17"></a></span>
<span id="cb285-18"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-18"></a><span class="co"># random downsampling to balance POS and NEG in the dataset</span></span>
<span id="cb285-19"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-19"></a>yelp_balanced &lt;-<span class="st"> </span>yelp_big_factor <span class="op">%&gt;%</span></span>
<span id="cb285-20"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-20"></a><span class="st">  </span><span class="kw">filter</span>(rating_factor <span class="op">==</span><span class="st"> &quot;NEG&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb285-21"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-21"></a><span class="st">  </span><span class="kw">bind_rows</span>(yelp_big_factor<span class="op">%&gt;%</span></span>
<span id="cb285-22"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-22"></a><span class="st">              </span><span class="kw">filter</span>(rating_factor <span class="op">==</span><span class="st"> &quot;POS&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb285-23"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-23"></a><span class="st">              </span><span class="kw">slice_sample</span>(<span class="dt">n=</span>yelp_big_factor <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(rating_factor <span class="op">==</span><span class="st"> &quot;NEG&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>() ))</span>
<span id="cb285-24"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-24"></a></span>
<span id="cb285-25"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-25"></a><span class="co"># get AFINN scores for each review</span></span>
<span id="cb285-26"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-26"></a><span class="kw">tic</span>()</span>
<span id="cb285-27"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-27"></a>afinn_yelp_big &lt;-<span class="st"> </span>yelp_balanced <span class="op">%&gt;%</span></span>
<span id="cb285-28"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-28"></a><span class="st">  </span><span class="kw">rowid_to_column</span>() <span class="op">%&gt;%</span></span>
<span id="cb285-29"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-29"></a><span class="st">  </span>tidytext<span class="op">::</span><span class="kw">unnest_tokens</span>(word, text) <span class="op">%&gt;%</span></span>
<span id="cb285-30"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-30"></a><span class="st">  </span><span class="kw">left_join</span>(afinn) <span class="op">%&gt;%</span></span>
<span id="cb285-31"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-31"></a><span class="st">  </span><span class="kw">group_by</span>(rowid) <span class="op">%&gt;%</span></span>
<span id="cb285-32"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-32"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">afinn_sent =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> T))</span>
<span id="cb285-33"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-33"></a><span class="kw">toc</span>()</span>
<span id="cb285-34"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-34"></a></span>
<span id="cb285-35"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-35"></a><span class="co"># add the AFINN scores to the original tibble</span></span>
<span id="cb285-36"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-36"></a>yelp_big_bal_afinn &lt;-<span class="st"> </span>afinn_yelp_big <span class="op">%&gt;%</span></span>
<span id="cb285-37"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-37"></a><span class="st">  </span><span class="kw">left_join</span>(yelp_balanced <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowid_to_column</span>()) <span class="op">%&gt;%</span></span>
<span id="cb285-38"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-38"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>rowid)</span>
<span id="cb285-39"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-39"></a></span>
<span id="cb285-40"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-40"></a><span class="co"># get wordcounts</span></span>
<span id="cb285-41"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-41"></a>wordcounts_yp &lt;-<span class="st"> </span>yelp_big_bal_afinn <span class="op">%&gt;%</span></span>
<span id="cb285-42"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-42"></a><span class="st">  </span><span class="kw">select</span>(text) <span class="op">%&gt;%</span></span>
<span id="cb285-43"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-43"></a><span class="st">  </span><span class="kw">rowid_to_column</span>() <span class="op">%&gt;%</span></span>
<span id="cb285-44"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-44"></a><span class="st">  </span>tidytext<span class="op">::</span><span class="kw">unnest_tokens</span>(word, text) <span class="op">%&gt;%</span></span>
<span id="cb285-45"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-45"></a><span class="st">  </span><span class="kw">group_by</span>(rowid) <span class="op">%&gt;%</span></span>
<span id="cb285-46"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-46"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></span>
<span id="cb285-47"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-47"></a><span class="st">  </span><span class="kw">arrange</span>(n)  <span class="op">%&gt;%</span></span>
<span id="cb285-48"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-48"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="dv">1</span>,</span>
<span id="cb285-49"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-49"></a>         <span class="dt">cumdist =</span> <span class="kw">cumsum</span>(id)) </span>
<span id="cb285-50"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-50"></a></span>
<span id="cb285-51"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-51"></a><span class="co"># add wordcounts to create final dataset</span></span>
<span id="cb285-52"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-52"></a>yelp_data &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(</span>
<span id="cb285-53"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-53"></a>  yelp_big_bal_afinn,</span>
<span id="cb285-54"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-54"></a>  wordcounts_yp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb285-55"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-55"></a><span class="st">    </span><span class="kw">arrange</span>(rowid) <span class="op">%&gt;%</span></span>
<span id="cb285-56"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-56"></a><span class="st">    </span><span class="kw">select</span>(<span class="dt">words =</span> n))</span>
<span id="cb285-57"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-57"></a></span>
<span id="cb285-58"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-58"></a><span class="co"># remove transient datasets, keep only the final one</span></span>
<span id="cb285-59"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-59"></a></span>
<span id="cb285-60"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb285-60"></a><span class="kw">rm</span> (yelp_big, yelp_big_factor, yelp_balanced, afinn_yelp_big, yelp_big_bal_afinn, wordcounts_yp)</span></code></pre></div>
<p>Then we’ll create a train/test split on the entire dataset, using 5% for training and 95% for testing.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb286-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb286-2"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb286-2"></a></span>
<span id="cb286-3"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb286-3"></a>yelp_split &lt;-<span class="st"> </span><span class="kw">initial_split</span>(yelp_data,</span>
<span id="cb286-4"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb286-4"></a>                            <span class="dt">strata =</span> rating_factor,</span>
<span id="cb286-5"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb286-5"></a>                            <span class="dt">prop =</span> <span class="fl">0.05</span>)</span>
<span id="cb286-6"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb286-6"></a>  </span>
<span id="cb286-7"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb286-7"></a>yelp_train &lt;-<span class="st"> </span><span class="kw">training</span>(yelp_split)</span>
<span id="cb286-8"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb286-8"></a></span>
<span id="cb286-9"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb286-9"></a>yelp_test &lt;-<span class="st"> </span><span class="kw">testing</span>(yelp_split)</span></code></pre></div>
<p>Then we set up ten cross-validation folds that we will use to evaluate the models we build using our training data.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb287-1"></a>yelp_folds &lt;-<span class="st"> </span><span class="kw">vfold_cv</span>(yelp_train)</span></code></pre></div>
</div>
<div id="svm-classification" class="section level2">
<h2><span class="header-section-number">9.4</span> SVM Classification</h2>
<p>First we set up our SVM model, here using the <strong>liquidSVM</strong> package following <span class="citation">Silge and Hvitfeldt (<a href="#ref-silge_supervised_2020" role="doc-biblioref">2020</a>)</span>.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb288-1"></a>svm_model &lt;-<span class="st"> </span><span class="kw">svm_rbf</span>() <span class="op">%&gt;%</span></span>
<span id="cb288-2"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb288-2"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">&quot;classification&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb288-3"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb288-3"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;liquidSVM&quot;</span>)</span>
<span id="cb288-4"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb288-4"></a></span>
<span id="cb288-5"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb288-5"></a>svm_model</span></code></pre></div>
<pre><code>## Radial Basis Function Support Vector Machine Specification (classification)
## 
## Computational engine: liquidSVM</code></pre>
<p>Next we’ll set up an SVM recipe based on entirely on text tokens. A good next step would be to use what I’ve learned in earlier sections, for example by including negators, word count, and sentiment, but to keep it simple we’ll leave them out here.</p>
<p>We’ll process our text using these steps:</p>
<ul>
<li>Tokenizing the text into words;</li>
<li>Removing stopwords from the default “snowball” dictionary;</li>
<li>Filtering out tokens that occur fewer than 50 times;</li>
<li>Choosing a maximum number of tokens, which we will tune as a hyperparameter; and,</li>
<li>Applying a TFIDF to the text.</li>
</ul>
<p>We could also consider n-grams (i.e. considering n-word strings of text), which might be useful for catching negators. I’ve included the code in this block but commented it out. For now we’ll stick with individual words.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb290-1"></a>yelp_rec &lt;-</span>
<span id="cb290-2"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb290-2"></a><span class="st">  </span><span class="kw">recipe</span>(rating_factor <span class="op">~</span><span class="st"> </span>text, <span class="co">#+ words + afinn_sent,</span></span>
<span id="cb290-3"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb290-3"></a>         <span class="dt">data =</span> yelp_train) <span class="op">%&gt;%</span></span>
<span id="cb290-4"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb290-4"></a><span class="st">  </span><span class="kw">step_tokenize</span>(text) <span class="op">%&gt;%</span></span>
<span id="cb290-5"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb290-5"></a><span class="st">  </span><span class="kw">step_stopwords</span>(text) <span class="op">%&gt;%</span></span>
<span id="cb290-6"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb290-6"></a><span class="co">#    step_ngram(text, min_num_tokens = 1L, num_tokens = 1) %&gt;%</span></span>
<span id="cb290-7"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb290-7"></a><span class="st">  </span><span class="kw">step_tokenfilter</span>(text,</span>
<span id="cb290-8"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb290-8"></a>                   <span class="dt">max_tokens =</span> <span class="kw">tune</span>(),</span>
<span id="cb290-9"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb290-9"></a>                   <span class="dt">min_times =</span> <span class="dv">50</span>) <span class="op">%&gt;%</span></span>
<span id="cb290-10"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb290-10"></a><span class="st">  </span><span class="kw">step_tfidf</span>(text)</span>
<span id="cb290-11"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb290-11"></a></span>
<span id="cb290-12"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb290-12"></a>  yelp_rec</span></code></pre></div>
<pre><code>## Data Recipe
## 
## Inputs:
## 
##       role #variables
##    outcome          1
##  predictor          1
## 
## Operations:
## 
## Tokenization for text
## Stop word removal for text
## Text filtering for text
## Term frequency-inverse document frequency with text</code></pre>
<p>Next we set up our workflow:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb292-1"></a>svm_wf &lt;-<span class="st"> </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span></span>
<span id="cb292-2"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb292-2"></a><span class="st">  </span><span class="kw">add_recipe</span>(yelp_rec) <span class="op">%&gt;%</span></span>
<span id="cb292-3"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb292-3"></a><span class="st">  </span><span class="kw">add_model</span>(svm_model)</span>
<span id="cb292-4"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb292-4"></a></span>
<span id="cb292-5"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb292-5"></a>svm_wf</span></code></pre></div>
<pre><code>## == Workflow =========================================================================================================================================================================================================================
## Preprocessor: Recipe
## Model: svm_rbf()
## 
## -- Preprocessor ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
## 4 Recipe Steps
## 
## * step_tokenize()
## * step_stopwords()
## * step_tokenfilter()
## * step_tfidf()
## 
## -- Model ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
## Radial Basis Function Support Vector Machine Specification (classification)
## 
## Computational engine: liquidSVM</code></pre>
<p>We have set up our recipe to let us try several different values for the maximum number of tokens, so here we’ll set up grid of values to test. Based on some scratch work, I’m going to use three values between 500 and 1250.</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb294-1"></a>param_grid &lt;-<span class="st"> </span><span class="kw">grid_regular</span>(</span>
<span id="cb294-2"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb294-2"></a>  <span class="kw">max_tokens</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="dv">500</span>,<span class="dv">1250</span>)),</span>
<span id="cb294-3"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb294-3"></a>  <span class="dt">levels=</span><span class="dv">3</span></span>
<span id="cb294-4"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb294-4"></a>)</span></code></pre></div>
<p>Here we set up tuning grid and tune our model on the cv-folds we’ve set up. On an initial test run using 20k Yelp reviews (~9k after balancing) this took ~480 seconds (8 min). With 11,106 training inputs and only 1-grams it takes ~1200s (20 min) on my machine. With 11,106 training inputs and 1-, 2-, and 3-grams it takes ~ 2300s (38 min).</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb295-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb295-2"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb295-2"></a></span>
<span id="cb295-3"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb295-3"></a><span class="kw">tic</span>()</span>
<span id="cb295-4"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb295-4"></a>tune_rs_svm &lt;-<span class="st"> </span><span class="kw">tune_grid</span>(</span>
<span id="cb295-5"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb295-5"></a>  svm_wf,</span>
<span id="cb295-6"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb295-6"></a>  yelp_folds,</span>
<span id="cb295-7"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb295-7"></a>  <span class="dt">grid =</span> param_grid,</span>
<span id="cb295-8"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb295-8"></a>  <span class="dt">metrics =</span> <span class="kw">metric_set</span>(accuracy, sensitivity, specificity),</span>
<span id="cb295-9"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb295-9"></a>  <span class="dt">control =</span> <span class="kw">control_resamples</span>(<span class="dt">save_pred =</span> <span class="ot">TRUE</span>)</span>
<span id="cb295-10"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb295-10"></a>)</span>
<span id="cb295-11"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb295-11"></a><span class="kw">toc</span>()</span></code></pre></div>
<p>Now we can evaluate our modeling by looking at the accuracy across our tuning grid:</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb296-1"></a><span class="kw">show_best</span>(tune_rs_svm, <span class="dt">metric =</span> <span class="st">&quot;accuracy&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb296-2"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb296-2"></a><span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">max_tokens</th>
<th align="left">.metric</th>
<th align="left">.estimator</th>
<th align="right">mean</th>
<th align="right">n</th>
<th align="right">std_err</th>
<th align="left">.config</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1250</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8928513</td>
<td align="right">10</td>
<td align="right">0.0036235</td>
<td align="left">Preprocessor3_Model1</td>
</tr>
<tr class="even">
<td align="right">875</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8913215</td>
<td align="right">10</td>
<td align="right">0.0025463</td>
<td align="left">Preprocessor2_Model1</td>
</tr>
<tr class="odd">
<td align="right">500</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8789849</td>
<td align="right">10</td>
<td align="right">0.0029043</td>
<td align="left">Preprocessor1_Model1</td>
</tr>
</tbody>
</table>
<p>The accuracy was particularly surprisingly good across for each number of tokens. Since we got the best results using 1250 tokens, we’ll use 1250 for the rest of our experiment.</p>
<p>Then we finalize our workflow using the results of our model tuning.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb297-1"></a>best_accuracy &lt;-<span class="st"> </span><span class="kw">select_best</span>(tune_rs_svm, <span class="st">&quot;accuracy&quot;</span>)</span>
<span id="cb297-2"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb297-2"></a></span>
<span id="cb297-3"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb297-3"></a>svm_wf_final &lt;-<span class="st"> </span><span class="kw">finalize_workflow</span>(</span>
<span id="cb297-4"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb297-4"></a>  svm_wf,</span>
<span id="cb297-5"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb297-5"></a>  best_accuracy</span>
<span id="cb297-6"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb297-6"></a>)</span></code></pre></div>
<p>At this point, <span class="citation">Silge and Hvitfeldt (<a href="#ref-silge_supervised_2020" role="doc-biblioref">2020</a>)</span> says we use <code>last_fit()</code> to fit our model to our training data and evaluate it on our testing data. On initial runs, this worked and gave a final accuracy rate of roughly 83%. <strong>But two problems arose:</strong></p>
<ol style="list-style-type: decimal">
<li><strong>It stopped working reliably!</strong> I have no idea what changed, but all of my code started to crash at the <code>last_fit()</code> stage. Even behind-the-scenes scratch work now crashes, despite working fine a few days ago. <em>But then it worked again when I tried to knit the final version of this document!</em></li>
<li><strong>When it did work, I couldn’t use the final fit object to make predictions.</strong> After reading the documentation, it does seem that objects created by <code>last_fit()</code> includes the fitted workflow in a list column called <code>.workflow</code>. However, it took me a while to figure this out, and by the time I did <code>last_fit()</code> had stopped working.</li>
</ol>
<p>When it <strong>did</strong> work unexpectedly I saved the results to file, and the rest of this report uses the saved results. Here is the the code that worked sporadically:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb298-1"></a><span class="co"># get final results</span></span>
<span id="cb298-2"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb298-2"></a>final_res &lt;-<span class="st"> </span>svm_wf_final <span class="op">%&gt;%</span></span>
<span id="cb298-3"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb298-3"></a><span class="st">  </span><span class="kw">last_fit</span>(yelp_split,</span>
<span id="cb298-4"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb298-4"></a>           <span class="dt">metrics =</span> <span class="kw">metric_set</span>(accuracy))</span></code></pre></div>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb299-1"></a><span class="co">#save(list = &quot;final_res&quot;, file = &quot;data/final_res.Rdata&quot;)</span></span>
<span id="cb299-2"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb299-2"></a><span class="kw">load</span>(<span class="st">&quot;data/final_res.Rdata&quot;</span>)</span></code></pre></div>
<p>We can then see the results which look quite good, with roughly 83% accuracy on the test data:</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb300-1"></a><span class="co"># Then we can see results with `collect_metrics()` and `collect_predictions()`.</span></span>
<span id="cb300-2"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb300-2"></a>final_res_metrics &lt;-<span class="st"> </span><span class="kw">collect_metrics</span>(final_res)</span>
<span id="cb300-3"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb300-3"></a>final_res_predictions &lt;-<span class="st"> </span><span class="kw">collect_predictions</span>(final_res)</span>
<span id="cb300-4"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb300-4"></a></span>
<span id="cb300-5"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb300-5"></a>final_res_metrics <span class="op">%&gt;%</span></span>
<span id="cb300-6"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb300-6"></a><span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">.metric</th>
<th align="left">.estimator</th>
<th align="right">.estimate</th>
<th align="left">.config</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8267608</td>
<td align="left">Preprocessor1_Model1</td>
</tr>
</tbody>
</table>
<p>And Figure <a href="#fig:svm-heatmap-works-now"><strong>??</strong></a> shows a heatmap of the confusion matrix. The off-diagonals look reasonably symmetric, so the model isn’t biased significantly.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb301-1"></a><span class="co"># Visualize the model&#39;s performance with a heatmap of the confusion matrix.</span></span>
<span id="cb301-2"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb301-2"></a><span class="co"># When it worked, the results were nearly symmetric.</span></span>
<span id="cb301-3"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb301-3"></a>final_res_predictions <span class="op">%&gt;%</span></span>
<span id="cb301-4"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb301-4"></a><span class="st">  </span><span class="kw">conf_mat</span>(<span class="dt">truth =</span> rating_factor, <span class="dt">estimate =</span> .pred_class) <span class="op">%&gt;%</span></span>
<span id="cb301-5"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb301-5"></a><span class="st">  </span><span class="kw">autoplot</span>(<span class="dt">type =</span> <span class="st">&quot;heatmap&quot;</span>)</span></code></pre></div>
<p><img src="telfer-mba-nlp_files/figure-html/svm-heatmap-works-now-1.png" width="672" /></p>
</div>
<div id="predicting-with-last_fit" class="section level2">
<h2><span class="header-section-number">9.5</span> Predicting with <code>last_fit()</code></h2>
<p>Now we’ll try to use the results from <code>last_fit()</code> to predict a <em>new</em> result. Here we’ll pull the fitted workflow and try to use it to predict the values for the test set.</p>
<p><em>But this code fails!</em></p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb302-1"></a>wf &lt;-<span class="st"> </span>final_res<span class="op">$</span>.workflow[[<span class="dv">1</span>]]</span>
<span id="cb302-2"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb302-2"></a></span>
<span id="cb302-3"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb302-3"></a>test &lt;-<span class="st"> </span>wf <span class="op">%&gt;%</span></span>
<span id="cb302-4"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb302-4"></a><span class="st">  </span><span class="kw">predict</span>(<span class="dt">new_data =</span> yelp_test[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,])</span>
<span id="cb302-5"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb302-5"></a></span>
<span id="cb302-6"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb302-6"></a>yelp_test <span class="op">%&gt;%</span></span>
<span id="cb302-7"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb302-7"></a><span class="st">  </span><span class="kw">bind_cols</span>(test) <span class="op">%&gt;%</span></span>
<span id="cb302-8"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb302-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">correct =</span> (.pred_class <span class="op">==</span><span class="st"> </span>rating_factor)) <span class="op">%&gt;%</span></span>
<span id="cb302-9"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb302-9"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">sum</span>(correct) <span class="op">/</span><span class="st"> </span><span class="kw">n</span>())</span></code></pre></div>
<p>We get the following output:</p>
<blockquote>
<p>SVM not known from cookie 35 cookies.size: 0!
Error in test.liquidSVM(model = object, newdata = newdata, labels = 0, : Should not happen!! liquid_svm_test</p>
</blockquote>
<p>This concludes my experiment with <code>last_fit()</code>.</p>
</div>
<div id="fitting-and-predicting-using-fit" class="section level2">
<h2><span class="header-section-number">9.6</span> Fitting and Predicting Using <code>fit()</code></h2>
<p>Instead of using <code>last_fit()</code>, we should be able to just use <code>fit()</code> to fit our final workflow to our training data. This creates a fitted workflow object that includes our preprocessing recipe and our fitted model. It’s a 20.4 MB file when saved to disk.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb303-1"></a>final_fit &lt;-<span class="st"> </span><span class="kw">fit</span>(svm_wf_final, </span>
<span id="cb303-2"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb303-2"></a>                 <span class="dt">data =</span> yelp_train)</span>
<span id="cb303-3"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb303-3"></a></span>
<span id="cb303-4"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb303-4"></a>final_fit</span></code></pre></div>
<pre><code>## == Workflow [trained] ===============================================================================================================================================================================================================
## Preprocessor: Recipe
## Model: svm_rbf()
## 
## -- Preprocessor ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
## 4 Recipe Steps
## 
## * step_tokenize()
## * step_stopwords()
## * step_tokenfilter()
## * step_tfidf()
## 
## -- Model ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
## SVM model on 877 features (cookie=33)
##  Formula:  new(&quot;formula&quot;, .S3Class = &quot;formula&quot;, structure(list(), class = &quot;formula&quot;, .Environment = &lt;environment&gt;))
##   trained and selected on a 10x706 grid
##   has a $last_result because there has been predicting or testing</code></pre>
<p>Then we can use our <code>final_fit</code> object to predict rating factors for our test data.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb305-1"></a>preds &lt;-<span class="st"> </span>final_fit <span class="op">%&gt;%</span></span>
<span id="cb305-2"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb305-2"></a><span class="st">  </span><span class="kw">predict</span>(<span class="dt">new_data =</span> yelp_test)</span></code></pre></div>
<p>To evaluate our fit, we can bind our prediction columns to our test data and check to see how often the true and predicted ratings agree.</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb306-1"></a>yelp_test &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(yelp_test, preds) <span class="op">%&gt;%</span></span>
<span id="cb306-2"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb306-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">correct =</span> (.pred_class <span class="op">==</span><span class="st"> </span>rating_factor))</span>
<span id="cb306-3"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb306-3"></a></span>
<span id="cb306-4"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb306-4"></a>yelp_test <span class="op">%&gt;%</span></span>
<span id="cb306-5"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb306-5"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">sum</span>(correct) <span class="op">/</span><span class="st"> </span><span class="kw">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   `sum(correct)/n()`
##                &lt;dbl&gt;
## 1              0.671</code></pre>
<p>But now our accuracy drops to 67% and I’m not sure why! According to the help docs <code>last_fit()</code> is supposed to “[f]it the final best model to the training set and evaluate the test set,” and that’s exactly what I did above. But the results here are quite different.</p>
<p>Since the SVM process is slow and since I’ve had some kind of toolchain breakdown, I wasn’t able to get to the root of the problem in time for this week’s report.</p>
</div>
<div id="conclusions-1" class="section level2">
<h2><span class="header-section-number">9.7</span> Conclusions</h2>
<p>In this section I created a support vector machine (SVM) classifier model to predict whether Yelp reviews were positive or negative based on their text. In an initial experiment, according to <code>tune::last_fit()</code> the model achieved ~89% testing accuracy on~11,000 observations, and 83% accuracy on ~211,000 testing observations. However, on subsequent runs <code>tune::last_fit()</code> stopped working. When it started to work again, I wasn’t able to use the fitted model to make predictions. I then fit the final model manually on the training data and tested it against the test data, but the accuracy dropped to 67%.</p>
</div>
<div id="sessioninfo-4" class="section level2">
<h2><span class="header-section-number">9.8</span> SessionInfo</h2>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="beyond-the-mvp-support-vector-machine-classification.html#cb308-1"></a><span class="kw">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.0.2 (2020-06-22)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 18363)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252   
## [3] LC_MONETARY=English_Canada.1252 LC_NUMERIC=C                   
## [5] LC_TIME=English_Canada.1252    
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] vip_0.2.2         glmnet_4.0-2      Matrix_1.2-18     lubridate_1.7.9   ggridges_0.5.2   
##  [6] tictoc_1.0        discrim_0.1.1     yardstick_0.0.7   workflows_0.2.0   tune_0.1.1       
## [11] rsample_0.0.8     parsnip_0.1.4     modeldata_0.0.2   infer_0.5.3       dials_0.0.9      
## [16] scales_1.1.1      broom_0.7.0       tidymodels_0.1.1  textrecipes_0.3.0 recipes_0.1.13   
## [21] tidytext_0.2.5    forcats_0.5.0     stringr_1.4.0     dplyr_1.0.2       purrr_0.3.4      
## [26] readr_1.3.1       tidyr_1.1.1       tibble_3.0.3      ggplot2_3.3.2     tidyverse_1.3.0  
## 
## loaded via a namespace (and not attached):
##  [1] colorspace_1.4-1   ellipsis_0.3.1     class_7.3-17       fs_1.5.0          
##  [5] rstudioapi_0.11    listenv_0.8.0      furrr_0.1.0        farver_2.0.3      
##  [9] SnowballC_0.7.0    prodlim_2019.11.13 fansi_0.4.1        xml2_1.3.2        
## [13] codetools_0.2-16   splines_4.0.2      knitr_1.29         jsonlite_1.7.0    
## [17] pROC_1.16.2        dbplyr_1.4.4       compiler_4.0.2     httr_1.4.2        
## [21] backports_1.1.7    assertthat_0.2.1   cli_2.0.2          htmltools_0.5.0   
## [25] tools_4.0.2        gtable_0.3.0       glue_1.4.1         rappdirs_0.3.1    
## [29] Rcpp_1.0.5         cellranger_1.1.0   DiceDesign_1.8-1   vctrs_0.3.2       
## [33] iterators_1.0.12   timeDate_3043.102  gower_0.2.2        xfun_0.16         
## [37] globals_0.13.0     stopwords_2.0      rvest_0.3.6        lifecycle_0.2.0   
## [41] future_1.19.1      MASS_7.3-51.6      ipred_0.9-9        hms_0.5.3         
## [45] parallel_4.0.2     yaml_2.2.1         gridExtra_2.3      rpart_4.1-15      
## [49] stringi_1.4.6      highr_0.8          tokenizers_0.2.1   foreach_1.5.0     
## [53] textdata_0.4.1     lhs_1.0.2          hardhat_0.1.4      shape_1.4.5       
## [57] lava_1.6.8         rlang_0.4.7        pkgconfig_2.0.3    evaluate_0.14     
## [61] lattice_0.20-41    tidyselect_1.1.0   bookdown_0.20      plyr_1.8.6        
## [65] magrittr_1.5       R6_2.4.1           generics_0.0.2     DBI_1.1.0         
## [69] pillar_1.4.6       haven_2.3.1        withr_2.2.0        survival_3.1-12   
## [73] nnet_7.3-14        janeaustenr_0.1.5  modelr_0.1.8       crayon_1.3.4      
## [77] utf8_1.1.4         rmarkdown_2.3      usethis_1.6.1      grid_4.0.2        
## [81] readxl_1.3.1       liquidSVM_1.2.4    blob_1.2.1         reprex_0.3.0      
## [85] digest_0.6.25      GPfit_1.0-8        munsell_0.5.0</code></pre>
</div>
<div id="references-1" class="section level2">
<h2><span class="header-section-number">9.9</span> References</h2>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-hastie_elements_2009">
<p>Hastie, Trevor, Robert Tibshirani, and Jerome Friedman. 2009. <em>The Elements of Statistical Learning</em>. Springer Series in Statistics. New York, NY: Springer New York. <a href="https://doi.org/10.1007/978-0-387-84858-7">https://doi.org/10.1007/978-0-387-84858-7</a>.</p>
</div>
<div id="ref-liu_sentiment_2015">
<p>Liu, Bing. 2015. <em>Sentiment Analysis: Mining Opinions, Sentiments, and Emotions</em>. Cambridge: Cambridge University Press. <a href="https://doi.org/10.1017/CBO9781139084789">https://doi.org/10.1017/CBO9781139084789</a>.</p>
</div>
<div id="ref-silge_supervised_2020">
<p>Silge, Julia, and Emil Hvitfeldt. 2020. <em>Supervised Machine Learning for Text Analysis in R</em>. <a href="https://smltar.com/">https://smltar.com/</a>.</p>
</div>
<div id="ref-silge_text_2020">
<p>Silge, Julia, and David Robinson. 2020. <em>Text Mining with R: A Tidy Approach</em>. O’Reilly. <a href="https://www.tidytextmining.com/index.html">https://www.tidytextmining.com/index.html</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="beyond-the-mvp-looking-at-longer-reviews.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="building-a-shiny-app.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/08-SVM.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["telfer-mba-nlp.pdf", "telfer-mba-nlp.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
