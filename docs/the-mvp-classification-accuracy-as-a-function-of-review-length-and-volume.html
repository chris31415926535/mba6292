<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 The MVP: Classification Accuracy as a Function of Review Length and Volume | Telfer 2020 Directed Reading: Natural Language Processing</title>
  <meta name="description" content="This is Christopher Belanger’s work product for the Telfer School of Management course MBA6292, Directed Readings in Natural Language Processing." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 The MVP: Classification Accuracy as a Function of Review Length and Volume | Telfer 2020 Directed Reading: Natural Language Processing" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is Christopher Belanger’s work product for the Telfer School of Management course MBA6292, Directed Readings in Natural Language Processing." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 The MVP: Classification Accuracy as a Function of Review Length and Volume | Telfer 2020 Directed Reading: Natural Language Processing" />
  
  <meta name="twitter:description" content="This is Christopher Belanger’s work product for the Telfer School of Management course MBA6292, Directed Readings in Natural Language Processing." />
  

<meta name="author" content="Christopher Belanger" />


<meta name="date" content="2020-12-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="yelp-classification-and-sentiment-test.html"/>
<link rel="next" href="beyond-the-mvp-looking-at-longer-reviews.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MBA6292: Directed Readings in NLP</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html"><i class="fa fa-check"></i><b>3</b> Web Scraping Our Data</a><ul>
<li class="chapter" data-level="3.1" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#foreword-ethics-legality"><i class="fa fa-check"></i><b>3.1</b> Foreword: Ethics &amp; Legality</a></li>
<li class="chapter" data-level="3.2" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#the-general-idea"><i class="fa fa-check"></i><b>3.2</b> The General Idea</a></li>
<li class="chapter" data-level="3.3" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#goodreads-css-selectors"><i class="fa fa-check"></i><b>3.3</b> Goodreads: CSS Selectors</a><ul>
<li class="chapter" data-level="3.3.1" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-index"><i class="fa fa-check"></i><b>3.3.1</b> Scraping the Index</a></li>
<li class="chapter" data-level="3.3.2" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-content"><i class="fa fa-check"></i><b>3.3.2</b> Scraping the Content</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#yelp-embedded-json"><i class="fa fa-check"></i><b>3.4</b> Yelp: Embedded JSON</a><ul>
<li class="chapter" data-level="3.4.1" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-index-1"><i class="fa fa-check"></i><b>3.4.1</b> Scraping the Index</a></li>
<li class="chapter" data-level="3.4.2" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-content-1"><i class="fa fa-check"></i><b>3.4.2</b> Scraping the Content</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#mec-reverse-engineering-client-side-api-calls"><i class="fa fa-check"></i><b>3.5</b> MEC: Reverse-Engineering Client-Side API Calls</a><ul>
<li class="chapter" data-level="3.5.1" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-index-2"><i class="fa fa-check"></i><b>3.5.1</b> Scraping the Index</a></li>
<li class="chapter" data-level="3.5.2" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#functions-for-api-calls"><i class="fa fa-check"></i><b>3.5.2</b> Functions for API Calls</a></li>
<li class="chapter" data-level="3.5.3" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-content-2"><i class="fa fa-check"></i><b>3.5.3</b> Scraping the Content</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#summary"><i class="fa fa-check"></i><b>3.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html"><i class="fa fa-check"></i><b>4</b> Data Summary, EDA, &amp; Initial Model Attempts</a><ul>
<li class="chapter" data-level="4.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#goodreads"><i class="fa fa-check"></i><b>4.2</b> Goodreads</a><ul>
<li class="chapter" data-level="4.2.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#star-ratings"><i class="fa fa-check"></i><b>4.2.1</b> Star Ratings</a></li>
<li class="chapter" data-level="4.2.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#word-count"><i class="fa fa-check"></i><b>4.2.2</b> Word Count</a></li>
<li class="chapter" data-level="4.2.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#reviewers"><i class="fa fa-check"></i><b>4.2.3</b> Reviewers</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#yelp"><i class="fa fa-check"></i><b>4.3</b> Yelp</a><ul>
<li class="chapter" data-level="4.3.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#star-ratings-1"><i class="fa fa-check"></i><b>4.3.1</b> Star Ratings</a></li>
<li class="chapter" data-level="4.3.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#word-count-1"><i class="fa fa-check"></i><b>4.3.2</b> Word Count</a></li>
<li class="chapter" data-level="4.3.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#reviewers-1"><i class="fa fa-check"></i><b>4.3.3</b> Reviewers</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#mountain-equipment-co-op-mec"><i class="fa fa-check"></i><b>4.4</b> Mountain Equipment Co-op (MEC)</a><ul>
<li class="chapter" data-level="4.4.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#star-ratings-2"><i class="fa fa-check"></i><b>4.4.1</b> Star Ratings</a></li>
<li class="chapter" data-level="4.4.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#word-counts"><i class="fa fa-check"></i><b>4.4.2</b> Word Counts</a></li>
<li class="chapter" data-level="4.4.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#reviewers-2"><i class="fa fa-check"></i><b>4.4.3</b> Reviewers</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#comparing-goodreads-mec-and-yelp"><i class="fa fa-check"></i><b>4.5</b> Comparing Goodreads, MEC, and Yelp</a><ul>
<li class="chapter" data-level="4.5.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#star-ratings-3"><i class="fa fa-check"></i><b>4.5.1</b> Star Ratings</a></li>
<li class="chapter" data-level="4.5.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#word-counts-1"><i class="fa fa-check"></i><b>4.5.2</b> Word Counts</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#reviews-over-time"><i class="fa fa-check"></i><b>4.6</b> Reviews Over Time</a><ul>
<li class="chapter" data-level="4.6.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#goodreads-1"><i class="fa fa-check"></i><b>4.6.1</b> Goodreads</a></li>
<li class="chapter" data-level="4.6.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#yelp-1"><i class="fa fa-check"></i><b>4.6.2</b> Yelp</a></li>
<li class="chapter" data-level="4.6.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#mec"><i class="fa fa-check"></i><b>4.6.3</b> MEC</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#proposed-next-steps"><i class="fa fa-check"></i><b>4.7</b> Proposed Next Steps</a></li>
<li class="chapter" data-level="4.8" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#sessioninfo"><i class="fa fa-check"></i><b>4.8</b> SessionInfo</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html"><i class="fa fa-check"></i><b>5</b> A First LASSO Attempt</a><ul>
<li class="chapter" data-level="5.1" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#introduction-1"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#a-first-regression-yelp-data"><i class="fa fa-check"></i><b>5.2</b> A First Regression: Yelp Data</a><ul>
<li class="chapter" data-level="5.2.1" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#splitting-the-data"><i class="fa fa-check"></i><b>5.2.1</b> Splitting the data</a></li>
<li class="chapter" data-level="5.2.2" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#evaluating-the-first-model"><i class="fa fa-check"></i><b>5.2.2</b> Evaluating the first model</a></li>
<li class="chapter" data-level="5.2.3" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#tuning-model-parameters"><i class="fa fa-check"></i><b>5.2.3</b> Tuning model parameters</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#trying-lasso-again"><i class="fa fa-check"></i><b>5.3</b> Trying lasso again</a><ul>
<li class="chapter" data-level="5.3.1" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#with-1000-tokens"><i class="fa fa-check"></i><b>5.3.1</b> With 1000 tokens</a></li>
<li class="chapter" data-level="5.3.2" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#short-reviews-only-125-words"><i class="fa fa-check"></i><b>5.3.2</b> Short reviews only: &lt;125 words</a></li>
<li class="chapter" data-level="5.3.3" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#longer-reviews-125-words"><i class="fa fa-check"></i><b>5.3.3</b> Longer reviews &gt; 125 words</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#removing-stop-words"><i class="fa fa-check"></i><b>5.4</b> Removing stop words</a></li>
<li class="chapter" data-level="5.5" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#adjusting-n-grams"><i class="fa fa-check"></i><b>5.5</b> Adjusting n-grams</a></li>
<li class="chapter" data-level="5.6" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#full-final-regression"><i class="fa fa-check"></i><b>5.6</b> Full final regression</a></li>
<li class="chapter" data-level="5.7" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#conclusion"><i class="fa fa-check"></i><b>5.7</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html"><i class="fa fa-check"></i><b>6</b> Yelp Classification and Sentiment Test</a><ul>
<li class="chapter" data-level="6.1" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#yelp-dataset"><i class="fa fa-check"></i><b>6.1</b> Yelp Dataset</a><ul>
<li class="chapter" data-level="6.1.1" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#afinn"><i class="fa fa-check"></i><b>6.1.1</b> AFINN</a></li>
<li class="chapter" data-level="6.1.2" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#classification-naive-bayes-classifier"><i class="fa fa-check"></i><b>6.1.2</b> Classification: Naive Bayes Classifier</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#kaggle-yelp-dataset"><i class="fa fa-check"></i><b>6.2</b> Kaggle Yelp dataset</a><ul>
<li class="chapter" data-level="6.2.1" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#naive-bayes-classifier"><i class="fa fa-check"></i><b>6.2.1</b> Naive Bayes Classifier</a></li>
<li class="chapter" data-level="6.2.2" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#logistic-regression"><i class="fa fa-check"></i><b>6.2.2</b> Logistic Regression</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#next-steps"><i class="fa fa-check"></i><b>6.3</b> NEXT STEPS</a></li>
<li class="chapter" data-level="6.4" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#sessioninfo-1"><i class="fa fa-check"></i><b>6.4</b> SessionInfo</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><i class="fa fa-check"></i><b>7</b> The MVP: Classification Accuracy as a Function of Review Length and Volume</a><ul>
<li class="chapter" data-level="7.1" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#introduction-2"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#preparing-the-data"><i class="fa fa-check"></i><b>7.2</b> Preparing the Data</a></li>
<li class="chapter" data-level="7.3" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#experiment-1-logistic-regression-on-globally-balanced-data"><i class="fa fa-check"></i><b>7.3</b> Experiment 1: Logistic Regression on Globally Balanced Data</a></li>
<li class="chapter" data-level="7.4" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#experiment-2-logistic-regression-on-micro-balanced-data"><i class="fa fa-check"></i><b>7.4</b> Experiment 2: Logistic Regression on Micro-Balanced Data</a></li>
<li class="chapter" data-level="7.5" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#conclusions"><i class="fa fa-check"></i><b>7.5</b> Conclusions</a></li>
<li class="chapter" data-level="7.6" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#next-steps-1"><i class="fa fa-check"></i><b>7.6</b> Next Steps</a></li>
<li class="chapter" data-level="7.7" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#sessioninfo-2"><i class="fa fa-check"></i><b>7.7</b> SessionInfo</a></li>
<li class="chapter" data-level="7.8" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#references"><i class="fa fa-check"></i><b>7.8</b> References</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html"><i class="fa fa-check"></i><b>8</b> Beyond the MVP: Looking at Longer Reviews</a><ul>
<li class="chapter" data-level="8.1" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#introduction-3"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#results-from-the-previous-section"><i class="fa fa-check"></i><b>8.2</b> Results from the Previous Section</a></li>
<li class="chapter" data-level="8.3" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#finding-misclassified-reviews"><i class="fa fa-check"></i><b>8.3</b> Finding Misclassified Reviews</a></li>
<li class="chapter" data-level="8.4" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#qualitative-analysis-of-misclassified-reviews"><i class="fa fa-check"></i><b>8.4</b> Qualitative Analysis of Misclassified Reviews</a></li>
<li class="chapter" data-level="8.5" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#negations"><i class="fa fa-check"></i><b>8.5</b> Negations</a><ul>
<li class="chapter" data-level="8.5.1" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#negations-and-prediction-accuracy"><i class="fa fa-check"></i><b>8.5.1</b> Negations and Prediction Accuracy</a></li>
<li class="chapter" data-level="8.5.2" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#negations-and-word-length"><i class="fa fa-check"></i><b>8.5.2</b> Negations and Word Length</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#readability"><i class="fa fa-check"></i><b>8.6</b> Readability</a></li>
<li class="chapter" data-level="8.7" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#summing-up-so-far"><i class="fa fa-check"></i><b>8.7</b> Summing Up So Far</a></li>
<li class="chapter" data-level="8.8" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#logistic-regression-on-afinn-negators"><i class="fa fa-check"></i><b>8.8</b> Logistic Regression on AFINN + negators</a></li>
<li class="chapter" data-level="8.9" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#logistic-regression-on-mean-afinn-negators"><i class="fa fa-check"></i><b>8.9</b> Logistic Regression on Mean AFINN + negators</a></li>
<li class="chapter" data-level="8.10" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#comparing-models-multiple-trials"><i class="fa fa-check"></i><b>8.10</b> Comparing Models: Multiple Trials</a></li>
<li class="chapter" data-level="8.11" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#re-running-the-big-analysis"><i class="fa fa-check"></i><b>8.11</b> Re-Running the Big Analysis</a></li>
<li class="chapter" data-level="8.12" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#conclusion-1"><i class="fa fa-check"></i><b>8.12</b> Conclusion</a></li>
<li class="chapter" data-level="8.13" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#sessioninfo-3"><i class="fa fa-check"></i><b>8.13</b> SessionInfo</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html"><i class="fa fa-check"></i><b>9</b> Beyond the MVP: Support Vector Machine Classification</a><ul>
<li class="chapter" data-level="9.1" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#introduction-4"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#svm-classifiers"><i class="fa fa-check"></i><b>9.2</b> SVM Classifiers</a></li>
<li class="chapter" data-level="9.3" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#preparing-the-data-1"><i class="fa fa-check"></i><b>9.3</b> Preparing the Data</a></li>
<li class="chapter" data-level="9.4" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#svm-classification"><i class="fa fa-check"></i><b>9.4</b> SVM Classification</a></li>
<li class="chapter" data-level="9.5" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#fitting-and-predicting"><i class="fa fa-check"></i><b>9.5</b> Fitting and Predicting</a></li>
<li class="chapter" data-level="9.6" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#conclusions-1"><i class="fa fa-check"></i><b>9.6</b> Conclusions</a></li>
<li class="chapter" data-level="9.7" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#sessioninfo-4"><i class="fa fa-check"></i><b>9.7</b> SessionInfo</a></li>
<li class="chapter" data-level="9.8" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#references-1"><i class="fa fa-check"></i><b>9.8</b> References</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-2.html"><a href="references-2.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Telfer 2020 Directed Reading: Natural Language Processing</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> The MVP: Classification Accuracy as a Function of Review Length and Volume</h1>
<div id="introduction-2" class="section level2">
<h2><span class="header-section-number">7.1</span> Introduction</h2>
<p>In this notebook I’m trying to build a “minimum viable project” (MVP) that answers the following research questions:</p>
<ul>
<li><strong>RQ1:</strong> When using a dataset to build a model to predict review ratings based on review sentiment, how does accuracy vary with the <em>number</em> of reviews (volume)?</li>
<li><strong>RQ2:</strong> When using a dataset to build a model to predict review ratings based on review sentiment, how does accuracy vary with the <em>word length</em> of those reviews?</li>
</ul>
<p>Building on the last section, I will use a logistic regression to create a <em>classification model</em> to predict Yelp reviews’ star ratings based on their sentiment as measured by AFINN. I will divide ratings into positive (“POS”) and negative (“NEG”) reviews, again following <span class="citation">Liu (<a href="#ref-liu_sentiment_2015" role="doc-biblioref">2015</a>)</span>’s recommendation, and use the approaches outlined in <span class="citation">Silge and Hvitfeldt (<a href="#ref-silge_supervised_2020" role="doc-biblioref">2020</a>)</span> and <span class="citation">Silge and Robinson (<a href="#ref-silge_text_2020" role="doc-biblioref">2020</a>)</span>. In some cases I have used examples or hints from websites like Stack Overflow, and I’ve noted that where applicable.</p>
</div>
<div id="preparing-the-data" class="section level2">
<h2><span class="header-section-number">7.2</span> Preparing the Data</h2>
<p>I will again work with the large Yelp dataset available <a href="https://www.kaggle.com/yelp-dataset/yelp-dataset">at this link</a>, this time loading the first 500k reviews:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb280-1"></a><span class="co"># figure out how to do it reading between the lines of this stackoverflow:</span></span>
<span id="cb280-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb280-2"></a><span class="co"># https://stackoverflow.com/questions/53277351/read-first-1000-lines-from-very-big-json-lines-file-r</span></span>
<span id="cb280-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb280-3"></a></span>
<span id="cb280-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb280-4"></a>yelp_big &lt;-<span class="st"> </span><span class="kw">readLines</span>(<span class="st">&quot;../tests/data/yelp_academic_dataset_review.json&quot;</span>, <span class="dt">n =</span> <span class="dv">500000</span>) <span class="op">%&gt;%</span></span>
<span id="cb280-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb280-5"></a><span class="st">  </span><span class="kw">textConnection</span>() <span class="op">%&gt;%</span></span>
<span id="cb280-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb280-6"></a><span class="st">  </span>jsonlite<span class="op">::</span><span class="kw">stream_in</span>(<span class="dt">verbose=</span><span class="ot">FALSE</span>)</span>
<span id="cb280-7"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb280-7"></a></span>
<span id="cb280-8"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb280-8"></a>yelp_big &lt;-<span class="st"> </span>yelp_big <span class="op">%&gt;%</span></span>
<span id="cb280-9"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb280-9"></a><span class="st">  </span><span class="kw">select</span>(stars, text)</span></code></pre></div>
<p>Plotting a histogram in Figure <a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#fig:yelp-big-hist2">7.1</a>, we see the now-familiar distribution of a slight bump at 1 star followed by an exponential increase towards 5 stars.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb281-1"></a>yelp_big <span class="op">%&gt;%</span></span>
<span id="cb281-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb281-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>stars)) <span class="op">+</span></span>
<span id="cb281-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb281-3"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins=</span><span class="dv">5</span>) <span class="op">+</span></span>
<span id="cb281-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb281-4"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb281-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb281-5"></a>    <span class="dt">title =</span> <span class="kw">paste0</span>(<span class="st">&quot;Large Yelp Dataset (n=&quot;</span>,<span class="kw">nrow</span>(yelp_big),<span class="st">&quot;)&quot;</span>),</span>
<span id="cb281-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb281-6"></a>    <span class="dt">x =</span> <span class="st">&quot;Stars&quot;</span>,</span>
<span id="cb281-7"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb281-7"></a>    <span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>) <span class="op">+</span></span>
<span id="cb281-8"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb281-8"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<div class="figure"><span id="fig:yelp-big-hist2"></span>
<img src="telfer-mba-nlp_files/figure-html/yelp-big-hist2-1.png" alt="Histogram of star ratings for the large Yelp dataset." width="672" />
<p class="caption">
Figure 7.1: Histogram of star ratings for the large Yelp dataset.
</p>
</div>
<p>Let’s classify the reviews into NEG and POS again, once more classifying reviews with fewer than 3 stars as negative, more than 3 stars as positive, and discarding reviews with 3 stars.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb282-1"></a>yelp_big_factor &lt;-<span class="st"> </span>yelp_big <span class="op">%&gt;%</span></span>
<span id="cb282-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb282-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rating_factor =</span> <span class="kw">case_when</span>(</span>
<span id="cb282-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb282-3"></a>    stars <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span> <span class="op">~</span><span class="st"> &quot;NEG&quot;</span>,</span>
<span id="cb282-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb282-4"></a>    stars <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span> <span class="op">~</span><span class="st"> &quot;POS&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb282-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb282-5"></a><span class="st">      </span><span class="kw">as.factor</span>()</span>
<span id="cb282-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb282-6"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb282-7"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb282-7"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>stars) <span class="op">%&gt;%</span></span>
<span id="cb282-8"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb282-8"></a><span class="st">  </span><span class="kw">drop_na</span>()</span>
<span id="cb282-9"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb282-9"></a></span>
<span id="cb282-10"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb282-10"></a>yelp_big_factor <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summary</span>()</span></code></pre></div>
<pre><code>##      text           rating_factor
##  Length:444222      NEG:111045   
##  Class :character   POS:333177   
##  Mode  :character</code></pre>
<p>Since we found that classification didn’t work well with an unbalanced dataset, we will downsample the dataset so that we have the same number of positive and negative reviews.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb284-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb284-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb284-2"></a>yelp_balanced &lt;-<span class="st"> </span>yelp_big_factor <span class="op">%&gt;%</span></span>
<span id="cb284-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb284-3"></a><span class="st">  </span><span class="kw">filter</span>(rating_factor <span class="op">==</span><span class="st"> &quot;NEG&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb284-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb284-4"></a><span class="st">  </span><span class="kw">bind_rows</span>(yelp_big_factor<span class="op">%&gt;%</span></span>
<span id="cb284-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb284-5"></a><span class="st">              </span><span class="kw">filter</span>(rating_factor <span class="op">==</span><span class="st"> &quot;POS&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb284-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb284-6"></a><span class="st">              </span><span class="kw">slice_sample</span>(<span class="dt">n=</span>yelp_big_factor <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(rating_factor <span class="op">==</span><span class="st"> &quot;NEG&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>() ))</span>
<span id="cb284-7"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb284-7"></a></span>
<span id="cb284-8"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb284-8"></a>yelp_balanced <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summary</span>()</span></code></pre></div>
<pre><code>##      text           rating_factor
##  Length:222090      NEG:111045   
##  Class :character   POS:111045   
##  Mode  :character</code></pre>
<p>Let’s try AFINN again on the balanced set. First we’ll get the AFINN sentiments for all our reviews.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb286-1"></a><span class="kw">tic</span>()</span>
<span id="cb286-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb286-2"></a>afinn_yelp_big &lt;-<span class="st"> </span>yelp_balanced <span class="op">%&gt;%</span></span>
<span id="cb286-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb286-3"></a><span class="st">  </span><span class="kw">rowid_to_column</span>() <span class="op">%&gt;%</span></span>
<span id="cb286-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb286-4"></a><span class="st">  </span>tidytext<span class="op">::</span><span class="kw">unnest_tokens</span>(word, text) <span class="op">%&gt;%</span></span>
<span id="cb286-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb286-5"></a><span class="st">  </span><span class="kw">left_join</span>(afinn) <span class="op">%&gt;%</span></span>
<span id="cb286-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb286-6"></a><span class="st">  </span><span class="kw">group_by</span>(rowid) <span class="op">%&gt;%</span></span>
<span id="cb286-7"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb286-7"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">afinn_sent =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> T))</span>
<span id="cb286-8"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb286-8"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>## 71.83 sec elapsed</code></pre>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb288-1"></a>yelp_big_bal_afinn &lt;-<span class="st"> </span>afinn_yelp_big <span class="op">%&gt;%</span></span>
<span id="cb288-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb288-2"></a><span class="st">  </span><span class="kw">left_join</span>(yelp_balanced <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowid_to_column</span>()) <span class="op">%&gt;%</span></span>
<span id="cb288-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb288-3"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>rowid)</span></code></pre></div>
<p>The density plot in Figure <a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#fig:big-yelp-density2">7.2</a> shows that NEG and POS reviews still have overlapping but different distributions in this dataset, which suggests that our model might reasonably be able to tell them apart.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb289-1"></a>yelp_big_bal_afinn <span class="op">%&gt;%</span></span>
<span id="cb289-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb289-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>afinn_sent, <span class="dt">fill=</span>rating_factor)) <span class="op">+</span></span>
<span id="cb289-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb289-3"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">alpha=</span><span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb289-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb289-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="co">#title = &quot;Density Distributions of AFINN Sentiment for POS and NEG Reviews&quot;,</span></span>
<span id="cb289-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb289-5"></a>    <span class="dt">title =</span> <span class="kw">paste0</span>(<span class="st">&quot;Large Balanced Yelp Dataset (n=&quot;</span>,<span class="kw">nrow</span>(yelp_big_bal_afinn),<span class="st">&quot;)&quot;</span>),</span>
<span id="cb289-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb289-6"></a>    <span class="dt">x =</span> <span class="st">&quot;AFINN Sentiment&quot;</span>,</span>
<span id="cb289-7"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb289-7"></a>    <span class="dt">y =</span><span class="st">&quot;Density&quot;</span>,</span>
<span id="cb289-8"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb289-8"></a>    <span class="dt">fill=</span><span class="st">&quot;Sentiment&quot;</span>) <span class="op">+</span></span>
<span id="cb289-9"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb289-9"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<div class="figure"><span id="fig:big-yelp-density2"></span>
<img src="telfer-mba-nlp_files/figure-html/big-yelp-density2-1.png" alt="Density Distributions of AFINN Sentiment for POS and NEG Reviews." width="672" />
<p class="caption">
Figure 7.2: Density Distributions of AFINN Sentiment for POS and NEG Reviews.
</p>
</div>
<p>We will now compute the word length for each review so we can see how review length affects our predictions. As we can see in Figure <a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#fig:wordcounts-bigyelp">7.3</a>, most of our reviews are quite short–roughly 200,0000 are under 250 words–but a few extend beyond 1000 words.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb290-1"></a>wordcounts_yp &lt;-<span class="st"> </span>yelp_big_bal_afinn <span class="op">%&gt;%</span></span>
<span id="cb290-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb290-2"></a><span class="st">  </span><span class="kw">select</span>(text) <span class="op">%&gt;%</span></span>
<span id="cb290-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb290-3"></a><span class="st">  </span><span class="kw">rowid_to_column</span>() <span class="op">%&gt;%</span></span>
<span id="cb290-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb290-4"></a><span class="st">  </span>tidytext<span class="op">::</span><span class="kw">unnest_tokens</span>(word, text) <span class="op">%&gt;%</span></span>
<span id="cb290-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb290-5"></a><span class="st">  </span><span class="kw">group_by</span>(rowid) <span class="op">%&gt;%</span></span>
<span id="cb290-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb290-6"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></span>
<span id="cb290-7"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb290-7"></a><span class="st">  </span><span class="kw">arrange</span>(n)  <span class="op">%&gt;%</span></span>
<span id="cb290-8"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb290-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="dv">1</span>,</span>
<span id="cb290-9"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb290-9"></a>         <span class="dt">cumdist =</span> <span class="kw">cumsum</span>(id)) </span>
<span id="cb290-10"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb290-10"></a></span>
<span id="cb290-11"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb290-11"></a>wordcounts_yp <span class="op">%&gt;%</span></span>
<span id="cb290-12"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb290-12"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb290-13"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb290-13"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y=</span>cumdist, <span class="dt">x=</span>n)) <span class="op">+</span></span>
<span id="cb290-14"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb290-14"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb290-15"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb290-15"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span><span class="kw">paste0</span>(<span class="st">&quot;Large Yelp Dataset (n=&quot;</span>,<span class="kw">nrow</span>(yelp_big_bal_afinn),<span class="st">&quot;)&quot;</span>), <span class="co">#: Cumulative Distribution of Word-Lengths&quot;,</span></span>
<span id="cb290-16"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb290-16"></a>       <span class="dt">x =</span> <span class="st">&quot;Word Length&quot;</span>,</span>
<span id="cb290-17"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb290-17"></a>       <span class="dt">y =</span> <span class="st">&quot;# of Reviews&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:wordcounts-bigyelp"></span>
<img src="telfer-mba-nlp_files/figure-html/wordcounts-bigyelp-1.png" alt="Large Yelp Dataset: Cumulative distribution of word lengths." width="672" />
<p class="caption">
Figure 7.3: Large Yelp Dataset: Cumulative distribution of word lengths.
</p>
</div>
<p>Next we’ll join the word-length column to our balanced Yelp dataset, completing the pre-processing.</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb291-1"></a>yelp_data &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(</span>
<span id="cb291-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb291-2"></a>  yelp_big_bal_afinn,</span>
<span id="cb291-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb291-3"></a>  wordcounts_yp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb291-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb291-4"></a><span class="st">    </span><span class="kw">arrange</span>(rowid) <span class="op">%&gt;%</span></span>
<span id="cb291-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb291-5"></a><span class="st">    </span><span class="kw">select</span>(<span class="dt">words =</span> n)</span>
<span id="cb291-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb291-6"></a>)</span></code></pre></div>
</div>
<div id="experiment-1-logistic-regression-on-globally-balanced-data" class="section level2">
<h2><span class="header-section-number">7.3</span> Experiment 1: Logistic Regression on Globally Balanced Data</h2>
<p>In this section we will look at how review length and volume affect classification accuracy using a logistic regression based on review sentiment. I will divide the data into <span class="math inline">\(n\)</span> non-overlapping subsets based on their lengths, and then I will divide those subsets into <span class="math inline">\(n\)</span> overlapping subsets of increased size, and then will run a logistic regression on each of these latter subsets. The output will be an <span class="math inline">\(n\times n\)</span> matrix plotted as a heat map where each cell represents model accuracy for a given number of reviews with lengths within a given range.</p>
<p>More precisely, here are the steps I will follow:</p>
<ul>
<li>Choose a number of quantiles <span class="math inline">\(n\)</span>, and divide reviews into <span class="math inline">\(n\)</span> quantiles by word length.</li>
<li>Find how many reviews are in each quantile. Take the smallest total number of reviews <span class="math inline">\(mintotal\)</span>: for comparability, this is the largest number of reviews we will consider.</li>
<li>Within each quantile, consider <span class="math inline">\(n\)</span> overlapping subsets of increasing size ranging from <span class="math inline">\(mintotal/n\)</span> to <span class="math inline">\(mintotal\)</span>.</li>
<li>For each quantile, for each group of reviews, run a logistic regression to predict review ratings and log its accuracy.</li>
</ul>
<p>After some initial experimentation, I’ve chosen to use <span class="math inline">\(n=5\)</span> quantiles since it gives us a good number of subsets of reasonable size.</p>
<p>First, we set up a function to run a logistic regression on an arbitrary dataset and return the prediction accuracy. This is a functionized version of the code I used earlier.</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-1"></a>do_logit &lt;-<span class="st"> </span><span class="cf">function</span> (dataset) {</span>
<span id="cb292-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-2"></a></span>
<span id="cb292-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-3"></a>  <span class="co"># for a train/test split: get a random vector as long as our dataset that is 75% TRUE and 25% FALSEe.</span></span>
<span id="cb292-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-4"></a>  index &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(T,F), </span>
<span id="cb292-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-5"></a>                  <span class="dt">size =</span> <span class="kw">nrow</span>(dataset),</span>
<span id="cb292-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-6"></a>                  <span class="dt">replace =</span> T,</span>
<span id="cb292-7"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-7"></a>                  <span class="dt">prob=</span><span class="kw">c</span>(<span class="fl">0.75</span>,<span class="fl">0.25</span>))</span>
<span id="cb292-8"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-8"></a>  </span>
<span id="cb292-9"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-9"></a>  <span class="co"># extract train and test datasets by indexing our dataset using our random index</span></span>
<span id="cb292-10"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-10"></a>  train &lt;-<span class="st"> </span>dataset[index,]</span>
<span id="cb292-11"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-11"></a>  test &lt;-<span class="st"> </span>dataset[<span class="op">!</span>index,]</span>
<span id="cb292-12"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-12"></a>  </span>
<span id="cb292-13"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-13"></a>  <span class="co"># use `glm()` to run a logistic regression predicting the rating factor based on the AFINN score.</span></span>
<span id="cb292-14"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-14"></a>  logit &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="dt">data=</span> train,</span>
<span id="cb292-15"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-15"></a>               <span class="dt">formula=</span> rating_factor <span class="op">~</span><span class="st"> </span>afinn_sent,</span>
<span id="cb292-16"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-16"></a>               <span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb292-17"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-17"></a>  </span>
<span id="cb292-18"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-18"></a>  pred &lt;-<span class="st"> </span><span class="kw">predict</span>(logit, </span>
<span id="cb292-19"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-19"></a>                  <span class="dt">newdata =</span> test,</span>
<span id="cb292-20"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-20"></a>                  <span class="dt">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb292-21"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-21"></a>  </span>
<span id="cb292-22"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-22"></a>  <span class="co"># now predict the outcome based on whichever has the greater probability, find out if each prediction is correct, and compute the accuracy</span></span>
<span id="cb292-23"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-23"></a>  test_results &lt;-<span class="st"> </span>test <span class="op">%&gt;%</span></span>
<span id="cb292-24"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-24"></a><span class="st">    </span><span class="kw">bind_cols</span>(<span class="kw">tibble</span>(<span class="dt">pred =</span> pred)) <span class="op">%&gt;%</span></span>
<span id="cb292-25"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-25"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">pred =</span> <span class="kw">if_else</span>(pred <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="st">&quot;POS&quot;</span>, <span class="st">&quot;NEG&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb292-26"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-26"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">correct =</span> <span class="kw">if_else</span> (pred <span class="op">==</span><span class="st"> </span>rating_factor, T, F)) <span class="op">%&gt;%</span></span>
<span id="cb292-27"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-27"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">accuracy =</span> <span class="kw">sum</span>(correct) <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(.)) <span class="op">%&gt;%</span></span>
<span id="cb292-28"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-28"></a><span class="st">    </span><span class="kw">unlist</span>()</span>
<span id="cb292-29"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-29"></a>  </span>
<span id="cb292-30"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-30"></a>  <span class="kw">return</span> (test_results)</span>
<span id="cb292-31"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb292-31"></a>}</span></code></pre></div>
<p>It’s not quite “tidy,” but we can run this analysis easily with two nested for loops. Here I break the reviews into 5 quantiles by word length, and then break each quantile down into 5 overlapping subsets of increasing length.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-1"></a><span class="co"># for reproducibility, set the random number generator seed</span></span>
<span id="cb293-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-2"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb293-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-3"></a></span>
<span id="cb293-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-4"></a><span class="co"># how many quantiles?</span></span>
<span id="cb293-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-5"></a>num_qtiles &lt;-<span class="st"> </span><span class="dv">5</span></span>
<span id="cb293-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-6"></a></span>
<span id="cb293-7"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-7"></a><span class="co"># get the limits of the word-quantiles for display purposes</span></span>
<span id="cb293-8"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-8"></a>qtiles &lt;-<span class="st"> </span><span class="kw">quantile</span>(yelp_data<span class="op">$</span>words, <span class="dt">probs =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, (<span class="dv">1</span><span class="op">/</span>num_qtiles)))</span>
<span id="cb293-9"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-9"></a></span>
<span id="cb293-10"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-10"></a><span class="co"># find the word-quantile for each review using the fabricatr::split_quantile() function</span></span>
<span id="cb293-11"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-11"></a>yelp_data &lt;-<span class="st"> </span>yelp_data <span class="op">%&gt;%</span></span>
<span id="cb293-12"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-12"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">qtile =</span> fabricatr<span class="op">::</span><span class="kw">split_quantile</span>(words, </span>
<span id="cb293-13"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-13"></a>                                           <span class="dt">type=</span>num_qtiles))</span>
<span id="cb293-14"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-14"></a></span>
<span id="cb293-15"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-15"></a><span class="co"># get the number of reviews in the smallest quantile.</span></span>
<span id="cb293-16"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-16"></a><span class="co"># we&#39;re going to use this to compare groups of the same/similar size.</span></span>
<span id="cb293-17"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-17"></a>minn &lt;-<span class="st"> </span>yelp_data <span class="op">%&gt;%</span></span>
<span id="cb293-18"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-18"></a><span class="st">  </span><span class="kw">group_by</span>(qtile) <span class="op">%&gt;%</span></span>
<span id="cb293-19"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-19"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></span>
<span id="cb293-20"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-20"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">minn =</span> <span class="kw">min</span>(n)) <span class="op">%&gt;%</span></span>
<span id="cb293-21"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-21"></a><span class="st">  </span><span class="kw">unlist</span>()</span>
<span id="cb293-22"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-22"></a></span>
<span id="cb293-23"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-23"></a><span class="co"># set up an empty results tibble.</span></span>
<span id="cb293-24"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-24"></a>results &lt;-<span class="st"> </span><span class="kw">tibble</span>()</span>
<span id="cb293-25"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-25"></a></span>
<span id="cb293-26"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-26"></a><span class="co"># boolean flag: will we print updates to the console?</span></span>
<span id="cb293-27"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-27"></a><span class="co"># I used this for testing but it should be disabled in the final knit</span></span>
<span id="cb293-28"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-28"></a>verbose &lt;-<span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb293-29"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-29"></a></span>
<span id="cb293-30"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-30"></a><span class="kw">tic</span>()</span>
<span id="cb293-31"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-31"></a><span class="co"># Consider each quantile of review word lengths one at a time</span></span>
<span id="cb293-32"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-32"></a><span class="cf">for</span> (word_qtile <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>num_qtiles){</span>
<span id="cb293-33"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-33"></a>  <span class="co"># within each quantile of reviews broken down by length, consider several different numbers of reviews</span></span>
<span id="cb293-34"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-34"></a>  <span class="cf">for</span> (num_qtile <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>num_qtiles){</span>
<span id="cb293-35"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-35"></a>    </span>
<span id="cb293-36"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-36"></a>    <span class="co"># number of reviews we will consider in this iteration.</span></span>
<span id="cb293-37"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-37"></a>    num_reviews &lt;-<span class="st"> </span>num_qtile <span class="op">*</span><span class="st"> </span>minn<span class="op">/</span>num_qtiles</span>
<span id="cb293-38"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-38"></a>    </span>
<span id="cb293-39"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-39"></a>    <span class="co"># message for me to keep track</span></span>
<span id="cb293-40"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-40"></a>    <span class="cf">if</span> (verbose <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) {</span>
<span id="cb293-41"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-41"></a>      <span class="kw">message</span> (<span class="kw">paste0</span>(<span class="st">&quot;Considering &quot;</span>, num_reviews, <span class="st">&quot; reviews with word length in the range (&quot;</span>,qtiles[[word_qtile]],<span class="st">&quot;,&quot;</span>,qtiles[[word_qtile<span class="op">+</span><span class="dv">1</span>]],<span class="st">&quot;)&quot;</span>))</span>
<span id="cb293-42"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-42"></a>    }</span>
<span id="cb293-43"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-43"></a>    </span>
<span id="cb293-44"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-44"></a>    <span class="co"># filter the rows we want: the right number of words, and the right number of reviews, then run a logistic regression on them</span></span>
<span id="cb293-45"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-45"></a>    data_for_logit &lt;-<span class="st"> </span>yelp_data <span class="op">%&gt;%</span></span>
<span id="cb293-46"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-46"></a><span class="st">      </span><span class="kw">filter</span>(qtile<span class="op">==</span>word_qtile) <span class="op">%&gt;%</span></span>
<span id="cb293-47"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-47"></a><span class="st">      </span><span class="kw">slice_sample</span>(<span class="dt">n =</span> num_reviews) </span>
<span id="cb293-48"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-48"></a>    </span>
<span id="cb293-49"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-49"></a>    <span class="co"># get true percentage of positives, so we can look at sample balance</span></span>
<span id="cb293-50"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-50"></a>    pct_true_pos &lt;-<span class="st"> </span>data_for_logit <span class="op">%&gt;%</span></span>
<span id="cb293-51"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-51"></a><span class="st">      </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">sum</span>(rating_factor <span class="op">==</span><span class="st"> &quot;POS&quot;</span>) <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(.)) <span class="op">%&gt;%</span></span>
<span id="cb293-52"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-52"></a><span class="st">      </span><span class="kw">unlist</span>()</span>
<span id="cb293-53"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-53"></a>    </span>
<span id="cb293-54"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-54"></a>    <span class="co"># run the logistic regression on our data</span></span>
<span id="cb293-55"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-55"></a>    result &lt;-<span class="st"> </span>data_for_logit <span class="op">%&gt;%</span></span>
<span id="cb293-56"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-56"></a><span class="st">      </span><span class="kw">do_logit</span>()</span>
<span id="cb293-57"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-57"></a>    </span>
<span id="cb293-58"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-58"></a>    <span class="co"># add our result to our results tibble. this wouldn&#39;t be best practice for thousands of rows, but it&#39;s fine here.</span></span>
<span id="cb293-59"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-59"></a>    results &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(</span>
<span id="cb293-60"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-60"></a>      results,</span>
<span id="cb293-61"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-61"></a>      <span class="kw">tibble</span>(<span class="dt">word_qtile =</span> word_qtile,</span>
<span id="cb293-62"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-62"></a>             <span class="dt">num_qtile =</span> num_qtile,</span>
<span id="cb293-63"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-63"></a>             <span class="dt">accuracy =</span> result,</span>
<span id="cb293-64"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-64"></a>             <span class="dt">pct_true_pos =</span> pct_true_pos)</span>
<span id="cb293-65"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-65"></a>    )</span>
<span id="cb293-66"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-66"></a>  }</span>
<span id="cb293-67"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-67"></a>}</span>
<span id="cb293-68"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb293-68"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>## 2.75 sec elapsed</code></pre>
<p>The code runs quickly (&lt;5s on my machine) and gives some interesting-looking results shown below in Figure <a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#fig:plot-first-heatmap">7.4</a>. First, all of the accuracy metrics are quite high: our success rates ranged from around 80% to 86%. But interestingly, it looks like we get better results from <em>shorter</em> reviews!</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb295-1"></a>results <span class="op">%&gt;%</span></span>
<span id="cb295-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb295-2"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb295-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb295-3"></a><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">x=</span>word_qtile, <span class="dt">y=</span>num_qtile, <span class="dt">fill=</span>accuracy)) <span class="op">+</span></span>
<span id="cb295-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb295-4"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span>num_qtiles, </span>
<span id="cb295-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb295-5"></a>                     <span class="dt">labels =</span> <span class="kw">paste0</span>(<span class="st">&quot;Q&quot;</span>,<span class="dv">1</span><span class="op">:</span>num_qtiles,<span class="st">&quot;: &quot;</span>,qtiles, <span class="st">&quot;-&quot;</span>,<span class="kw">lead</span>(qtiles)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="op">-</span><span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb295-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb295-6"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span>num_qtiles,</span>
<span id="cb295-7"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb295-7"></a>                     <span class="dt">labels =</span> (<span class="dv">1</span><span class="op">:</span>num_qtiles <span class="op">*</span><span class="st"> </span>minn<span class="op">/</span>num_qtiles)) <span class="op">+</span></span>
<span id="cb295-8"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb295-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Review Word Length by Quantile&quot;</span>,</span>
<span id="cb295-9"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb295-9"></a>       <span class="dt">y =</span> <span class="st">&quot;Number of Reviews&quot;</span>,</span>
<span id="cb295-10"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb295-10"></a>       <span class="dt">fill =</span> <span class="st">&quot;Accuracy&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:plot-first-heatmap"></span>
<img src="telfer-mba-nlp_files/figure-html/plot-first-heatmap-1.png" alt="Heat map of logistic regression prediction accuracy for the large balanced Yelp dataset." width="672" />
<p class="caption">
Figure 7.4: Heat map of logistic regression prediction accuracy for the large balanced Yelp dataset.
</p>
</div>
<p>However, before drawing conclusions we should look more closely at the data. As we can see below in Figure <a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#fig:show-unbalanced">7.5</a>, there is a big difference in each quantile’s true positive rate. And based just on visual inspection, it looks like higher true positive rates in Figure <a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#fig:show-unbalanced">7.5</a> are correlated with higher prediction accuracy rates in Figure <a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#fig:plot-first-heatmap">7.4</a>.</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb296-1"></a>results <span class="op">%&gt;%</span></span>
<span id="cb296-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb296-2"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb296-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb296-3"></a><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">x=</span>word_qtile, <span class="dt">y=</span>num_qtile, <span class="dt">fill=</span>pct_true_pos)) <span class="op">+</span></span>
<span id="cb296-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb296-4"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span>num_qtiles, </span>
<span id="cb296-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb296-5"></a>                     <span class="dt">labels =</span> <span class="kw">paste0</span>(<span class="st">&quot;Q&quot;</span>,<span class="dv">1</span><span class="op">:</span>num_qtiles,<span class="st">&quot;: &quot;</span>,qtiles, <span class="st">&quot;-&quot;</span>,<span class="kw">lead</span>(qtiles)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="op">-</span><span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb296-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb296-6"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span>num_qtiles,</span>
<span id="cb296-7"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb296-7"></a>                     <span class="dt">labels =</span> (<span class="dv">1</span><span class="op">:</span>num_qtiles <span class="op">*</span><span class="st"> </span>minn<span class="op">/</span>num_qtiles)) <span class="op">+</span></span>
<span id="cb296-8"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb296-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Review Word Length by Quantile&quot;</span>,</span>
<span id="cb296-9"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb296-9"></a>       <span class="dt">y =</span> <span class="st">&quot;Number of Reviews&quot;</span>,</span>
<span id="cb296-10"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb296-10"></a>       <span class="dt">fill =</span> <span class="st">&quot;True Positive Rate&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:show-unbalanced"></span>
<img src="telfer-mba-nlp_files/figure-html/show-unbalanced-1.png" alt="Heat map of the percentage of true positive reviews in each quantile." width="672" />
<p class="caption">
Figure 7.5: Heat map of the percentage of true positive reviews in each quantile.
</p>
</div>
<p>We can confirm this intuition by plotting each subset’s true positive rate versus its quantile, as shown in Figure <a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#fig:qtile-true-ps">7.6</a>. We can see very strong correlation between the two variables. This correlation casts some doubt on the apparent results in Figure <a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#fig:plot-first-heatmap">7.4</a>, since we know from a previous experiment that an imbalanced dataset can lead to wonky predictions. Are we really seeing that shorter reviews lead to more accurate predictions, or are we actually seeing that datasets with higher true positive rates are easier to classify? There’s no easy way to disentangle this.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb297-1"></a>results <span class="op">%&gt;%</span></span>
<span id="cb297-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb297-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> word_qtile, <span class="dt">y  =</span>pct_true_pos)) <span class="op">+</span></span>
<span id="cb297-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb297-3"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb297-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb297-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span>  <span class="st">&quot;Review Word Length by Quantile&quot;</span>,</span>
<span id="cb297-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb297-5"></a>       <span class="dt">y =</span> <span class="st">&quot;True Positive Rate&quot;</span>) <span class="op">+</span></span>
<span id="cb297-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb297-6"></a><span class="st">    </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span>num_qtiles, </span>
<span id="cb297-7"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb297-7"></a>                     <span class="dt">labels =</span> <span class="kw">paste0</span>(<span class="st">&quot;Q&quot;</span>,<span class="dv">1</span><span class="op">:</span>num_qtiles,<span class="st">&quot;: &quot;</span>,qtiles, <span class="st">&quot;-&quot;</span>,<span class="kw">lead</span>(qtiles)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="op">-</span><span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb297-8"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb297-8"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<div class="figure"><span id="fig:qtile-true-ps"></span>
<img src="telfer-mba-nlp_files/figure-html/qtile-true-ps-1.png" alt="True positive rates vs. review lengths for each subset, showing strong correlation." width="672" />
<p class="caption">
Figure 7.6: True positive rates vs. review lengths for each subset, showing strong correlation.
</p>
</div>
<p>However, since our predictions were reasonably accurate (80%-86%) across a wide range of true-positive rates (0.35-0.65), we can draw one positive preliminary conclusion from this experiment:</p>
<p><strong>Preliminary Conclusion:</strong> Logistic regression based on AFINN sentiment provides an accurate (&gt;80%) method of predicting review sentiment on datasets across a wide range of word lengths, review counts, and true-positive rates.</p>
<p>This is good news, but the confounding effect of the true-positive rates means we don’t have a direct answer to our original question of how accuracy varies with review length and volume. This will require some additional processing so that we can operate on a collection of balanced sub-sets.</p>
</div>
<div id="experiment-2-logistic-regression-on-micro-balanced-data" class="section level2">
<h2><span class="header-section-number">7.4</span> Experiment 2: Logistic Regression on Micro-Balanced Data</h2>
<p>In this experiment, I will address the correlation between each data subset’s true-positive rate and review length by further balancing each subset. This probably has a technical name, but here I will call it “micro-balancing.” The rest of the algorithm will be the same.</p>
<p>Recall that in Experiment 1 above, we found that our data sub-sets were imbalanced between positive and negative reviews. This suggests that reviews tend to differ in length according to their sentiment, and as we can see in Figure <a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#fig:plot-ecdfs">7.7</a>, negative reviews do tend to be longer than positive reviews.</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb298-1"></a>yelp_data <span class="op">%&gt;%</span></span>
<span id="cb298-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb298-2"></a><span class="st">  </span><span class="kw">filter</span>(rating_factor <span class="op">==</span><span class="st"> &quot;POS&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(words) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ecdf</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb298-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb298-3"></a><span class="st">  </span><span class="kw">plot</span>(<span class="dt">col=</span><span class="st">&quot;green&quot;</span>,</span>
<span id="cb298-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb298-4"></a>       <span class="dt">main =</span> <span class="st">&quot;ECDF for POS (green) and NEG (red) reviews&quot;</span>,</span>
<span id="cb298-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb298-5"></a>       <span class="dt">xlab =</span> <span class="st">&quot;Review Length&quot;</span>,</span>
<span id="cb298-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb298-6"></a>       <span class="dt">ylab =</span> <span class="st">&quot;Proportion&quot;</span>)</span>
<span id="cb298-7"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb298-7"></a>yelp_data <span class="op">%&gt;%</span></span>
<span id="cb298-8"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb298-8"></a><span class="st">  </span><span class="kw">filter</span>(rating_factor <span class="op">==</span><span class="st"> &quot;NEG&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(words) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ecdf</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">lines</span>(<span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:plot-ecdfs"></span>
<img src="telfer-mba-nlp_files/figure-html/plot-ecdfs-1.png" alt="Empirical cumulative distribution function for lengths of positive and negative reviews." width="672" />
<p class="caption">
Figure 7.7: Empirical cumulative distribution function for lengths of positive and negative reviews.
</p>
</div>
<p>The simplest approach is to further downsample the data so that each subset is of the same size and balanced between positive and negative reviews. The following code block runs largely the same analysis as in Experiment 1, except this time I balance each data subset by downsampling before running through a logistic regression. To ensure that all samples are the same size, I first find the smallest number of positive or negative reviews in any subset. Then, in each step of the analysis I randomly downsample the positive and negative reviews to have exactly this many entries.</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-1"></a><span class="co"># for reproducibility, set the random number generator seed</span></span>
<span id="cb299-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-2"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb299-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-3"></a></span>
<span id="cb299-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-4"></a><span class="co"># how many quantiles?</span></span>
<span id="cb299-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-5"></a>num_qtiles &lt;-<span class="st"> </span><span class="dv">5</span></span>
<span id="cb299-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-6"></a></span>
<span id="cb299-7"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-7"></a><span class="co"># get the limits of the word-quantiles for display purposes</span></span>
<span id="cb299-8"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-8"></a>qtiles &lt;-<span class="st"> </span><span class="kw">quantile</span>(yelp_data<span class="op">$</span>words, <span class="dt">probs =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, (<span class="dv">1</span><span class="op">/</span>num_qtiles)))</span>
<span id="cb299-9"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-9"></a></span>
<span id="cb299-10"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-10"></a><span class="co"># find the word-quantile for each review using the fabricatr::split_quantile() function</span></span>
<span id="cb299-11"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-11"></a>yelp_data &lt;-<span class="st"> </span>yelp_data <span class="op">%&gt;%</span></span>
<span id="cb299-12"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-12"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">qtile =</span> fabricatr<span class="op">::</span><span class="kw">split_quantile</span>(words, </span>
<span id="cb299-13"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-13"></a>                                           <span class="dt">type=</span>num_qtiles))</span>
<span id="cb299-14"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-14"></a></span>
<span id="cb299-15"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-15"></a><span class="co"># get the number of reviews in the smallest subset of BOTH rating and length quintile.</span></span>
<span id="cb299-16"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-16"></a><span class="co"># we&#39;re going to use this to compare groups of the same/similar size.</span></span>
<span id="cb299-17"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-17"></a>minn &lt;-<span class="st"> </span>yelp_data <span class="op">%&gt;%</span></span>
<span id="cb299-18"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-18"></a><span class="st">  </span><span class="kw">group_by</span>(qtile, rating_factor) <span class="op">%&gt;%</span></span>
<span id="cb299-19"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-19"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></span>
<span id="cb299-20"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-20"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb299-21"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-21"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">minn =</span> <span class="kw">min</span>(n)) <span class="op">%&gt;%</span></span>
<span id="cb299-22"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb299-22"></a><span class="st">  </span><span class="kw">unlist</span>()</span></code></pre></div>
<pre><code>## `summarise()` regrouping output by &#39;qtile&#39; (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-1"></a><span class="co"># set up an empty results tibble.</span></span>
<span id="cb301-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-2"></a>results &lt;-<span class="st"> </span><span class="kw">tibble</span>()</span>
<span id="cb301-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-3"></a></span>
<span id="cb301-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-4"></a><span class="co"># boolean flag: will we print updates to the console?</span></span>
<span id="cb301-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-5"></a><span class="co"># I used this for testing but it should be disabled in the final knit</span></span>
<span id="cb301-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-6"></a>verbose &lt;-<span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb301-7"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-7"></a></span>
<span id="cb301-8"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-8"></a><span class="kw">tic</span>()</span>
<span id="cb301-9"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-9"></a><span class="co"># Consider each quantile of review word lengths one at a time</span></span>
<span id="cb301-10"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-10"></a><span class="cf">for</span> (word_qtile <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>num_qtiles){</span>
<span id="cb301-11"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-11"></a>  <span class="co"># within each quantile of reviews broken down by length, consider several different numbers of reviews</span></span>
<span id="cb301-12"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-12"></a>  <span class="cf">for</span> (num_qtile <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>num_qtiles){</span>
<span id="cb301-13"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-13"></a>    </span>
<span id="cb301-14"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-14"></a>    <span class="co"># number of reviews we will consider in this iteration.</span></span>
<span id="cb301-15"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-15"></a>    num_reviews &lt;-<span class="st"> </span>num_qtile <span class="op">*</span><span class="st"> </span>minn<span class="op">/</span>num_qtiles</span>
<span id="cb301-16"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-16"></a>    </span>
<span id="cb301-17"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-17"></a>    <span class="co"># message for me to keep track</span></span>
<span id="cb301-18"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-18"></a>    <span class="cf">if</span> (verbose <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) {</span>
<span id="cb301-19"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-19"></a>      <span class="kw">message</span> (<span class="kw">paste0</span>(<span class="st">&quot;Considering &quot;</span>, num_reviews<span class="op">*</span><span class="dv">2</span>, <span class="st">&quot; reviews with word length in the range (&quot;</span>,qtiles[[word_qtile]],<span class="st">&quot;,&quot;</span>,qtiles[[word_qtile<span class="op">+</span><span class="dv">1</span>]],<span class="st">&quot;)&quot;</span>))</span>
<span id="cb301-20"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-20"></a>    }</span>
<span id="cb301-21"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-21"></a>    </span>
<span id="cb301-22"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-22"></a>    <span class="co"># I&#39;m doing this in two steps to keep it simple, since we need to get the same number of positive and negative reviews.</span></span>
<span id="cb301-23"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-23"></a>    <span class="co"># First, filter the positive rows we want: the right number of words, and the right number of reviews</span></span>
<span id="cb301-24"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-24"></a>    data_pos &lt;-<span class="st"> </span>yelp_data <span class="op">%&gt;%</span></span>
<span id="cb301-25"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-25"></a><span class="st">      </span><span class="kw">filter</span>(qtile <span class="op">==</span><span class="st"> </span>word_qtile) <span class="op">%&gt;%</span></span>
<span id="cb301-26"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-26"></a><span class="st">      </span><span class="kw">filter</span>(rating_factor <span class="op">==</span><span class="st"> &quot;POS&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb301-27"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-27"></a><span class="st">      </span><span class="kw">slice_sample</span>(<span class="dt">n =</span> num_reviews)</span>
<span id="cb301-28"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-28"></a>    </span>
<span id="cb301-29"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-29"></a>    <span class="co"># Then filter the negative rows we want:</span></span>
<span id="cb301-30"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-30"></a>    data_neg &lt;-<span class="st"> </span>yelp_data <span class="op">%&gt;%</span></span>
<span id="cb301-31"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-31"></a><span class="st">      </span><span class="kw">filter</span>(qtile <span class="op">==</span><span class="st"> </span>word_qtile) <span class="op">%&gt;%</span></span>
<span id="cb301-32"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-32"></a><span class="st">      </span><span class="kw">filter</span>(rating_factor <span class="op">==</span><span class="st"> &quot;NEG&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb301-33"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-33"></a><span class="st">      </span><span class="kw">slice_sample</span>(<span class="dt">n =</span> num_reviews)</span>
<span id="cb301-34"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-34"></a>    </span>
<span id="cb301-35"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-35"></a>    <span class="co"># then combine the positive and negative rows.</span></span>
<span id="cb301-36"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-36"></a>    data_for_logit &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(data_pos, data_neg) </span>
<span id="cb301-37"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-37"></a>    </span>
<span id="cb301-38"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-38"></a>    <span class="co"># get true percentage of positives, so we can look at sample balance</span></span>
<span id="cb301-39"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-39"></a>    pct_true_pos &lt;-<span class="st"> </span>data_for_logit <span class="op">%&gt;%</span></span>
<span id="cb301-40"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-40"></a><span class="st">      </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">sum</span>(rating_factor <span class="op">==</span><span class="st"> &quot;POS&quot;</span>) <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(.)) <span class="op">%&gt;%</span></span>
<span id="cb301-41"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-41"></a><span class="st">      </span><span class="kw">unlist</span>()</span>
<span id="cb301-42"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-42"></a>    </span>
<span id="cb301-43"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-43"></a>    <span class="co"># run the logistic regression on our data</span></span>
<span id="cb301-44"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-44"></a>    result &lt;-<span class="st"> </span>data_for_logit <span class="op">%&gt;%</span></span>
<span id="cb301-45"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-45"></a><span class="st">      </span><span class="kw">do_logit</span>()</span>
<span id="cb301-46"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-46"></a>    </span>
<span id="cb301-47"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-47"></a>    <span class="co"># add our result to our results tibble. this wouldn&#39;t be best practice for thousands of rows, but it&#39;s fine here.</span></span>
<span id="cb301-48"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-48"></a>    results &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(</span>
<span id="cb301-49"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-49"></a>      results,</span>
<span id="cb301-50"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-50"></a>      <span class="kw">tibble</span>(<span class="dt">word_qtile =</span> word_qtile,</span>
<span id="cb301-51"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-51"></a>             <span class="dt">num_qtile =</span> num_qtile,</span>
<span id="cb301-52"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-52"></a>             <span class="dt">accuracy =</span> result,</span>
<span id="cb301-53"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-53"></a>             <span class="dt">pct_true_pos =</span> pct_true_pos)</span>
<span id="cb301-54"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-54"></a>    )</span>
<span id="cb301-55"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-55"></a>  }</span>
<span id="cb301-56"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-56"></a>}</span>
<span id="cb301-57"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb301-57"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>## 2.63 sec elapsed</code></pre>
<p>Although the additional downsampling takes a bit more time, the code still runs quickly (&lt;10s on my machine). However, before looking at the results let’s confirm that each data subset was balanced between positive and negative reviews. Figure <a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#fig:show-unbalanced2">7.8</a> below shows that the data subsets were balanced, so we can look at our prediction accuracy without worrying about unbalanced data affecting our results.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb303-1"></a>results <span class="op">%&gt;%</span></span>
<span id="cb303-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb303-2"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb303-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb303-3"></a><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">x=</span>word_qtile, <span class="dt">y=</span>num_qtile, <span class="dt">fill=</span>pct_true_pos)) <span class="op">+</span></span>
<span id="cb303-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb303-4"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span>num_qtiles, </span>
<span id="cb303-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb303-5"></a>                     <span class="dt">labels =</span> <span class="kw">paste0</span>(<span class="st">&quot;Q&quot;</span>,<span class="dv">1</span><span class="op">:</span>num_qtiles,<span class="st">&quot;: &quot;</span>,qtiles, <span class="st">&quot;-&quot;</span>,<span class="kw">lead</span>(qtiles)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="op">-</span><span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb303-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb303-6"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span>num_qtiles,</span>
<span id="cb303-7"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb303-7"></a>                     <span class="dt">labels =</span> (<span class="dv">2</span><span class="op">*</span><span class="kw">round</span>(<span class="dv">1</span><span class="op">:</span>num_qtiles <span class="op">*</span><span class="st"> </span>minn<span class="op">/</span>num_qtiles))) <span class="op">+</span></span>
<span id="cb303-8"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb303-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Review Word Length by Quantile&quot;</span>,</span>
<span id="cb303-9"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb303-9"></a>       <span class="dt">y =</span> <span class="st">&quot;Number of Reviews&quot;</span>,</span>
<span id="cb303-10"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb303-10"></a>       <span class="dt">fill =</span> <span class="st">&quot;True Positive Rate&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:show-unbalanced2"></span>
<img src="telfer-mba-nlp_files/figure-html/show-unbalanced2-1.png" alt="Heat map of the percentage of true positive reviews in each quantile of the micro-balanced dataset." width="672" />
<p class="caption">
Figure 7.8: Heat map of the percentage of true positive reviews in each quantile of the micro-balanced dataset.
</p>
</div>
<p>The results shown below in Figure <a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#fig:plot-second-heatmap">7.9</a> are promising. The accuracy metrics are still quite high, and range from around 79% to around 83%. This is a bit worse overall than in Experiment 1, but we can be more confident now that these are real results and not an artefact of any underlying imbalance in the data.</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb304-1"></a>results <span class="op">%&gt;%</span></span>
<span id="cb304-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb304-2"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb304-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb304-3"></a><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">x=</span>word_qtile, <span class="dt">y=</span>num_qtile, <span class="dt">fill=</span>accuracy)) <span class="op">+</span></span>
<span id="cb304-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb304-4"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span>num_qtiles, </span>
<span id="cb304-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb304-5"></a>                     <span class="dt">labels =</span> <span class="kw">paste0</span>(<span class="st">&quot;Q&quot;</span>,<span class="dv">1</span><span class="op">:</span>num_qtiles,<span class="st">&quot;: &quot;</span>,qtiles, <span class="st">&quot;-&quot;</span>,<span class="kw">lead</span>(qtiles)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="op">-</span><span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb304-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb304-6"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span>num_qtiles,</span>
<span id="cb304-7"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb304-7"></a>                     <span class="dt">labels =</span> (<span class="dv">2</span><span class="op">*</span><span class="kw">round</span>(<span class="dv">1</span><span class="op">:</span>num_qtiles <span class="op">*</span><span class="st"> </span>minn<span class="op">/</span>num_qtiles))) <span class="op">+</span></span>
<span id="cb304-8"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb304-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Review Word Length by Quantile&quot;</span>,</span>
<span id="cb304-9"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb304-9"></a>       <span class="dt">y =</span> <span class="st">&quot;Number of Reviews&quot;</span>,</span>
<span id="cb304-10"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb304-10"></a>       <span class="dt">fill =</span> <span class="st">&quot;Accuracy&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:plot-second-heatmap"></span>
<img src="telfer-mba-nlp_files/figure-html/plot-second-heatmap-1.png" alt="Heat map of logistic regression prediction accuracy for the micro-balanced Yelp dataset." width="672" />
<p class="caption">
Figure 7.9: Heat map of logistic regression prediction accuracy for the micro-balanced Yelp dataset.
</p>
</div>
<p>We’re now in a position to draw some conclusions from our analysis.</p>
<p><strong>First, shorter reviews are effective for predicting ratings, and the longest reviews are the least effective.</strong> We can see this trend clearly in Figure <a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#fig:expt2-boxplot-length">7.10</a> below, where the first three quintiles perform reasonably well, but then accuracy degrades quickly in Q4 and Q5. We can hypothesize about why this might be. For example, shorter reviews might have more “information density” and longer reviews might tend to ramble on and be “noisier.” It’s much easier to get the gist of “This place sucks, I hate it” than it is of an 800-word essay that begins “Upon entering the establishment, I was first greeted by an aroma of…”</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb305-1"></a>results <span class="op">%&gt;%</span></span>
<span id="cb305-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb305-2"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb305-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb305-3"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">as.factor</span>(word_qtile), <span class="dt">y =</span> accuracy)) <span class="op">+</span></span>
<span id="cb305-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb305-4"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb305-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb305-5"></a><span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span>num_qtiles, </span>
<span id="cb305-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb305-6"></a>                     <span class="dt">labels =</span> <span class="kw">paste0</span>(<span class="st">&quot;Q&quot;</span>,<span class="dv">1</span><span class="op">:</span>num_qtiles,<span class="st">&quot;: &quot;</span>,qtiles, <span class="st">&quot;-&quot;</span>,<span class="kw">lead</span>(qtiles)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="op">-</span><span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb305-7"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb305-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Review Word Length by Quantile&quot;</span>,</span>
<span id="cb305-8"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb305-8"></a>       <span class="dt">y =</span> <span class="st">&quot;Accuracy&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:expt2-boxplot-length"></span>
<img src="telfer-mba-nlp_files/figure-html/expt2-boxplot-length-1.png" alt="Experiment 2: Boxplots of review accuracy by word-length quintile." width="672" />
<p class="caption">
Figure 7.10: Experiment 2: Boxplots of review accuracy by word-length quintile.
</p>
</div>
<p><strong>Second, our results were not dependent on the number of reviews, and we achieved good accuracy with even a modest number of reviews.</strong> Figure <a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#fig:expt2-boxplot-num">7.11</a> shows the distribution of model accuracy according to the number of reviews, and the distributions overlap substantially. There is no clear trend here, suggesting that this approach to classification doesn’t benefit from having more than on the order of 10,000 input reviews.</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb306-1"></a>results <span class="op">%&gt;%</span></span>
<span id="cb306-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb306-2"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb306-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb306-3"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">as.factor</span>(num_qtile), <span class="dt">y =</span> accuracy)) <span class="op">+</span></span>
<span id="cb306-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb306-4"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb306-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb306-5"></a><span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span>num_qtiles, </span>
<span id="cb306-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb306-6"></a>                     <span class="dt">labels =</span> (<span class="dv">2</span><span class="op">*</span><span class="kw">round</span>(<span class="dv">1</span><span class="op">:</span>num_qtiles <span class="op">*</span><span class="st"> </span>minn<span class="op">/</span>num_qtiles))) <span class="op">+</span></span>
<span id="cb306-7"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb306-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Number of Reviews&quot;</span>,</span>
<span id="cb306-8"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb306-8"></a>       <span class="dt">y =</span> <span class="st">&quot;Accuracy&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:expt2-boxplot-num"></span>
<img src="telfer-mba-nlp_files/figure-html/expt2-boxplot-num-1.png" alt="Experiment 2: Boxplots of review accuracy by number of reviews." width="672" />
<p class="caption">
Figure 7.11: Experiment 2: Boxplots of review accuracy by number of reviews.
</p>
</div>
<p>If one were so inclined, one could also demonstrate this with a stylish Joy-Division-style ridge-density plot.</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb307-1"></a>results <span class="op">%&gt;%</span></span>
<span id="cb307-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb307-2"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb307-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb307-3"></a><span class="st">  </span>ggridges<span class="op">::</span><span class="kw">geom_density_ridges</span>(<span class="kw">aes</span>(<span class="dt">x =</span> accuracy, <span class="dt">y=</span><span class="kw">as.factor</span>(num_qtile)))  <span class="op">+</span></span>
<span id="cb307-4"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb307-4"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb307-5"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb307-5"></a><span class="st">  </span><span class="kw">scale_y_discrete</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span>num_qtiles, </span>
<span id="cb307-6"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb307-6"></a>                     <span class="dt">labels =</span> (<span class="dv">2</span><span class="op">*</span><span class="kw">round</span>(<span class="dv">1</span><span class="op">:</span>num_qtiles <span class="op">*</span><span class="st"> </span>minn<span class="op">/</span>num_qtiles))) <span class="op">+</span></span>
<span id="cb307-7"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb307-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Number of Reviews&quot;</span>,</span>
<span id="cb307-8"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb307-8"></a>       <span class="dt">x =</span> <span class="st">&quot;Accuracy&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:expt2-joydivision-num"></span>
<img src="telfer-mba-nlp_files/figure-html/expt2-joydivision-num-1.png" alt="Experiment 2: Shameless pandering to the ref with a 'Joy Division' ridge plot of review accuracy by number of reviews." width="672" />
<p class="caption">
Figure 7.12: Experiment 2: Shameless pandering to the ref with a ‘Joy Division’ ridge plot of review accuracy by number of reviews.
</p>
</div>
<p>If one were a stickler for parametric statistics, one might want to see this lack of correlation demonstrated with a linear regression. Here I will run a linear regression to predict a model’s accuracy from the number of reviews it considers.</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb308-1"></a>lm.fit &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="dt">data =</span> results, accuracy <span class="op">~</span><span class="st"> </span>num_qtile)</span>
<span id="cb308-2"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb308-2"></a></span>
<span id="cb308-3"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb308-3"></a><span class="kw">summary</span>(lm.fit)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = accuracy ~ num_qtile, data = results)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -0.027484 -0.006335  0.002200  0.007103  0.016486 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 0.8148239  0.0053016 153.695   &lt;2e-16 ***
## num_qtile   0.0004102  0.0015985   0.257      0.8    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.0113 on 23 degrees of freedom
## Multiple R-squared:  0.002855,   Adjusted R-squared:  -0.0405 
## F-statistic: 0.06586 on 1 and 23 DF,  p-value: 0.7997</code></pre>
<p>As expected, the volume of reviews is not a statistically significant predictor of accuracy: the p-value for the <code>num_qtile</code> variable is 0.8, the p-value for the model overall is roughly 0.8, and the Adjusted <span class="math inline">\(R^2\)</span> is negative(!). My results show no statistical evidence that, over these ranges, the number of input reviews is associated with a model’s accuracy.</p>
</div>
<div id="conclusions" class="section level2">
<h2><span class="header-section-number">7.5</span> Conclusions</h2>
<p>In this section I ran two experiments to predict a Yelp review’s rating based on its AFINN sentiment using logistic regression. In each experiment, I built and evaluated 25 models using subsets of my data with different word lengths and numbers of reviews. I demonstrated that you can get good accuracy (~80%) with a relatively small number of reviews (~10,000) using a simple sentiment-detection algorithm (AFINN) and a simple classification model (logistic regression).</p>
<p>In Experiment 1 I balanced my overall dataset between positive and negative reviews by random down-sampling. However, I found that my subsets were unbalanced, and found furthermore that the degree of imbalance was strongly correlated with accuracy. Still, I noted that the overall accuracy was still quite good across the entire range of imbalance, and so one interpretation is that this method is quite robust on unbalanced datasets.</p>
<p>In Experiment 2 I balanced each subset to have approximately the same number of positive and negative reviews, again using random down-sampling. Using these “micro-balanced” datasets, I derived the following answers to my two research questions:</p>
<ul>
<li><strong>A1:</strong> Review accuracy was better with shorter reviews, and the longest reviews were the least effective.</li>
<li><strong>A2:</strong> Review accuracy was not correlated with the number of reviews used as inputs, provided the number of reviews is on the order of 10,000.</li>
</ul>
<p>Results in Experiment 2 were very good overall: accuracy ranged from around 79% to around 83% across all models.</p>
</div>
<div id="next-steps-1" class="section level2">
<h2><span class="header-section-number">7.6</span> Next Steps</h2>
<ul>
<li>Consider evaluating model performance across the entire dataset, not just the testing component of the subset used to generate the model. <em>For discussion.</em>K</li>
<li>Consider a more complex sentiment-detection algorithm.</li>
<li>Consider a more complex classification engine, e.g. Naive Bayes Classifier using text tokens instead of a real-valued sentiment score.</li>
</ul>
</div>
<div id="sessioninfo-2" class="section level2">
<h2><span class="header-section-number">7.7</span> SessionInfo</h2>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#cb310-1"></a><span class="kw">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.0.2 (2020-06-22)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 18363)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252    LC_MONETARY=English_Canada.1252 LC_NUMERIC=C                    LC_TIME=English_Canada.1252    
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] vip_0.2.2         glmnet_4.0-2      Matrix_1.2-18     ggridges_0.5.2    discrim_0.1.1     tictoc_1.0        textrecipes_0.3.0 lubridate_1.7.9   yardstick_0.0.7   workflows_0.2.0  
## [11] tune_0.1.1        rsample_0.0.8     recipes_0.1.13    parsnip_0.1.4     modeldata_0.0.2   infer_0.5.3       dials_0.0.9       scales_1.1.1      broom_0.7.0       tidymodels_0.1.1 
## [21] tidytext_0.2.5    forcats_0.5.0     stringr_1.4.0     dplyr_1.0.2       purrr_0.3.4       readr_1.3.1       tidyr_1.1.1       tibble_3.0.3      ggplot2_3.3.2     tidyverse_1.3.0  
## 
## loaded via a namespace (and not attached):
##  [1] colorspace_1.4-1   ellipsis_0.3.1     class_7.3-17       fs_1.5.0           rstudioapi_0.11    listenv_0.8.0      furrr_0.1.0        farver_2.0.3       SnowballC_0.7.0   
## [10] prodlim_2019.11.13 fansi_0.4.1        xml2_1.3.2         codetools_0.2-16   splines_4.0.2      knitr_1.29         jsonlite_1.7.0     pROC_1.16.2        packrat_0.5.0     
## [19] dbplyr_1.4.4       compiler_4.0.2     httr_1.4.2         backports_1.1.7    assertthat_0.2.1   cli_2.0.2          htmltools_0.5.0    tools_4.0.2        gtable_0.3.0      
## [28] glue_1.4.1         naivebayes_0.9.7   rappdirs_0.3.1     Rcpp_1.0.5         cellranger_1.1.0   DiceDesign_1.8-1   vctrs_0.3.2        iterators_1.0.12   timeDate_3043.102 
## [37] gower_0.2.2        xfun_0.16          stopwords_2.0      globals_0.13.0     rvest_0.3.6        lifecycle_0.2.0    future_1.19.1      MASS_7.3-51.6      ipred_0.9-9       
## [46] hms_0.5.3          parallel_4.0.2     yaml_2.2.1         gridExtra_2.3      rpart_4.1-15       stringi_1.4.6      highr_0.8          tokenizers_0.2.1   foreach_1.5.0     
## [55] textdata_0.4.1     lhs_1.0.2          hardhat_0.1.4      shape_1.4.5        lava_1.6.8         rlang_0.4.7        pkgconfig_2.0.3    evaluate_0.14      lattice_0.20-41   
## [64] labeling_0.3       tidyselect_1.1.0   fabricatr_0.10.0   plyr_1.8.6         magrittr_1.5       bookdown_0.20      R6_2.4.1           generics_0.0.2     DBI_1.1.0         
## [73] pillar_1.4.6       haven_2.3.1        withr_2.2.0        survival_3.1-12    nnet_7.3-14        janeaustenr_0.1.5  modelr_0.1.8       crayon_1.3.4       utf8_1.1.4        
## [82] rmarkdown_2.3      usethis_1.6.1      grid_4.0.2         readxl_1.3.1       blob_1.2.1         reprex_0.3.0       digest_0.6.25      webshot_0.5.2      munsell_0.5.0     
## [91] GPfit_1.0-8        viridisLite_0.3.0  kableExtra_1.1.0</code></pre>
</div>
<div id="references" class="section level2">
<h2><span class="header-section-number">7.8</span> References</h2>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-liu_sentiment_2015">
<p>Liu, Bing. 2015. <em>Sentiment Analysis: Mining Opinions, Sentiments, and Emotions</em>. Cambridge: Cambridge University Press. <a href="https://doi.org/10.1017/CBO9781139084789">https://doi.org/10.1017/CBO9781139084789</a>.</p>
</div>
<div id="ref-silge_supervised_2020">
<p>Silge, Julia, and Emil Hvitfeldt. 2020. <em>Supervised Machine Learning for Text Analysis in R</em>. <a href="https://smltar.com/">https://smltar.com/</a>.</p>
</div>
<div id="ref-silge_text_2020">
<p>Silge, Julia, and David Robinson. 2020. <em>Text Mining with R: A Tidy Approach</em>. O’Reilly. <a href="https://www.tidytextmining.com/index.html">https://www.tidytextmining.com/index.html</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="yelp-classification-and-sentiment-test.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="beyond-the-mvp-looking-at-longer-reviews.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/06-MVP.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["telfer-mba-nlp.pdf", "telfer-mba-nlp.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
