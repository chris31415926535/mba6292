<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Yelp Classification and Sentiment Test | Telfer 2020 Directed Reading: Natural Language Processing</title>
  <meta name="description" content="This is Christopher Belanger’s work product for the Telfer School of Management course MBA6292, Directed Readings in Natural Language Processing." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Yelp Classification and Sentiment Test | Telfer 2020 Directed Reading: Natural Language Processing" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is Christopher Belanger’s work product for the Telfer School of Management course MBA6292, Directed Readings in Natural Language Processing." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Yelp Classification and Sentiment Test | Telfer 2020 Directed Reading: Natural Language Processing" />
  
  <meta name="twitter:description" content="This is Christopher Belanger’s work product for the Telfer School of Management course MBA6292, Directed Readings in Natural Language Processing." />
  

<meta name="author" content="Christopher Belanger" />


<meta name="date" content="2020-12-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="a-first-lasso-attempt.html"/>
<link rel="next" href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MBA6292: Directed Readings in NLP</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html"><i class="fa fa-check"></i><b>3</b> Web Scraping Our Data</a><ul>
<li class="chapter" data-level="3.1" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#foreword-ethics-legality"><i class="fa fa-check"></i><b>3.1</b> Foreword: Ethics &amp; Legality</a></li>
<li class="chapter" data-level="3.2" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#the-general-idea"><i class="fa fa-check"></i><b>3.2</b> The General Idea</a></li>
<li class="chapter" data-level="3.3" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#goodreads-css-selectors"><i class="fa fa-check"></i><b>3.3</b> Goodreads: CSS Selectors</a><ul>
<li class="chapter" data-level="3.3.1" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-index"><i class="fa fa-check"></i><b>3.3.1</b> Scraping the Index</a></li>
<li class="chapter" data-level="3.3.2" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-content"><i class="fa fa-check"></i><b>3.3.2</b> Scraping the Content</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#yelp-embedded-json"><i class="fa fa-check"></i><b>3.4</b> Yelp: Embedded JSON</a><ul>
<li class="chapter" data-level="3.4.1" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-index-1"><i class="fa fa-check"></i><b>3.4.1</b> Scraping the Index</a></li>
<li class="chapter" data-level="3.4.2" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-content-1"><i class="fa fa-check"></i><b>3.4.2</b> Scraping the Content</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#mec-reverse-engineering-client-side-api-calls"><i class="fa fa-check"></i><b>3.5</b> MEC: Reverse-Engineering Client-Side API Calls</a><ul>
<li class="chapter" data-level="3.5.1" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-index-2"><i class="fa fa-check"></i><b>3.5.1</b> Scraping the Index</a></li>
<li class="chapter" data-level="3.5.2" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#functions-for-api-calls"><i class="fa fa-check"></i><b>3.5.2</b> Functions for API Calls</a></li>
<li class="chapter" data-level="3.5.3" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-content-2"><i class="fa fa-check"></i><b>3.5.3</b> Scraping the Content</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#summary"><i class="fa fa-check"></i><b>3.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html"><i class="fa fa-check"></i><b>4</b> Data Summary, EDA, &amp; Initial Model Attempts</a><ul>
<li class="chapter" data-level="4.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#goodreads"><i class="fa fa-check"></i><b>4.2</b> Goodreads</a><ul>
<li class="chapter" data-level="4.2.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#star-ratings"><i class="fa fa-check"></i><b>4.2.1</b> Star Ratings</a></li>
<li class="chapter" data-level="4.2.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#word-count"><i class="fa fa-check"></i><b>4.2.2</b> Word Count</a></li>
<li class="chapter" data-level="4.2.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#reviewers"><i class="fa fa-check"></i><b>4.2.3</b> Reviewers</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#yelp"><i class="fa fa-check"></i><b>4.3</b> Yelp</a><ul>
<li class="chapter" data-level="4.3.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#star-ratings-1"><i class="fa fa-check"></i><b>4.3.1</b> Star Ratings</a></li>
<li class="chapter" data-level="4.3.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#word-count-1"><i class="fa fa-check"></i><b>4.3.2</b> Word Count</a></li>
<li class="chapter" data-level="4.3.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#reviewers-1"><i class="fa fa-check"></i><b>4.3.3</b> Reviewers</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#mountain-equipment-co-op-mec"><i class="fa fa-check"></i><b>4.4</b> Mountain Equipment Co-op (MEC)</a><ul>
<li class="chapter" data-level="4.4.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#star-ratings-2"><i class="fa fa-check"></i><b>4.4.1</b> Star Ratings</a></li>
<li class="chapter" data-level="4.4.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#word-counts"><i class="fa fa-check"></i><b>4.4.2</b> Word Counts</a></li>
<li class="chapter" data-level="4.4.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#reviewers-2"><i class="fa fa-check"></i><b>4.4.3</b> Reviewers</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#comparing-goodreads-mec-and-yelp"><i class="fa fa-check"></i><b>4.5</b> Comparing Goodreads, MEC, and Yelp</a><ul>
<li class="chapter" data-level="4.5.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#star-ratings-3"><i class="fa fa-check"></i><b>4.5.1</b> Star Ratings</a></li>
<li class="chapter" data-level="4.5.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#word-counts-1"><i class="fa fa-check"></i><b>4.5.2</b> Word Counts</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#reviews-over-time"><i class="fa fa-check"></i><b>4.6</b> Reviews Over Time</a><ul>
<li class="chapter" data-level="4.6.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#goodreads-1"><i class="fa fa-check"></i><b>4.6.1</b> Goodreads</a></li>
<li class="chapter" data-level="4.6.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#yelp-1"><i class="fa fa-check"></i><b>4.6.2</b> Yelp</a></li>
<li class="chapter" data-level="4.6.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#mec"><i class="fa fa-check"></i><b>4.6.3</b> MEC</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#proposed-next-steps"><i class="fa fa-check"></i><b>4.7</b> Proposed Next Steps</a></li>
<li class="chapter" data-level="4.8" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#sessioninfo"><i class="fa fa-check"></i><b>4.8</b> SessionInfo</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html"><i class="fa fa-check"></i><b>5</b> A First LASSO Attempt</a><ul>
<li class="chapter" data-level="5.1" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#introduction-1"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#a-first-regression-yelp-data"><i class="fa fa-check"></i><b>5.2</b> A First Regression: Yelp Data</a><ul>
<li class="chapter" data-level="5.2.1" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#splitting-the-data"><i class="fa fa-check"></i><b>5.2.1</b> Splitting the data</a></li>
<li class="chapter" data-level="5.2.2" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#evaluating-the-first-model"><i class="fa fa-check"></i><b>5.2.2</b> Evaluating the first model</a></li>
<li class="chapter" data-level="5.2.3" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#tuning-model-parameters"><i class="fa fa-check"></i><b>5.2.3</b> Tuning model parameters</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#trying-lasso-again"><i class="fa fa-check"></i><b>5.3</b> Trying lasso again</a><ul>
<li class="chapter" data-level="5.3.1" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#with-1000-tokens"><i class="fa fa-check"></i><b>5.3.1</b> With 1000 tokens</a></li>
<li class="chapter" data-level="5.3.2" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#short-reviews-only-125-words"><i class="fa fa-check"></i><b>5.3.2</b> Short reviews only: &lt;125 words</a></li>
<li class="chapter" data-level="5.3.3" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#longer-reviews-125-words"><i class="fa fa-check"></i><b>5.3.3</b> Longer reviews &gt; 125 words</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#removing-stop-words"><i class="fa fa-check"></i><b>5.4</b> Removing stop words</a></li>
<li class="chapter" data-level="5.5" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#adjusting-n-grams"><i class="fa fa-check"></i><b>5.5</b> Adjusting n-grams</a></li>
<li class="chapter" data-level="5.6" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#full-final-regression"><i class="fa fa-check"></i><b>5.6</b> Full final regression</a></li>
<li class="chapter" data-level="5.7" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#conclusion"><i class="fa fa-check"></i><b>5.7</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html"><i class="fa fa-check"></i><b>6</b> Yelp Classification and Sentiment Test</a><ul>
<li class="chapter" data-level="6.1" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#yelp-dataset"><i class="fa fa-check"></i><b>6.1</b> Yelp Dataset</a><ul>
<li class="chapter" data-level="6.1.1" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#afinn"><i class="fa fa-check"></i><b>6.1.1</b> AFINN</a></li>
<li class="chapter" data-level="6.1.2" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#classification-naive-bayes-classifier"><i class="fa fa-check"></i><b>6.1.2</b> Classification: Naive Bayes Classifier</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#kaggle-yelp-dataset"><i class="fa fa-check"></i><b>6.2</b> Kaggle Yelp dataset</a><ul>
<li class="chapter" data-level="6.2.1" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#naive-bayes-classifier"><i class="fa fa-check"></i><b>6.2.1</b> Naive Bayes Classifier</a></li>
<li class="chapter" data-level="6.2.2" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#logistic-regression"><i class="fa fa-check"></i><b>6.2.2</b> Logistic Regression</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#next-steps"><i class="fa fa-check"></i><b>6.3</b> NEXT STEPS</a></li>
<li class="chapter" data-level="6.4" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#sessioninfo-1"><i class="fa fa-check"></i><b>6.4</b> SessionInfo</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><i class="fa fa-check"></i><b>7</b> The MVP: Classification Accuracy as a Function of Review Length and Volume</a><ul>
<li class="chapter" data-level="7.1" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#introduction-2"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#preparing-the-data"><i class="fa fa-check"></i><b>7.2</b> Preparing the Data</a></li>
<li class="chapter" data-level="7.3" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#experiment-1-logistic-regression-on-globally-balanced-data"><i class="fa fa-check"></i><b>7.3</b> Experiment 1: Logistic Regression on Globally Balanced Data</a></li>
<li class="chapter" data-level="7.4" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#experiment-2-logistic-regression-on-micro-balanced-data"><i class="fa fa-check"></i><b>7.4</b> Experiment 2: Logistic Regression on Micro-Balanced Data</a></li>
<li class="chapter" data-level="7.5" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#conclusions"><i class="fa fa-check"></i><b>7.5</b> Conclusions</a></li>
<li class="chapter" data-level="7.6" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#next-steps-1"><i class="fa fa-check"></i><b>7.6</b> Next Steps</a></li>
<li class="chapter" data-level="7.7" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#sessioninfo-2"><i class="fa fa-check"></i><b>7.7</b> SessionInfo</a></li>
<li class="chapter" data-level="7.8" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#references"><i class="fa fa-check"></i><b>7.8</b> References</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html"><i class="fa fa-check"></i><b>8</b> Beyond the MVP: Looking at Longer Reviews</a><ul>
<li class="chapter" data-level="8.1" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#introduction-3"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#results-from-the-previous-section"><i class="fa fa-check"></i><b>8.2</b> Results from the Previous Section</a></li>
<li class="chapter" data-level="8.3" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#finding-misclassified-reviews"><i class="fa fa-check"></i><b>8.3</b> Finding Misclassified Reviews</a></li>
<li class="chapter" data-level="8.4" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#qualitative-analysis-of-misclassified-reviews"><i class="fa fa-check"></i><b>8.4</b> Qualitative Analysis of Misclassified Reviews</a></li>
<li class="chapter" data-level="8.5" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#negations"><i class="fa fa-check"></i><b>8.5</b> Negations</a><ul>
<li class="chapter" data-level="8.5.1" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#negations-and-prediction-accuracy"><i class="fa fa-check"></i><b>8.5.1</b> Negations and Prediction Accuracy</a></li>
<li class="chapter" data-level="8.5.2" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#negations-and-word-length"><i class="fa fa-check"></i><b>8.5.2</b> Negations and Word Length</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#readability"><i class="fa fa-check"></i><b>8.6</b> Readability</a></li>
<li class="chapter" data-level="8.7" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#summing-up-so-far"><i class="fa fa-check"></i><b>8.7</b> Summing Up So Far</a></li>
<li class="chapter" data-level="8.8" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#logistic-regression-on-afinn-negators"><i class="fa fa-check"></i><b>8.8</b> Logistic Regression on AFINN + negators</a></li>
<li class="chapter" data-level="8.9" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#logistic-regression-on-mean-afinn-negators"><i class="fa fa-check"></i><b>8.9</b> Logistic Regression on Mean AFINN + negators</a></li>
<li class="chapter" data-level="8.10" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#comparing-models-multiple-trials"><i class="fa fa-check"></i><b>8.10</b> Comparing Models: Multiple Trials</a></li>
<li class="chapter" data-level="8.11" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#re-running-the-big-analysis"><i class="fa fa-check"></i><b>8.11</b> Re-Running the Big Analysis</a></li>
<li class="chapter" data-level="8.12" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#conclusion-1"><i class="fa fa-check"></i><b>8.12</b> Conclusion</a></li>
<li class="chapter" data-level="8.13" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#sessioninfo-3"><i class="fa fa-check"></i><b>8.13</b> SessionInfo</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html"><i class="fa fa-check"></i><b>9</b> Beyond the MVP: Support Vector Machine Classification</a><ul>
<li class="chapter" data-level="9.1" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#introduction-4"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#svm-classifiers"><i class="fa fa-check"></i><b>9.2</b> SVM Classifiers</a></li>
<li class="chapter" data-level="9.3" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#preparing-the-data-1"><i class="fa fa-check"></i><b>9.3</b> Preparing the Data</a></li>
<li class="chapter" data-level="9.4" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#svm-classification"><i class="fa fa-check"></i><b>9.4</b> SVM Classification</a></li>
<li class="chapter" data-level="9.5" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#fitting-and-predicting"><i class="fa fa-check"></i><b>9.5</b> Fitting and Predicting</a></li>
<li class="chapter" data-level="9.6" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#conclusions-1"><i class="fa fa-check"></i><b>9.6</b> Conclusions</a></li>
<li class="chapter" data-level="9.7" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#sessioninfo-4"><i class="fa fa-check"></i><b>9.7</b> SessionInfo</a></li>
<li class="chapter" data-level="9.8" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#references-1"><i class="fa fa-check"></i><b>9.8</b> References</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-2.html"><a href="references-2.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Telfer 2020 Directed Reading: Natural Language Processing</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="yelp-classification-and-sentiment-test" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Yelp Classification and Sentiment Test</h1>
<p>This notebook outlines my efforts to build a <em>classification model</em> that can predict Yelp star ratings based on Yelp review text. My previous attempts used linear regression to predict star rating as a real-valued function of input text. In this notebook, I will instead approach prediction as a classification problem and try to predict star ratings as discrete factors.</p>
<p>Intead of trying to predict exact star ratings, I will follow standard practice and divide ratings into positive (“POS”) and negative (“NEG”) reviews. As <span class="citation">Liu (<a href="#ref-liu_sentiment_2015" role="doc-biblioref">2015</a>)</span> notes, “Sentiment classification is usually formulated as a two-class classification problem: positive and negative …A review with 4 or 5 stars is considered a positive review, and a review with 1 to 2 stars is considered a negative review. Most research papers do not use the neutral class (3-star ratings) to make the classification problem easier” (49). But if the results are good, we can always experiment with three- or five-class problems.</p>
<p>A note on sourcing: My analysis here will closely follow the examples in <span class="citation">Silge and Hvitfeldt (<a href="#ref-silge_supervised_2020" role="doc-biblioref">2020</a>)</span> (which I will often refer to as “SMLTAR,” for “Supervised Machine Learning and Text Analysis in R”) and <span class="citation">Silge and Robinson (<a href="#ref-silge_text_2020" role="doc-biblioref">2020</a>)</span>. In some cases I have used examples or hints from websites like Stack Overflow, and I’ve noted that where applicable.</p>
<p>A note on aesthetics: in the interest of time I haven’t piped my outputs through <code>kable()</code>. Most outputs are straight console printouts.</p>
<div id="yelp-dataset" class="section level2">
<h2><span class="header-section-number">6.1</span> Yelp Dataset</h2>
<p>Let’s begin with the Yelp dataset I collected. As a reminder, this dataset was collected in October 2020 and has 9,402 reviews for restaurants in Ottawa. Reviews were overwhelmingly positive, as can be seen in the following histogram.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="yelp-classification-and-sentiment-test.html#cb231-1"></a>reviews_gr &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;../tests/data/goodreads_all.csv&quot;</span>)</span>
<span id="cb231-2"><a href="yelp-classification-and-sentiment-test.html#cb231-2"></a>reviews_mec &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;../tests/data/mec-reviews.csv&quot;</span>)</span>
<span id="cb231-3"><a href="yelp-classification-and-sentiment-test.html#cb231-3"></a>reviews_yelp &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;../tests/data/ottawa_yelp_reviews.csv&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb231-4"><a href="yelp-classification-and-sentiment-test.html#cb231-4"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">rating_num =</span> rating)</span>
<span id="cb231-5"><a href="yelp-classification-and-sentiment-test.html#cb231-5"></a></span>
<span id="cb231-6"><a href="yelp-classification-and-sentiment-test.html#cb231-6"></a></span>
<span id="cb231-7"><a href="yelp-classification-and-sentiment-test.html#cb231-7"></a> reviews_yelp <span class="op">%&gt;%</span></span>
<span id="cb231-8"><a href="yelp-classification-and-sentiment-test.html#cb231-8"></a><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>rating_num)) <span class="op">+</span></span>
<span id="cb231-9"><a href="yelp-classification-and-sentiment-test.html#cb231-9"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins=</span><span class="dv">5</span>) <span class="op">+</span></span>
<span id="cb231-10"><a href="yelp-classification-and-sentiment-test.html#cb231-10"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Small Yelp Dataset: Histogram of Star Ratings (n=9,402)&quot;</span>,</span>
<span id="cb231-11"><a href="yelp-classification-and-sentiment-test.html#cb231-11"></a>       <span class="dt">x =</span> <span class="st">&quot;Star Rating&quot;</span>,</span>
<span id="cb231-12"><a href="yelp-classification-and-sentiment-test.html#cb231-12"></a>       <span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>)</span></code></pre></div>
<p><img src="telfer-mba-nlp_files/figure-html/load_data-1.png" width="672" /></p>
<p>The dataset is quite imbalanced: nearly 79% of reviews give 4 or 5 stars, our only about 9% give 1 or 2 stars. As we will see, this will create problems for our modeling.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="yelp-classification-and-sentiment-test.html#cb232-1"></a>reviews_yelp <span class="op">%&gt;%</span></span>
<span id="cb232-2"><a href="yelp-classification-and-sentiment-test.html#cb232-2"></a><span class="st">  </span><span class="kw">group_by</span>(rating_num) <span class="op">%&gt;%</span></span>
<span id="cb232-3"><a href="yelp-classification-and-sentiment-test.html#cb232-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></span>
<span id="cb232-4"><a href="yelp-classification-and-sentiment-test.html#cb232-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pct =</span> n<span class="op">/</span><span class="kw">sum</span>(n))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 5 x 3
##   rating_num     n    pct
##        &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;
## 1          1   343 0.0365
## 2          2   510 0.0542
## 3          3  1077 0.115 
## 4          4  2958 0.315 
## 5          5  4514 0.480</code></pre>
<div id="afinn" class="section level3">
<h3><span class="header-section-number">6.1.1</span> AFINN</h3>
<p>AFINN is a dictionary-based one-dimensional sentiment model that gives texts an integer score for how positive or negative they are. It treats texts as a “bag of words,” which means it does not consider any syntax or semantics beyond the values given in its dictionary. Each word in a text is given a pre-determined positive or negative score, and those scores are summed to give an overall rating for a text.</p>
<p>For example, here are the AFINN scores for the top 5 positive words. Strongly negative words are generally NSFW and so I won’t print them here.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="yelp-classification-and-sentiment-test.html#cb235-1"></a>afinn <span class="op">%&gt;%</span></span>
<span id="cb235-2"><a href="yelp-classification-and-sentiment-test.html#cb235-2"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(value)) <span class="op">%&gt;%</span></span>
<span id="cb235-3"><a href="yelp-classification-and-sentiment-test.html#cb235-3"></a><span class="st">  </span><span class="kw">head</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   word         value
##   &lt;chr&gt;        &lt;dbl&gt;
## 1 breathtaking     5
## 2 hurrah           5
## 3 outstanding      5
## 4 superb           5
## 5 thrilled         5</code></pre>
<p>Following the <a href="https://www.tidytextmining.com/tidytext.html">Tidytext</a> method from Silge &amp; Robinson, we get an AFINN score for each Yelp review:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="yelp-classification-and-sentiment-test.html#cb237-1"></a>afinn_yelp &lt;-<span class="st"> </span>reviews_yelp <span class="op">%&gt;%</span></span>
<span id="cb237-2"><a href="yelp-classification-and-sentiment-test.html#cb237-2"></a><span class="st">  </span><span class="kw">select</span>(comment, rating_num) <span class="op">%&gt;%</span></span>
<span id="cb237-3"><a href="yelp-classification-and-sentiment-test.html#cb237-3"></a><span class="st">  </span><span class="kw">rowid_to_column</span>() <span class="op">%&gt;%</span></span>
<span id="cb237-4"><a href="yelp-classification-and-sentiment-test.html#cb237-4"></a><span class="st">  </span>tidytext<span class="op">::</span><span class="kw">unnest_tokens</span>(word, comment) <span class="op">%&gt;%</span></span>
<span id="cb237-5"><a href="yelp-classification-and-sentiment-test.html#cb237-5"></a><span class="st">  </span><span class="kw">left_join</span>(afinn) <span class="op">%&gt;%</span></span>
<span id="cb237-6"><a href="yelp-classification-and-sentiment-test.html#cb237-6"></a><span class="st">  </span><span class="kw">group_by</span>(rowid) <span class="op">%&gt;%</span></span>
<span id="cb237-7"><a href="yelp-classification-and-sentiment-test.html#cb237-7"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">afinn_sent =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> T),</span>
<span id="cb237-8"><a href="yelp-classification-and-sentiment-test.html#cb237-8"></a>            <span class="dt">rating_num =</span> <span class="kw">mean</span>(rating_num))</span></code></pre></div>
<p>We can make a boxplot to show the distribution of AFINN scores for reviews grouped by star rating. This actually looks moderately promising, since we can see that higher star ratings seem to be associated with somewhat higher AFINN scores.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="yelp-classification-and-sentiment-test.html#cb238-1"></a>afinn_yelp <span class="op">%&gt;%</span></span>
<span id="cb238-2"><a href="yelp-classification-and-sentiment-test.html#cb238-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rating_num =</span> <span class="kw">as.factor</span>(rating_num)) <span class="op">%&gt;%</span></span>
<span id="cb238-3"><a href="yelp-classification-and-sentiment-test.html#cb238-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rating_num, <span class="dt">y=</span>afinn_sent)) <span class="op">+</span></span>
<span id="cb238-4"><a href="yelp-classification-and-sentiment-test.html#cb238-4"></a><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></span>
<span id="cb238-5"><a href="yelp-classification-and-sentiment-test.html#cb238-5"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>) <span class="op">+</span></span>
<span id="cb238-6"><a href="yelp-classification-and-sentiment-test.html#cb238-6"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb238-7"><a href="yelp-classification-and-sentiment-test.html#cb238-7"></a>    <span class="dt">title =</span> <span class="st">&quot;AFINN Scores by Star Rating&quot;</span>,</span>
<span id="cb238-8"><a href="yelp-classification-and-sentiment-test.html#cb238-8"></a>    <span class="dt">subtitle =</span> <span class="st">&quot;Small Yelp dataset (n=9402)&quot;</span>,</span>
<span id="cb238-9"><a href="yelp-classification-and-sentiment-test.html#cb238-9"></a>    <span class="dt">x =</span> <span class="st">&quot;Star Rating&quot;</span>,</span>
<span id="cb238-10"><a href="yelp-classification-and-sentiment-test.html#cb238-10"></a>    <span class="dt">y =</span> <span class="st">&quot;AFINN Sentiment Score&quot;</span></span>
<span id="cb238-11"><a href="yelp-classification-and-sentiment-test.html#cb238-11"></a>  )</span></code></pre></div>
<p><img src="telfer-mba-nlp_files/figure-html/yelp_boxplot-1.png" width="672" /></p>
</div>
<div id="classification-naive-bayes-classifier" class="section level3">
<h3><span class="header-section-number">6.1.2</span> Classification: Naive Bayes Classifier</h3>
<p>To approach this as classification problem, we will divide reviews into two groups: positive (&gt;3 stars) and negative (&lt;3 stars).</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="yelp-classification-and-sentiment-test.html#cb239-1"></a>factor_yelp &lt;-<span class="st"> </span>reviews_yelp <span class="op">%&gt;%</span></span>
<span id="cb239-2"><a href="yelp-classification-and-sentiment-test.html#cb239-2"></a><span class="st">  </span><span class="kw">bind_cols</span>(afinn_yelp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(afinn_sent)) <span class="op">%&gt;%</span></span>
<span id="cb239-3"><a href="yelp-classification-and-sentiment-test.html#cb239-3"></a><span class="st">  </span><span class="kw">filter</span>(rating_num <span class="op">!=</span><span class="st"> </span><span class="dv">3</span>) <span class="op">%&gt;%</span></span>
<span id="cb239-4"><a href="yelp-classification-and-sentiment-test.html#cb239-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rating_factor =</span> <span class="kw">case_when</span>(</span>
<span id="cb239-5"><a href="yelp-classification-and-sentiment-test.html#cb239-5"></a>    rating_num <span class="op">&lt;</span><span class="dv">3</span> <span class="op">~</span><span class="st"> &quot;NEG&quot;</span>,</span>
<span id="cb239-6"><a href="yelp-classification-and-sentiment-test.html#cb239-6"></a>    rating_num <span class="op">&gt;</span><span class="dv">3</span> <span class="op">~</span><span class="st"> &quot;POS&quot;</span>),</span>
<span id="cb239-7"><a href="yelp-classification-and-sentiment-test.html#cb239-7"></a>    <span class="dt">rating_factor =</span> <span class="kw">as.factor</span>(rating_factor))</span>
<span id="cb239-8"><a href="yelp-classification-and-sentiment-test.html#cb239-8"></a></span>
<span id="cb239-9"><a href="yelp-classification-and-sentiment-test.html#cb239-9"></a><span class="co">#factor_yelp</span></span></code></pre></div>
<p>Here we’ll follow <a href="https://smltar.com/mlclassification.html">SMLTAR Ch 7</a> very closely and set up a naive Bayes classifier that takes AFINN sentiment as its only input and predicts positive or negative sentiment as its only output. The code here follows SMLTAR very closely except where otherwise specified. <em>Note</em> that SMLTAR actually uses the text itself, and not a real-valued variable like AFINN sentiment; we can try this next.</p>
<p>First we set up testing and training split:</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="yelp-classification-and-sentiment-test.html#cb240-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb240-2"><a href="yelp-classification-and-sentiment-test.html#cb240-2"></a></span>
<span id="cb240-3"><a href="yelp-classification-and-sentiment-test.html#cb240-3"></a>yelp_split &lt;-<span class="st"> </span><span class="kw">initial_split</span>(factor_yelp, <span class="dt">strata =</span> rating_factor)</span>
<span id="cb240-4"><a href="yelp-classification-and-sentiment-test.html#cb240-4"></a></span>
<span id="cb240-5"><a href="yelp-classification-and-sentiment-test.html#cb240-5"></a>yelp_test &lt;-<span class="st"> </span><span class="kw">testing</span>(yelp_split)</span>
<span id="cb240-6"><a href="yelp-classification-and-sentiment-test.html#cb240-6"></a></span>
<span id="cb240-7"><a href="yelp-classification-and-sentiment-test.html#cb240-7"></a>yelp_train &lt;-<span class="st"> </span><span class="kw">training</span>(yelp_split)</span></code></pre></div>
<p>Then we set up a recipe, set up a workflow, specify a naive Bayes model, and fit this model to our training data:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="yelp-classification-and-sentiment-test.html#cb241-1"></a>yelp_rec &lt;-<span class="st"> </span><span class="kw">recipe</span>(rating_factor <span class="op">~</span><span class="st"> </span>afinn_sent,</span>
<span id="cb241-2"><a href="yelp-classification-and-sentiment-test.html#cb241-2"></a>                   <span class="dt">data =</span> yelp_train)</span>
<span id="cb241-3"><a href="yelp-classification-and-sentiment-test.html#cb241-3"></a></span>
<span id="cb241-4"><a href="yelp-classification-and-sentiment-test.html#cb241-4"></a>yelp_wf &lt;-<span class="st"> </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span></span>
<span id="cb241-5"><a href="yelp-classification-and-sentiment-test.html#cb241-5"></a><span class="st">  </span><span class="kw">add_recipe</span>(yelp_rec)</span>
<span id="cb241-6"><a href="yelp-classification-and-sentiment-test.html#cb241-6"></a></span>
<span id="cb241-7"><a href="yelp-classification-and-sentiment-test.html#cb241-7"></a>nb_spec &lt;-<span class="st"> </span><span class="kw">naive_Bayes</span>() <span class="op">%&gt;%</span></span>
<span id="cb241-8"><a href="yelp-classification-and-sentiment-test.html#cb241-8"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">&quot;classification&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb241-9"><a href="yelp-classification-and-sentiment-test.html#cb241-9"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;naivebayes&quot;</span>)</span>
<span id="cb241-10"><a href="yelp-classification-and-sentiment-test.html#cb241-10"></a></span>
<span id="cb241-11"><a href="yelp-classification-and-sentiment-test.html#cb241-11"></a>nb_fit &lt;-<span class="st"> </span>yelp_wf <span class="op">%&gt;%</span></span>
<span id="cb241-12"><a href="yelp-classification-and-sentiment-test.html#cb241-12"></a><span class="st">  </span><span class="kw">add_model</span>(nb_spec) <span class="op">%&gt;%</span></span>
<span id="cb241-13"><a href="yelp-classification-and-sentiment-test.html#cb241-13"></a><span class="st">  </span><span class="kw">fit</span>(<span class="dt">data =</span> yelp_train)</span>
<span id="cb241-14"><a href="yelp-classification-and-sentiment-test.html#cb241-14"></a></span>
<span id="cb241-15"><a href="yelp-classification-and-sentiment-test.html#cb241-15"></a>nb_fit</span></code></pre></div>
<pre><code>## == Workflow [trained] ==========================================================
## Preprocessor: Recipe
## Model: naive_Bayes()
## 
## -- Preprocessor ----------------------------------------------------------------
## 0 Recipe Steps
## 
## -- Model -----------------------------------------------------------------------
## 
## ======================================================================================== Naive Bayes ========================================================================================= 
##  
##  Call: 
## naive_bayes.default(x = maybe_data_frame(x), y = y, usekernel = TRUE)
## 
## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
##  
## Laplace smoothing: 0
## 
## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
##  
##  A priori probabilities: 
## 
##       NEG       POS 
## 0.1024984 0.8975016 
## 
## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
##  
##  Tables: 
## 
## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
##  ::: afinn_sent::NEG (KDE)
## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
## 
## Call:
##  density.default(x = x, na.rm = TRUE)
## 
## Data: x (640 obs.);  Bandwidth &#39;bw&#39; = 1.66
## 
##        x                y            
##  Min.   :-32.98   Min.   :0.0000012  
##  1st Qu.:-11.74   1st Qu.:0.0003679  
##  Median :  9.50   Median :0.0035701  
##  Mean   :  9.50   Mean   :0.0117586  
##  3rd Qu.: 30.74   3rd Qu.:0.0137708  
##  Max.   : 51.98   Max.   :0.0584066  
## 
## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
##  ::: afinn_sent::POS (KDE)
## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
## 
## Call:
##  density.default(x = x, na.rm = TRUE)
## 
## Data: x (5604 obs.); Bandwidth &#39;bw&#39; = 1.195
## 
##        x                y            
##  Min.   :-11.59   Min.   :7.100e-07  
##  1st Qu.: 17.96   1st Qu.:1.262e-04  
## 
## ...
## and 7 more lines.</code></pre>
<p>We will use resampling to evaluate the model, again with 10 cross-fold validation sets.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="yelp-classification-and-sentiment-test.html#cb243-1"></a>yelp_folds &lt;-<span class="st"> </span><span class="kw">vfold_cv</span>(yelp_train)</span>
<span id="cb243-2"><a href="yelp-classification-and-sentiment-test.html#cb243-2"></a></span>
<span id="cb243-3"><a href="yelp-classification-and-sentiment-test.html#cb243-3"></a>nb_wf &lt;-<span class="st"> </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span></span>
<span id="cb243-4"><a href="yelp-classification-and-sentiment-test.html#cb243-4"></a><span class="st">  </span><span class="kw">add_recipe</span>(yelp_rec) <span class="op">%&gt;%</span></span>
<span id="cb243-5"><a href="yelp-classification-and-sentiment-test.html#cb243-5"></a><span class="st">  </span><span class="kw">add_model</span>(nb_spec)</span>
<span id="cb243-6"><a href="yelp-classification-and-sentiment-test.html#cb243-6"></a></span>
<span id="cb243-7"><a href="yelp-classification-and-sentiment-test.html#cb243-7"></a>nb_rs &lt;-<span class="st"> </span><span class="kw">fit_resamples</span>(</span>
<span id="cb243-8"><a href="yelp-classification-and-sentiment-test.html#cb243-8"></a>  nb_wf,</span>
<span id="cb243-9"><a href="yelp-classification-and-sentiment-test.html#cb243-9"></a>  yelp_folds,</span>
<span id="cb243-10"><a href="yelp-classification-and-sentiment-test.html#cb243-10"></a>  <span class="dt">control =</span> <span class="kw">control_resamples</span>(<span class="dt">save_pred =</span> <span class="ot">TRUE</span>)</span>
<span id="cb243-11"><a href="yelp-classification-and-sentiment-test.html#cb243-11"></a>)</span>
<span id="cb243-12"><a href="yelp-classification-and-sentiment-test.html#cb243-12"></a></span>
<span id="cb243-13"><a href="yelp-classification-and-sentiment-test.html#cb243-13"></a>nb_rs_metrics &lt;-<span class="st"> </span><span class="kw">collect_metrics</span>(nb_rs)</span>
<span id="cb243-14"><a href="yelp-classification-and-sentiment-test.html#cb243-14"></a>nb_rs_predictions &lt;-<span class="st"> </span><span class="kw">collect_predictions</span>(nb_rs)</span></code></pre></div>
<p>Let’s see the fit metrics:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="yelp-classification-and-sentiment-test.html#cb244-1"></a>nb_rs_metrics</span></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   .metric  .estimator  mean     n std_err
##   &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
## 1 accuracy binary     0.914    10 0.00283
## 2 roc_auc  binary     0.784    10 0.0121</code></pre>
<p>We can also plot an ROC curve, which is supposed to show a model’s accuracy and how well a model trades off false positives and false negatives. Better models are associated with curves that bend farther away from the line y=x (<em>citation needed</em>). According to the standard story about ROC curves, this looks okay.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="yelp-classification-and-sentiment-test.html#cb246-1"></a>nb_rs_predictions <span class="op">%&gt;%</span></span>
<span id="cb246-2"><a href="yelp-classification-and-sentiment-test.html#cb246-2"></a><span class="st">  </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span></span>
<span id="cb246-3"><a href="yelp-classification-and-sentiment-test.html#cb246-3"></a><span class="st">  </span><span class="kw">roc_curve</span>(<span class="dt">truth =</span> rating_factor, .pred_NEG) <span class="op">%&gt;%</span></span>
<span id="cb246-4"><a href="yelp-classification-and-sentiment-test.html#cb246-4"></a><span class="st">  </span><span class="kw">autoplot</span>() <span class="op">+</span></span>
<span id="cb246-5"><a href="yelp-classification-and-sentiment-test.html#cb246-5"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb246-6"><a href="yelp-classification-and-sentiment-test.html#cb246-6"></a>    <span class="dt">color =</span> <span class="ot">NULL</span>,</span>
<span id="cb246-7"><a href="yelp-classification-and-sentiment-test.html#cb246-7"></a>    <span class="dt">title =</span> <span class="st">&quot;Receiver operator curve for small Yelp dataset&quot;</span>,</span>
<span id="cb246-8"><a href="yelp-classification-and-sentiment-test.html#cb246-8"></a>    <span class="dt">subtitle =</span> <span class="st">&quot;Each resample fold is shown in a different color&quot;</span></span>
<span id="cb246-9"><a href="yelp-classification-and-sentiment-test.html#cb246-9"></a>  )</span></code></pre></div>
<p><img src="telfer-mba-nlp_files/figure-html/yelp_roc-1.png" width="672" /></p>
<p>We can also look at a heat map and a confusion matrix to see how often the model was correct and incorrect.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="yelp-classification-and-sentiment-test.html#cb247-1"></a>nb_rs_predictions <span class="op">%&gt;%</span></span>
<span id="cb247-2"><a href="yelp-classification-and-sentiment-test.html#cb247-2"></a><span class="st">  </span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> &quot;Fold01&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb247-3"><a href="yelp-classification-and-sentiment-test.html#cb247-3"></a><span class="st">  </span><span class="kw">conf_mat</span>(rating_factor, .pred_class) <span class="op">%&gt;%</span></span>
<span id="cb247-4"><a href="yelp-classification-and-sentiment-test.html#cb247-4"></a><span class="st">  </span><span class="kw">autoplot</span>(<span class="dt">type =</span> <span class="st">&quot;heatmap&quot;</span>)</span></code></pre></div>
<p><img src="telfer-mba-nlp_files/figure-html/yelp_confusionmatrix-1.png" width="672" /></p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="yelp-classification-and-sentiment-test.html#cb248-1"></a>nb_rs_predictions <span class="op">%&gt;%</span></span>
<span id="cb248-2"><a href="yelp-classification-and-sentiment-test.html#cb248-2"></a><span class="st">  </span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> &quot;Fold01&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb248-3"><a href="yelp-classification-and-sentiment-test.html#cb248-3"></a><span class="st">  </span><span class="kw">conf_mat</span>(rating_factor, .pred_class)</span></code></pre></div>
<pre><code>##           Truth
## Prediction NEG POS
##        NEG  18   2
##        POS  42 563</code></pre>
<p>But looking at the confusion matrix shows a problem: there are so many fewer true NEG cases that our model’s performance doesn’t mean much. The Bayes classifier achieved ~91.4% accuracy, but since ~89.7% of the data is classified as POS we could get nearly as much accuracy by just guessing “POS” in each case. The data is heavily <em>unbalanced</em>.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="yelp-classification-and-sentiment-test.html#cb250-1"></a>factor_yelp <span class="op">%&gt;%</span></span>
<span id="cb250-2"><a href="yelp-classification-and-sentiment-test.html#cb250-2"></a><span class="st">  </span><span class="kw">group_by</span>(rating_factor) <span class="op">%&gt;%</span></span>
<span id="cb250-3"><a href="yelp-classification-and-sentiment-test.html#cb250-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></span>
<span id="cb250-4"><a href="yelp-classification-and-sentiment-test.html#cb250-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pct =</span> n<span class="op">/</span><span class="kw">sum</span>(n))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 2 x 3
##   rating_factor     n   pct
##   &lt;fct&gt;         &lt;int&gt; &lt;dbl&gt;
## 1 NEG             853 0.102
## 2 POS            7472 0.898</code></pre>
<p>We need to <em>balance</em> our dataset so that there is a roughly equal number of positive and negative reviews. The easiest way is by downsampling, where you remove items from the larger set until you have two sets of about the same size. But to get a balanced dataset we would need to throw away nearly 80% of our data, and since our dataset is somewhat small we might not have enough to work with. <em>TODO</em> cite SMLTAR or Text Mining with R.</p>
<p>There are more sophisticated balancing approaches that are out of scope here, but the easiest approach for our puposes is to find a much larger public dataset to work with.</p>
</div>
</div>
<div id="kaggle-yelp-dataset" class="section level2">
<h2><span class="header-section-number">6.2</span> Kaggle Yelp dataset</h2>
<p>Yelp makes a huge dataset available for teaching and research <a href="https://www.kaggle.com/yelp-dataset/yelp-dataset">at this link</a> through Kaggle. A larger dataset will probably help us build a better model, especially if we need to balance our datasets to have roughly equal numbers of positive and negative reviews. The dataset is enormous: it has around 6 gigabytes of review text and around 5 million reviews. This is too big to load using conventional methods on my machine. After a few failures, I found <a href="https://stackoverflow.com/questions/53277351/read-first-1000-lines-from-very-big-json-lines-file-r">a discussion on StackOverflow</a> that helped me read just the first n lines from the jsonLine file and parse them.</p>
<p>For the present, we’ll read the first 100k reviews:</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="yelp-classification-and-sentiment-test.html#cb253-1"></a><span class="co"># figure out how to do it reading between the lines of this stackoverflow:</span></span>
<span id="cb253-2"><a href="yelp-classification-and-sentiment-test.html#cb253-2"></a><span class="co"># https://stackoverflow.com/questions/53277351/read-first-1000-lines-from-very-big-json-lines-file-r</span></span>
<span id="cb253-3"><a href="yelp-classification-and-sentiment-test.html#cb253-3"></a></span>
<span id="cb253-4"><a href="yelp-classification-and-sentiment-test.html#cb253-4"></a>yelp_big &lt;-<span class="st"> </span><span class="kw">readLines</span>(<span class="st">&quot;../tests/data/yelp_academic_dataset_review.json&quot;</span>, <span class="dt">n =</span> <span class="dv">100000</span>) <span class="op">%&gt;%</span></span>
<span id="cb253-5"><a href="yelp-classification-and-sentiment-test.html#cb253-5"></a><span class="st">  </span><span class="kw">textConnection</span>() <span class="op">%&gt;%</span></span>
<span id="cb253-6"><a href="yelp-classification-and-sentiment-test.html#cb253-6"></a><span class="st">  </span>jsonlite<span class="op">::</span><span class="kw">stream_in</span>(<span class="dt">verbose=</span><span class="ot">FALSE</span>)</span>
<span id="cb253-7"><a href="yelp-classification-and-sentiment-test.html#cb253-7"></a></span>
<span id="cb253-8"><a href="yelp-classification-and-sentiment-test.html#cb253-8"></a>yelp_big &lt;-<span class="st"> </span>yelp_big <span class="op">%&gt;%</span></span>
<span id="cb253-9"><a href="yelp-classification-and-sentiment-test.html#cb253-9"></a><span class="st">  </span><span class="kw">select</span>(stars, text)</span></code></pre></div>
<p>And plot a histogram of the star distributions. The star distributions look very similar to the data I collected manually, but with a slight spike at 1 that we didn’t find in my Yelp data. We did find this 1-spike in the MEC data, so there may be a common review phenomenon here.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="yelp-classification-and-sentiment-test.html#cb254-1"></a>yelp_big <span class="op">%&gt;%</span></span>
<span id="cb254-2"><a href="yelp-classification-and-sentiment-test.html#cb254-2"></a><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>stars)) <span class="op">+</span></span>
<span id="cb254-3"><a href="yelp-classification-and-sentiment-test.html#cb254-3"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins=</span><span class="dv">5</span>) <span class="op">+</span></span>
<span id="cb254-4"><a href="yelp-classification-and-sentiment-test.html#cb254-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Large Yelp Dataset: Histogram of Star Ratings (n=100,000)&quot;</span>)</span></code></pre></div>
<p><img src="telfer-mba-nlp_files/figure-html/yelp_big_hist-1.png" width="672" /></p>
<p>Let’s classify the reviews into NEG and POS again, once more classifying reviews with fewer than 3 stars as negative, more than 3 stars as positive, and discarding reviews with 3 stars.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="yelp-classification-and-sentiment-test.html#cb255-1"></a>yelp_big_factor &lt;-<span class="st"> </span>yelp_big <span class="op">%&gt;%</span></span>
<span id="cb255-2"><a href="yelp-classification-and-sentiment-test.html#cb255-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rating_factor =</span> <span class="kw">case_when</span>(</span>
<span id="cb255-3"><a href="yelp-classification-and-sentiment-test.html#cb255-3"></a>    stars <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span> <span class="op">~</span><span class="st"> &quot;NEG&quot;</span>,</span>
<span id="cb255-4"><a href="yelp-classification-and-sentiment-test.html#cb255-4"></a>    stars <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span> <span class="op">~</span><span class="st"> &quot;POS&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb255-5"><a href="yelp-classification-and-sentiment-test.html#cb255-5"></a><span class="st">      </span><span class="kw">as.factor</span>()</span>
<span id="cb255-6"><a href="yelp-classification-and-sentiment-test.html#cb255-6"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb255-7"><a href="yelp-classification-and-sentiment-test.html#cb255-7"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>stars) <span class="op">%&gt;%</span></span>
<span id="cb255-8"><a href="yelp-classification-and-sentiment-test.html#cb255-8"></a><span class="st">  </span><span class="kw">drop_na</span>()</span>
<span id="cb255-9"><a href="yelp-classification-and-sentiment-test.html#cb255-9"></a></span>
<span id="cb255-10"><a href="yelp-classification-and-sentiment-test.html#cb255-10"></a>yelp_big_factor <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summary</span>()</span></code></pre></div>
<pre><code>##      text           rating_factor
##  Length:88821       NEG:21928    
##  Class :character   POS:66893    
##  Mode  :character</code></pre>
<p>This dataset is quite imbalanced: there are ~67k positive reviews and ~22 negative reviews. Since classification engines can have trouble with unbalanced sets, we will <em>downsample</em> our dataset by randomly removing some positive reviews so that we have around the same number of negatvie and positive reviews. This new balanced dataset will have ~22k positive and negative reviews, still far more than we had in the dataset I collected myself.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="yelp-classification-and-sentiment-test.html#cb257-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb257-2"><a href="yelp-classification-and-sentiment-test.html#cb257-2"></a>yelp_balanced &lt;-<span class="st"> </span>yelp_big_factor <span class="op">%&gt;%</span></span>
<span id="cb257-3"><a href="yelp-classification-and-sentiment-test.html#cb257-3"></a><span class="st">  </span><span class="kw">filter</span>(rating_factor <span class="op">==</span><span class="st"> &quot;NEG&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb257-4"><a href="yelp-classification-and-sentiment-test.html#cb257-4"></a><span class="st">  </span><span class="kw">bind_rows</span>(yelp_big_factor<span class="op">%&gt;%</span></span>
<span id="cb257-5"><a href="yelp-classification-and-sentiment-test.html#cb257-5"></a><span class="st">              </span><span class="kw">filter</span>(rating_factor <span class="op">==</span><span class="st"> &quot;POS&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb257-6"><a href="yelp-classification-and-sentiment-test.html#cb257-6"></a><span class="st">              </span><span class="kw">slice_sample</span>(<span class="dt">n=</span>yelp_big_factor <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(rating_factor <span class="op">==</span><span class="st"> &quot;NEG&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>() ))</span>
<span id="cb257-7"><a href="yelp-classification-and-sentiment-test.html#cb257-7"></a></span>
<span id="cb257-8"><a href="yelp-classification-and-sentiment-test.html#cb257-8"></a>yelp_balanced <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summary</span>()</span></code></pre></div>
<pre><code>##      text           rating_factor
##  Length:43856       NEG:21928    
##  Class :character   POS:21928    
##  Mode  :character</code></pre>
<p>Let’s try AFINN again on the balanced set. First we’ll get the AFINN sentiments for all our reviews.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="yelp-classification-and-sentiment-test.html#cb259-1"></a><span class="kw">tic</span>()</span>
<span id="cb259-2"><a href="yelp-classification-and-sentiment-test.html#cb259-2"></a>afinn_yelp_big &lt;-<span class="st"> </span>yelp_balanced <span class="op">%&gt;%</span></span>
<span id="cb259-3"><a href="yelp-classification-and-sentiment-test.html#cb259-3"></a><span class="st">  </span><span class="kw">rowid_to_column</span>() <span class="op">%&gt;%</span></span>
<span id="cb259-4"><a href="yelp-classification-and-sentiment-test.html#cb259-4"></a><span class="st">  </span>tidytext<span class="op">::</span><span class="kw">unnest_tokens</span>(word, text) <span class="op">%&gt;%</span></span>
<span id="cb259-5"><a href="yelp-classification-and-sentiment-test.html#cb259-5"></a><span class="st">  </span><span class="kw">left_join</span>(afinn) <span class="op">%&gt;%</span></span>
<span id="cb259-6"><a href="yelp-classification-and-sentiment-test.html#cb259-6"></a><span class="st">  </span><span class="kw">group_by</span>(rowid) <span class="op">%&gt;%</span></span>
<span id="cb259-7"><a href="yelp-classification-and-sentiment-test.html#cb259-7"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">afinn_sent =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> T))</span>
<span id="cb259-8"><a href="yelp-classification-and-sentiment-test.html#cb259-8"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>## 9.96 sec elapsed</code></pre>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="yelp-classification-and-sentiment-test.html#cb261-1"></a>yelp_big_bal_afinn &lt;-<span class="st"> </span>afinn_yelp_big <span class="op">%&gt;%</span></span>
<span id="cb261-2"><a href="yelp-classification-and-sentiment-test.html#cb261-2"></a><span class="st">  </span><span class="kw">left_join</span>(yelp_balanced <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowid_to_column</span>()) <span class="op">%&gt;%</span></span>
<span id="cb261-3"><a href="yelp-classification-and-sentiment-test.html#cb261-3"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>rowid)</span></code></pre></div>
<p>And we can make a boxplot of the AFINN distributions for POS and NEG reviews. There is enough difference between the POS and NEG reviews that this looks like it might plausibly work.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="yelp-classification-and-sentiment-test.html#cb262-1"></a>yelp_big_bal_afinn <span class="op">%&gt;%</span></span>
<span id="cb262-2"><a href="yelp-classification-and-sentiment-test.html#cb262-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>rating_factor,<span class="dt">y=</span>afinn_sent)) <span class="op">+</span></span>
<span id="cb262-3"><a href="yelp-classification-and-sentiment-test.html#cb262-3"></a><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></span>
<span id="cb262-4"><a href="yelp-classification-and-sentiment-test.html#cb262-4"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb262-5"><a href="yelp-classification-and-sentiment-test.html#cb262-5"></a>    <span class="dt">title =</span> <span class="st">&quot;AFINN Scores by Star Rating&quot;</span>,</span>
<span id="cb262-6"><a href="yelp-classification-and-sentiment-test.html#cb262-6"></a>    <span class="dt">subtitle =</span> <span class="kw">paste0</span>(<span class="st">&quot;Big Yelp dataset (n=&quot;</span>,<span class="kw">nrow</span>(yelp_big_bal_afinn),<span class="st">&quot;)&quot;</span>),</span>
<span id="cb262-7"><a href="yelp-classification-and-sentiment-test.html#cb262-7"></a>    <span class="dt">x =</span> <span class="st">&quot;Star Rating&quot;</span>,</span>
<span id="cb262-8"><a href="yelp-classification-and-sentiment-test.html#cb262-8"></a>    <span class="dt">y =</span> <span class="st">&quot;AFINN Sentiment Score&quot;</span></span>
<span id="cb262-9"><a href="yelp-classification-and-sentiment-test.html#cb262-9"></a>  )</span></code></pre></div>
<p><img src="telfer-mba-nlp_files/figure-html/big_yelp_boxplot-1.png" width="672" /></p>
<p>And for another view, here’s a density plot:</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="yelp-classification-and-sentiment-test.html#cb263-1"></a>yelp_big_bal_afinn <span class="op">%&gt;%</span></span>
<span id="cb263-2"><a href="yelp-classification-and-sentiment-test.html#cb263-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>afinn_sent, <span class="dt">fill=</span>rating_factor)) <span class="op">+</span></span>
<span id="cb263-3"><a href="yelp-classification-and-sentiment-test.html#cb263-3"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">alpha=</span><span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb263-4"><a href="yelp-classification-and-sentiment-test.html#cb263-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Density Distributions of AFINN Sentiment for POS and NEG Reviews&quot;</span>,</span>
<span id="cb263-5"><a href="yelp-classification-and-sentiment-test.html#cb263-5"></a>       <span class="dt">subtitle =</span> <span class="st">&quot;Large Balanced Yelp Dataset, n=43,855&quot;</span>,</span>
<span id="cb263-6"><a href="yelp-classification-and-sentiment-test.html#cb263-6"></a>       <span class="dt">x =</span> <span class="st">&quot;AFINN Sentiment&quot;</span>,</span>
<span id="cb263-7"><a href="yelp-classification-and-sentiment-test.html#cb263-7"></a>       <span class="dt">y =</span><span class="st">&quot;Density&quot;</span>)</span></code></pre></div>
<p><img src="telfer-mba-nlp_files/figure-html/big_yelp_density-1.png" width="672" /></p>
<div id="naive-bayes-classifier" class="section level3">
<h3><span class="header-section-number">6.2.1</span> Naive Bayes Classifier</h3>
<p>We will again go through the tidymodels process of setting up a naive Bayes classifier. First we do a test/train split of our large balanced dataset.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="yelp-classification-and-sentiment-test.html#cb264-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb264-2"><a href="yelp-classification-and-sentiment-test.html#cb264-2"></a></span>
<span id="cb264-3"><a href="yelp-classification-and-sentiment-test.html#cb264-3"></a>yelp_split &lt;-<span class="st"> </span><span class="kw">initial_split</span>(yelp_big_bal_afinn, <span class="dt">strata =</span> rating_factor)</span>
<span id="cb264-4"><a href="yelp-classification-and-sentiment-test.html#cb264-4"></a></span>
<span id="cb264-5"><a href="yelp-classification-and-sentiment-test.html#cb264-5"></a>yelp_test &lt;-<span class="st"> </span><span class="kw">testing</span>(yelp_split)</span>
<span id="cb264-6"><a href="yelp-classification-and-sentiment-test.html#cb264-6"></a></span>
<span id="cb264-7"><a href="yelp-classification-and-sentiment-test.html#cb264-7"></a>yelp_train &lt;-<span class="st"> </span><span class="kw">training</span>(yelp_split)</span></code></pre></div>
<p>Then we set up a recipe, a naive Bayes model, and a workflow, and then fit our model to our training data.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="yelp-classification-and-sentiment-test.html#cb265-1"></a>yelp_rec &lt;-<span class="st"> </span><span class="kw">recipe</span>(rating_factor <span class="op">~</span><span class="st"> </span>afinn_sent,</span>
<span id="cb265-2"><a href="yelp-classification-and-sentiment-test.html#cb265-2"></a>                   <span class="dt">data =</span> yelp_train)</span>
<span id="cb265-3"><a href="yelp-classification-and-sentiment-test.html#cb265-3"></a></span>
<span id="cb265-4"><a href="yelp-classification-and-sentiment-test.html#cb265-4"></a>yelp_wf &lt;-<span class="st"> </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span></span>
<span id="cb265-5"><a href="yelp-classification-and-sentiment-test.html#cb265-5"></a><span class="st">  </span><span class="kw">add_recipe</span>(yelp_rec)</span>
<span id="cb265-6"><a href="yelp-classification-and-sentiment-test.html#cb265-6"></a></span>
<span id="cb265-7"><a href="yelp-classification-and-sentiment-test.html#cb265-7"></a>nb_spec &lt;-<span class="st"> </span><span class="kw">naive_Bayes</span>() <span class="op">%&gt;%</span></span>
<span id="cb265-8"><a href="yelp-classification-and-sentiment-test.html#cb265-8"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">&quot;classification&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb265-9"><a href="yelp-classification-and-sentiment-test.html#cb265-9"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;naivebayes&quot;</span>)</span>
<span id="cb265-10"><a href="yelp-classification-and-sentiment-test.html#cb265-10"></a></span>
<span id="cb265-11"><a href="yelp-classification-and-sentiment-test.html#cb265-11"></a>nb_fit &lt;-<span class="st"> </span>yelp_wf <span class="op">%&gt;%</span></span>
<span id="cb265-12"><a href="yelp-classification-and-sentiment-test.html#cb265-12"></a><span class="st">  </span><span class="kw">add_model</span>(nb_spec) <span class="op">%&gt;%</span></span>
<span id="cb265-13"><a href="yelp-classification-and-sentiment-test.html#cb265-13"></a><span class="st">  </span><span class="kw">fit</span>(<span class="dt">data =</span> yelp_train)</span>
<span id="cb265-14"><a href="yelp-classification-and-sentiment-test.html#cb265-14"></a></span>
<span id="cb265-15"><a href="yelp-classification-and-sentiment-test.html#cb265-15"></a>nb_fit</span></code></pre></div>
<pre><code>## == Workflow [trained] ==========================================================
## Preprocessor: Recipe
## Model: naive_Bayes()
## 
## -- Preprocessor ----------------------------------------------------------------
## 0 Recipe Steps
## 
## -- Model -----------------------------------------------------------------------
## 
## ======================================================================================== Naive Bayes ========================================================================================= 
##  
##  Call: 
## naive_bayes.default(x = maybe_data_frame(x), y = y, usekernel = TRUE)
## 
## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
##  
## Laplace smoothing: 0
## 
## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
##  
##  A priori probabilities: 
## 
## NEG POS 
## 0.5 0.5 
## 
## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
##  
##  Tables: 
## 
## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
##  ::: afinn_sent::NEG (KDE)
## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
## 
## Call:
##  density.default(x = x, na.rm = TRUE)
## 
## Data: x (16446 obs.);    Bandwidth &#39;bw&#39; = 0.7709
## 
##        x                y            
##  Min.   :-64.31   Min.   :0.000e+00  
##  1st Qu.:-29.41   1st Qu.:2.549e-05  
##  Median :  5.50   Median :2.295e-04  
##  Mean   :  5.50   Mean   :7.155e-03  
##  3rd Qu.: 40.41   3rd Qu.:3.387e-03  
##  Max.   : 75.31   Max.   :7.088e-02  
## 
## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
##  ::: afinn_sent::POS (KDE)
## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
## 
## Call:
##  density.default(x = x, na.rm = TRUE)
## 
## Data: x (16446 obs.);    Bandwidth &#39;bw&#39; = 0.9637
## 
##        x                 y            
##  Min.   :-33.891   Min.   :0.0000000  
##  1st Qu.:  2.054   1st Qu.:0.0000199  
## 
## ...
## and 7 more lines.</code></pre>
<p>Then we use resampling to evaluate the model, again with 10 cross-fold validation sets.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="yelp-classification-and-sentiment-test.html#cb267-1"></a>yelp_folds &lt;-<span class="st"> </span><span class="kw">vfold_cv</span>(yelp_train)</span>
<span id="cb267-2"><a href="yelp-classification-and-sentiment-test.html#cb267-2"></a></span>
<span id="cb267-3"><a href="yelp-classification-and-sentiment-test.html#cb267-3"></a>nb_wf &lt;-<span class="st"> </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span></span>
<span id="cb267-4"><a href="yelp-classification-and-sentiment-test.html#cb267-4"></a><span class="st">  </span><span class="kw">add_recipe</span>(yelp_rec) <span class="op">%&gt;%</span></span>
<span id="cb267-5"><a href="yelp-classification-and-sentiment-test.html#cb267-5"></a><span class="st">  </span><span class="kw">add_model</span>(nb_spec)</span>
<span id="cb267-6"><a href="yelp-classification-and-sentiment-test.html#cb267-6"></a></span>
<span id="cb267-7"><a href="yelp-classification-and-sentiment-test.html#cb267-7"></a>nb_rs &lt;-<span class="st"> </span><span class="kw">fit_resamples</span>(</span>
<span id="cb267-8"><a href="yelp-classification-and-sentiment-test.html#cb267-8"></a>  nb_wf,</span>
<span id="cb267-9"><a href="yelp-classification-and-sentiment-test.html#cb267-9"></a>  yelp_folds,</span>
<span id="cb267-10"><a href="yelp-classification-and-sentiment-test.html#cb267-10"></a>  <span class="dt">control =</span> <span class="kw">control_resamples</span>(<span class="dt">save_pred =</span> <span class="ot">TRUE</span>)</span>
<span id="cb267-11"><a href="yelp-classification-and-sentiment-test.html#cb267-11"></a>)</span>
<span id="cb267-12"><a href="yelp-classification-and-sentiment-test.html#cb267-12"></a></span>
<span id="cb267-13"><a href="yelp-classification-and-sentiment-test.html#cb267-13"></a>nb_rs_metrics &lt;-<span class="st"> </span><span class="kw">collect_metrics</span>(nb_rs)</span>
<span id="cb267-14"><a href="yelp-classification-and-sentiment-test.html#cb267-14"></a>nb_rs_predictions &lt;-<span class="st"> </span><span class="kw">collect_predictions</span>(nb_rs)</span></code></pre></div>
<p>Let’s see the fit metrics. Our accuracy is ~78.7%, which is quite a bit better than chance so there is good evidence that the model is getting something right.</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="yelp-classification-and-sentiment-test.html#cb268-1"></a><span class="co"># create a character a vector with the accuracy % that we can use in the text later</span></span>
<span id="cb268-2"><a href="yelp-classification-and-sentiment-test.html#cb268-2"></a>nb_acc &lt;-<span class="st"> </span>nb_rs_metrics <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(mean) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> `</span><span class="dt">*</span><span class="st">`</span>(<span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;%&quot;</span>,.)</span>
<span id="cb268-3"><a href="yelp-classification-and-sentiment-test.html#cb268-3"></a></span>
<span id="cb268-4"><a href="yelp-classification-and-sentiment-test.html#cb268-4"></a><span class="co"># print out the metrics</span></span>
<span id="cb268-5"><a href="yelp-classification-and-sentiment-test.html#cb268-5"></a>nb_rs_metrics</span></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   .metric  .estimator  mean     n std_err
##   &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
## 1 accuracy binary     0.787    10 0.00188
## 2 roc_auc  binary     0.854    10 0.00167</code></pre>
<p>We can also look at the ROC curve, which again shows some good performance:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="yelp-classification-and-sentiment-test.html#cb270-1"></a>nb_rs_predictions <span class="op">%&gt;%</span></span>
<span id="cb270-2"><a href="yelp-classification-and-sentiment-test.html#cb270-2"></a><span class="st">  </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span></span>
<span id="cb270-3"><a href="yelp-classification-and-sentiment-test.html#cb270-3"></a><span class="st">  </span><span class="kw">roc_curve</span>(<span class="dt">truth =</span> rating_factor, .pred_NEG) <span class="op">%&gt;%</span></span>
<span id="cb270-4"><a href="yelp-classification-and-sentiment-test.html#cb270-4"></a><span class="st">  </span><span class="kw">autoplot</span>() <span class="op">+</span></span>
<span id="cb270-5"><a href="yelp-classification-and-sentiment-test.html#cb270-5"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb270-6"><a href="yelp-classification-and-sentiment-test.html#cb270-6"></a>    <span class="dt">color =</span> <span class="ot">NULL</span>,</span>
<span id="cb270-7"><a href="yelp-classification-and-sentiment-test.html#cb270-7"></a>    <span class="dt">title =</span> <span class="st">&quot;Receiver operator curve for big balanced Yelp dataset, AFINN sentiment&quot;</span>,</span>
<span id="cb270-8"><a href="yelp-classification-and-sentiment-test.html#cb270-8"></a>    <span class="dt">subtitle =</span> <span class="st">&quot;Each resample fold is shown in a different color&quot;</span></span>
<span id="cb270-9"><a href="yelp-classification-and-sentiment-test.html#cb270-9"></a>  )</span></code></pre></div>
<p><img src="telfer-mba-nlp_files/figure-html/big_nb_ROC-1.png" width="672" /></p>
<p>And a confusion matrix:</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="yelp-classification-and-sentiment-test.html#cb271-1"></a>nb_rs_predictions <span class="op">%&gt;%</span></span>
<span id="cb271-2"><a href="yelp-classification-and-sentiment-test.html#cb271-2"></a><span class="st">  </span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> &quot;Fold01&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb271-3"><a href="yelp-classification-and-sentiment-test.html#cb271-3"></a><span class="st">  </span><span class="kw">conf_mat</span>(rating_factor, .pred_class) <span class="op">%&gt;%</span></span>
<span id="cb271-4"><a href="yelp-classification-and-sentiment-test.html#cb271-4"></a><span class="st">  </span><span class="kw">autoplot</span>(<span class="dt">type =</span> <span class="st">&quot;heatmap&quot;</span>)</span></code></pre></div>
<p><img src="telfer-mba-nlp_files/figure-html/big_nb_confusion-1.png" width="672" /></p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="yelp-classification-and-sentiment-test.html#cb272-1"></a>nb_rs_predictions <span class="op">%&gt;%</span></span>
<span id="cb272-2"><a href="yelp-classification-and-sentiment-test.html#cb272-2"></a><span class="st">  </span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> &quot;Fold01&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb272-3"><a href="yelp-classification-and-sentiment-test.html#cb272-3"></a><span class="st">  </span><span class="kw">conf_mat</span>(rating_factor, .pred_class)</span></code></pre></div>
<pre><code>##           Truth
## Prediction  NEG  POS
##        NEG 1195  230
##        POS  448 1417</code></pre>
<p>Our naive Bayes classifier did quite a bit better than chance on our balanced dataset. We would have expected about 50% accuracy by chance, and it was accurate %78.7 of the time on our training data.</p>
</div>
<div id="logistic-regression" class="section level3">
<h3><span class="header-section-number">6.2.2</span> Logistic Regression</h3>
<p>It’s also worth trying a logistic regression, for at least two reasons:</p>
<ul>
<li>It’s good practice; and</li>
<li>It’s a simple and common model.</li>
</ul>
<p>For the code here, I referred to <a href="https://rpubs.com/ryankelly/ml_logistic">this website</a> to remind me of the basics of doing logistic regression in R. I elected not to do it in a tidymodels framework.</p>
<p>We’ll use the same big balanced dataset. First we’ll split our data into testing and training:</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="yelp-classification-and-sentiment-test.html#cb274-1"></a>index &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(T,F), </span>
<span id="cb274-2"><a href="yelp-classification-and-sentiment-test.html#cb274-2"></a>                <span class="dt">size =</span> <span class="kw">nrow</span>(yelp_big_bal_afinn),</span>
<span id="cb274-3"><a href="yelp-classification-and-sentiment-test.html#cb274-3"></a>                <span class="dt">replace =</span> T,</span>
<span id="cb274-4"><a href="yelp-classification-and-sentiment-test.html#cb274-4"></a>                <span class="dt">prob=</span><span class="kw">c</span>(<span class="fl">0.75</span>,<span class="fl">0.25</span>))</span>
<span id="cb274-5"><a href="yelp-classification-and-sentiment-test.html#cb274-5"></a></span>
<span id="cb274-6"><a href="yelp-classification-and-sentiment-test.html#cb274-6"></a>train &lt;-<span class="st"> </span>yelp_big_bal_afinn[index,]</span>
<span id="cb274-7"><a href="yelp-classification-and-sentiment-test.html#cb274-7"></a></span>
<span id="cb274-8"><a href="yelp-classification-and-sentiment-test.html#cb274-8"></a>test &lt;-<span class="st"> </span>yelp_big_bal_afinn[<span class="op">!</span>index,]</span></code></pre></div>
<p>Then we’ll use <code>glm()</code> to run a simple logistic regression, predicting the rating factor based on the AFINN sentiment score. Here is the model output:</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="yelp-classification-and-sentiment-test.html#cb275-1"></a>logit &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="dt">data=</span> train,</span>
<span id="cb275-2"><a href="yelp-classification-and-sentiment-test.html#cb275-2"></a>             <span class="dt">formula=</span> rating_factor <span class="op">~</span><span class="st"> </span>afinn_sent,</span>
<span id="cb275-3"><a href="yelp-classification-and-sentiment-test.html#cb275-3"></a>             <span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb275-4"><a href="yelp-classification-and-sentiment-test.html#cb275-4"></a></span>
<span id="cb275-5"><a href="yelp-classification-and-sentiment-test.html#cb275-5"></a><span class="kw">summary</span>(logit)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = rating_factor ~ afinn_sent, family = &quot;binomial&quot;, 
##     data = train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -4.6936  -0.7363   0.0076   0.8166   3.7598  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.166717   0.018845  -61.91   &lt;2e-16 ***
## afinn_sent   0.190342   0.002265   84.03   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 45641  on 32922  degrees of freedom
## Residual deviance: 32490  on 32921  degrees of freedom
## AIC: 32494
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>Our results are strongly significant, so we have some reason to take this model seriously.</p>
<p>Referring to <a href="https://www.machinelearningplus.com/machine-learning/logistic-regression-tutorial-examples-r/#:~:text=Logistic%20regression%20is%20a%20predictive,the%20probability%20of%20event%201.">this website for more pointers</a>, we can use our logistic regression results to predict rating scores for our test dataset. The simplest way to do this is to say that we predict whichever outcome the model says is more likely. In other words, if a review has a predicted probability &gt;0.5 of being positive, then we predict it’s positive. How accurate would we be?</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="yelp-classification-and-sentiment-test.html#cb277-1"></a>pred &lt;-<span class="st"> </span><span class="kw">predict</span>(logit, </span>
<span id="cb277-2"><a href="yelp-classification-and-sentiment-test.html#cb277-2"></a>        <span class="dt">newdata =</span> test,</span>
<span id="cb277-3"><a href="yelp-classification-and-sentiment-test.html#cb277-3"></a>        <span class="dt">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb277-4"><a href="yelp-classification-and-sentiment-test.html#cb277-4"></a></span>
<span id="cb277-5"><a href="yelp-classification-and-sentiment-test.html#cb277-5"></a>test_results &lt;-<span class="st"> </span>test <span class="op">%&gt;%</span></span>
<span id="cb277-6"><a href="yelp-classification-and-sentiment-test.html#cb277-6"></a><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">tibble</span>(<span class="dt">pred =</span> pred)) <span class="op">%&gt;%</span></span>
<span id="cb277-7"><a href="yelp-classification-and-sentiment-test.html#cb277-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pred =</span> <span class="kw">if_else</span>(pred <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="st">&quot;POS&quot;</span>, <span class="st">&quot;NEG&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb277-8"><a href="yelp-classification-and-sentiment-test.html#cb277-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">correct =</span> <span class="kw">if_else</span> (pred <span class="op">==</span><span class="st"> </span>rating_factor, T, F)) <span class="op">%&gt;%</span></span>
<span id="cb277-9"><a href="yelp-classification-and-sentiment-test.html#cb277-9"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">accuracy =</span> <span class="kw">sum</span>(correct) <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(.))</span>
<span id="cb277-10"><a href="yelp-classification-and-sentiment-test.html#cb277-10"></a></span>
<span id="cb277-11"><a href="yelp-classification-and-sentiment-test.html#cb277-11"></a>logit_acc &lt;-<span class="st"> </span>test_results <span class="op">%&gt;%</span><span class="st"> `</span><span class="dt">*</span><span class="st">`</span>(<span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;%&quot;</span>,.)</span></code></pre></div>
<p>For this data, a simple logistic regression was only a little bit less accurate than the naive Bayes classifier: %76.848, as opposed to %78.7.</p>
</div>
</div>
<div id="next-steps" class="section level2">
<h2><span class="header-section-number">6.3</span> NEXT STEPS</h2>
<ul>
<li>Consider another sentiment-detection algorithm / dictionary.</li>
<li>Naive Bayes classifier based on review text, intead of AFINN sentiment score.</li>
<li>Consider review length as a tuning paramter.</li>
</ul>
</div>
<div id="sessioninfo-1" class="section level2">
<h2><span class="header-section-number">6.4</span> SessionInfo</h2>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="yelp-classification-and-sentiment-test.html#cb278-1"></a><span class="kw">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.0.2 (2020-06-22)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 18363)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=English_Canada.1252  LC_CTYPE=English_Canada.1252    LC_MONETARY=English_Canada.1252 LC_NUMERIC=C                    LC_TIME=English_Canada.1252    
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] vip_0.2.2         glmnet_4.0-2      Matrix_1.2-18     ggridges_0.5.2    discrim_0.1.1     tictoc_1.0        textrecipes_0.3.0 lubridate_1.7.9   yardstick_0.0.7   workflows_0.2.0  
## [11] tune_0.1.1        rsample_0.0.8     recipes_0.1.13    parsnip_0.1.4     modeldata_0.0.2   infer_0.5.3       dials_0.0.9       scales_1.1.1      broom_0.7.0       tidymodels_0.1.1 
## [21] tidytext_0.2.5    forcats_0.5.0     stringr_1.4.0     dplyr_1.0.2       purrr_0.3.4       readr_1.3.1       tidyr_1.1.1       tibble_3.0.3      ggplot2_3.3.2     tidyverse_1.3.0  
## 
## loaded via a namespace (and not attached):
##  [1] colorspace_1.4-1   ellipsis_0.3.1     class_7.3-17       fs_1.5.0           rstudioapi_0.11    listenv_0.8.0      furrr_0.1.0        farver_2.0.3       SnowballC_0.7.0   
## [10] prodlim_2019.11.13 fansi_0.4.1        xml2_1.3.2         codetools_0.2-16   splines_4.0.2      knitr_1.29         jsonlite_1.7.0     pROC_1.16.2        packrat_0.5.0     
## [19] dbplyr_1.4.4       compiler_4.0.2     httr_1.4.2         backports_1.1.7    assertthat_0.2.1   cli_2.0.2          htmltools_0.5.0    tools_4.0.2        gtable_0.3.0      
## [28] glue_1.4.1         naivebayes_0.9.7   rappdirs_0.3.1     Rcpp_1.0.5         cellranger_1.1.0   DiceDesign_1.8-1   vctrs_0.3.2        iterators_1.0.12   timeDate_3043.102 
## [37] gower_0.2.2        xfun_0.16          stopwords_2.0      globals_0.13.0     rvest_0.3.6        lifecycle_0.2.0    future_1.19.1      MASS_7.3-51.6      ipred_0.9-9       
## [46] hms_0.5.3          parallel_4.0.2     yaml_2.2.1         gridExtra_2.3      rpart_4.1-15       stringi_1.4.6      highr_0.8          tokenizers_0.2.1   foreach_1.5.0     
## [55] textdata_0.4.1     lhs_1.0.2          hardhat_0.1.4      shape_1.4.5        lava_1.6.8         rlang_0.4.7        pkgconfig_2.0.3    evaluate_0.14      lattice_0.20-41   
## [64] labeling_0.3       tidyselect_1.1.0   plyr_1.8.6         magrittr_1.5       bookdown_0.20      R6_2.4.1           generics_0.0.2     DBI_1.1.0          pillar_1.4.6      
## [73] haven_2.3.1        withr_2.2.0        survival_3.1-12    nnet_7.3-14        janeaustenr_0.1.5  modelr_0.1.8       crayon_1.3.4       utf8_1.1.4         rmarkdown_2.3     
## [82] usethis_1.6.1      grid_4.0.2         readxl_1.3.1       blob_1.2.1         reprex_0.3.0       digest_0.6.25      webshot_0.5.2      munsell_0.5.0      GPfit_1.0-8       
## [91] viridisLite_0.3.0  kableExtra_1.1.0</code></pre>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-liu_sentiment_2015">
<p>Liu, Bing. 2015. <em>Sentiment Analysis: Mining Opinions, Sentiments, and Emotions</em>. Cambridge: Cambridge University Press. <a href="https://doi.org/10.1017/CBO9781139084789">https://doi.org/10.1017/CBO9781139084789</a>.</p>
</div>
<div id="ref-silge_supervised_2020">
<p>Silge, Julia, and Emil Hvitfeldt. 2020. <em>Supervised Machine Learning for Text Analysis in R</em>. <a href="https://smltar.com/">https://smltar.com/</a>.</p>
</div>
<div id="ref-silge_text_2020">
<p>Silge, Julia, and David Robinson. 2020. <em>Text Mining with R: A Tidy Approach</em>. O’Reilly. <a href="https://www.tidytextmining.com/index.html">https://www.tidytextmining.com/index.html</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="a-first-lasso-attempt.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/05-sentiment.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["telfer-mba-nlp.pdf", "telfer-mba-nlp.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
