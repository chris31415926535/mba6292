<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 A First LASSO Attempt | Telfer 2020 Directed Reading: Natural Language Processing</title>
  <meta name="description" content="This is Christopher Belanger’s work product for the Telfer School of Management course MBA6292, Directed Readings in Natural Language Processing." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 A First LASSO Attempt | Telfer 2020 Directed Reading: Natural Language Processing" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is Christopher Belanger’s work product for the Telfer School of Management course MBA6292, Directed Readings in Natural Language Processing." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 A First LASSO Attempt | Telfer 2020 Directed Reading: Natural Language Processing" />
  
  <meta name="twitter:description" content="This is Christopher Belanger’s work product for the Telfer School of Management course MBA6292, Directed Readings in Natural Language Processing." />
  

<meta name="author" content="Christopher Belanger" />


<meta name="date" content="2020-12-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-summary-eda-initial-model-attempts.html"/>
<link rel="next" href="yelp-classification-and-sentiment-test.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MBA6292: Directed Readings in NLP</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html"><i class="fa fa-check"></i><b>3</b> Web Scraping Our Data</a><ul>
<li class="chapter" data-level="3.1" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#foreword-ethics-legality"><i class="fa fa-check"></i><b>3.1</b> Foreword: Ethics &amp; Legality</a></li>
<li class="chapter" data-level="3.2" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#the-general-idea"><i class="fa fa-check"></i><b>3.2</b> The General Idea</a></li>
<li class="chapter" data-level="3.3" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#goodreads-css-selectors"><i class="fa fa-check"></i><b>3.3</b> Goodreads: CSS Selectors</a><ul>
<li class="chapter" data-level="3.3.1" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-index"><i class="fa fa-check"></i><b>3.3.1</b> Scraping the Index</a></li>
<li class="chapter" data-level="3.3.2" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-content"><i class="fa fa-check"></i><b>3.3.2</b> Scraping the Content</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#yelp-embedded-json"><i class="fa fa-check"></i><b>3.4</b> Yelp: Embedded JSON</a><ul>
<li class="chapter" data-level="3.4.1" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-index-1"><i class="fa fa-check"></i><b>3.4.1</b> Scraping the Index</a></li>
<li class="chapter" data-level="3.4.2" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-content-1"><i class="fa fa-check"></i><b>3.4.2</b> Scraping the Content</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#mec-reverse-engineering-client-side-api-calls"><i class="fa fa-check"></i><b>3.5</b> MEC: Reverse-Engineering Client-Side API Calls</a><ul>
<li class="chapter" data-level="3.5.1" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-index-2"><i class="fa fa-check"></i><b>3.5.1</b> Scraping the Index</a></li>
<li class="chapter" data-level="3.5.2" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#functions-for-api-calls"><i class="fa fa-check"></i><b>3.5.2</b> Functions for API Calls</a></li>
<li class="chapter" data-level="3.5.3" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#scraping-the-content-2"><i class="fa fa-check"></i><b>3.5.3</b> Scraping the Content</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="web-scraping-our-data.html"><a href="web-scraping-our-data.html#summary"><i class="fa fa-check"></i><b>3.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html"><i class="fa fa-check"></i><b>4</b> Data Summary, EDA, &amp; Initial Model Attempts</a><ul>
<li class="chapter" data-level="4.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#goodreads"><i class="fa fa-check"></i><b>4.2</b> Goodreads</a><ul>
<li class="chapter" data-level="4.2.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#star-ratings"><i class="fa fa-check"></i><b>4.2.1</b> Star Ratings</a></li>
<li class="chapter" data-level="4.2.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#word-count"><i class="fa fa-check"></i><b>4.2.2</b> Word Count</a></li>
<li class="chapter" data-level="4.2.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#reviewers"><i class="fa fa-check"></i><b>4.2.3</b> Reviewers</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#yelp"><i class="fa fa-check"></i><b>4.3</b> Yelp</a><ul>
<li class="chapter" data-level="4.3.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#star-ratings-1"><i class="fa fa-check"></i><b>4.3.1</b> Star Ratings</a></li>
<li class="chapter" data-level="4.3.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#word-count-1"><i class="fa fa-check"></i><b>4.3.2</b> Word Count</a></li>
<li class="chapter" data-level="4.3.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#reviewers-1"><i class="fa fa-check"></i><b>4.3.3</b> Reviewers</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#mountain-equipment-co-op-mec"><i class="fa fa-check"></i><b>4.4</b> Mountain Equipment Co-op (MEC)</a><ul>
<li class="chapter" data-level="4.4.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#star-ratings-2"><i class="fa fa-check"></i><b>4.4.1</b> Star Ratings</a></li>
<li class="chapter" data-level="4.4.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#word-counts"><i class="fa fa-check"></i><b>4.4.2</b> Word Counts</a></li>
<li class="chapter" data-level="4.4.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#reviewers-2"><i class="fa fa-check"></i><b>4.4.3</b> Reviewers</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#comparing-goodreads-mec-and-yelp"><i class="fa fa-check"></i><b>4.5</b> Comparing Goodreads, MEC, and Yelp</a><ul>
<li class="chapter" data-level="4.5.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#star-ratings-3"><i class="fa fa-check"></i><b>4.5.1</b> Star Ratings</a></li>
<li class="chapter" data-level="4.5.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#word-counts-1"><i class="fa fa-check"></i><b>4.5.2</b> Word Counts</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#reviews-over-time"><i class="fa fa-check"></i><b>4.6</b> Reviews Over Time</a><ul>
<li class="chapter" data-level="4.6.1" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#goodreads-1"><i class="fa fa-check"></i><b>4.6.1</b> Goodreads</a></li>
<li class="chapter" data-level="4.6.2" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#yelp-1"><i class="fa fa-check"></i><b>4.6.2</b> Yelp</a></li>
<li class="chapter" data-level="4.6.3" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#mec"><i class="fa fa-check"></i><b>4.6.3</b> MEC</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#proposed-next-steps"><i class="fa fa-check"></i><b>4.7</b> Proposed Next Steps</a></li>
<li class="chapter" data-level="4.8" data-path="data-summary-eda-initial-model-attempts.html"><a href="data-summary-eda-initial-model-attempts.html#sessioninfo"><i class="fa fa-check"></i><b>4.8</b> SessionInfo</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html"><i class="fa fa-check"></i><b>5</b> A First LASSO Attempt</a><ul>
<li class="chapter" data-level="5.1" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#introduction-1"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#a-first-regression-yelp-data"><i class="fa fa-check"></i><b>5.2</b> A First Regression: Yelp Data</a><ul>
<li class="chapter" data-level="5.2.1" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#splitting-the-data"><i class="fa fa-check"></i><b>5.2.1</b> Splitting the data</a></li>
<li class="chapter" data-level="5.2.2" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#evaluating-the-first-model"><i class="fa fa-check"></i><b>5.2.2</b> Evaluating the first model</a></li>
<li class="chapter" data-level="5.2.3" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#tuning-model-parameters"><i class="fa fa-check"></i><b>5.2.3</b> Tuning model parameters</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#trying-lasso-again"><i class="fa fa-check"></i><b>5.3</b> Trying lasso again</a><ul>
<li class="chapter" data-level="5.3.1" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#with-1000-tokens"><i class="fa fa-check"></i><b>5.3.1</b> With 1000 tokens</a></li>
<li class="chapter" data-level="5.3.2" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#short-reviews-only-125-words"><i class="fa fa-check"></i><b>5.3.2</b> Short reviews only: &lt;125 words</a></li>
<li class="chapter" data-level="5.3.3" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#longer-reviews-125-words"><i class="fa fa-check"></i><b>5.3.3</b> Longer reviews &gt; 125 words</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#removing-stop-words"><i class="fa fa-check"></i><b>5.4</b> Removing stop words</a></li>
<li class="chapter" data-level="5.5" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#adjusting-n-grams"><i class="fa fa-check"></i><b>5.5</b> Adjusting n-grams</a></li>
<li class="chapter" data-level="5.6" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#full-final-regression"><i class="fa fa-check"></i><b>5.6</b> Full final regression</a></li>
<li class="chapter" data-level="5.7" data-path="a-first-lasso-attempt.html"><a href="a-first-lasso-attempt.html#conclusion"><i class="fa fa-check"></i><b>5.7</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html"><i class="fa fa-check"></i><b>6</b> Yelp Classification and Sentiment Test</a><ul>
<li class="chapter" data-level="6.1" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#yelp-dataset"><i class="fa fa-check"></i><b>6.1</b> Yelp Dataset</a><ul>
<li class="chapter" data-level="6.1.1" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#afinn"><i class="fa fa-check"></i><b>6.1.1</b> AFINN</a></li>
<li class="chapter" data-level="6.1.2" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#classification-naive-bayes-classifier"><i class="fa fa-check"></i><b>6.1.2</b> Classification: Naive Bayes Classifier</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#kaggle-yelp-dataset"><i class="fa fa-check"></i><b>6.2</b> Kaggle Yelp dataset</a><ul>
<li class="chapter" data-level="6.2.1" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#naive-bayes-classifier"><i class="fa fa-check"></i><b>6.2.1</b> Naive Bayes Classifier</a></li>
<li class="chapter" data-level="6.2.2" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#logistic-regression"><i class="fa fa-check"></i><b>6.2.2</b> Logistic Regression</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#next-steps"><i class="fa fa-check"></i><b>6.3</b> NEXT STEPS</a></li>
<li class="chapter" data-level="6.4" data-path="yelp-classification-and-sentiment-test.html"><a href="yelp-classification-and-sentiment-test.html#sessioninfo-1"><i class="fa fa-check"></i><b>6.4</b> SessionInfo</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><i class="fa fa-check"></i><b>7</b> The MVP: Classification Accuracy as a Function of Review Length and Volume</a><ul>
<li class="chapter" data-level="7.1" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#introduction-2"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#preparing-the-data"><i class="fa fa-check"></i><b>7.2</b> Preparing the Data</a></li>
<li class="chapter" data-level="7.3" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#experiment-1-logistic-regression-on-globally-balanced-data"><i class="fa fa-check"></i><b>7.3</b> Experiment 1: Logistic Regression on Globally Balanced Data</a></li>
<li class="chapter" data-level="7.4" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#experiment-2-logistic-regression-on-micro-balanced-data"><i class="fa fa-check"></i><b>7.4</b> Experiment 2: Logistic Regression on Micro-Balanced Data</a></li>
<li class="chapter" data-level="7.5" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#conclusions"><i class="fa fa-check"></i><b>7.5</b> Conclusions</a></li>
<li class="chapter" data-level="7.6" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#next-steps-1"><i class="fa fa-check"></i><b>7.6</b> Next Steps</a></li>
<li class="chapter" data-level="7.7" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#sessioninfo-2"><i class="fa fa-check"></i><b>7.7</b> SessionInfo</a></li>
<li class="chapter" data-level="7.8" data-path="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html"><a href="the-mvp-classification-accuracy-as-a-function-of-review-length-and-volume.html#references"><i class="fa fa-check"></i><b>7.8</b> References</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html"><i class="fa fa-check"></i><b>8</b> Beyond the MVP: Looking at Longer Reviews</a><ul>
<li class="chapter" data-level="8.1" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#introduction-3"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#results-from-the-previous-section"><i class="fa fa-check"></i><b>8.2</b> Results from the Previous Section</a></li>
<li class="chapter" data-level="8.3" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#finding-misclassified-reviews"><i class="fa fa-check"></i><b>8.3</b> Finding Misclassified Reviews</a></li>
<li class="chapter" data-level="8.4" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#qualitative-analysis-of-misclassified-reviews"><i class="fa fa-check"></i><b>8.4</b> Qualitative Analysis of Misclassified Reviews</a></li>
<li class="chapter" data-level="8.5" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#negations"><i class="fa fa-check"></i><b>8.5</b> Negations</a><ul>
<li class="chapter" data-level="8.5.1" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#negations-and-prediction-accuracy"><i class="fa fa-check"></i><b>8.5.1</b> Negations and Prediction Accuracy</a></li>
<li class="chapter" data-level="8.5.2" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#negations-and-word-length"><i class="fa fa-check"></i><b>8.5.2</b> Negations and Word Length</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#readability"><i class="fa fa-check"></i><b>8.6</b> Readability</a></li>
<li class="chapter" data-level="8.7" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#summing-up-so-far"><i class="fa fa-check"></i><b>8.7</b> Summing Up So Far</a></li>
<li class="chapter" data-level="8.8" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#logistic-regression-on-afinn-negators"><i class="fa fa-check"></i><b>8.8</b> Logistic Regression on AFINN + negators</a></li>
<li class="chapter" data-level="8.9" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#logistic-regression-on-mean-afinn-negators"><i class="fa fa-check"></i><b>8.9</b> Logistic Regression on Mean AFINN + negators</a></li>
<li class="chapter" data-level="8.10" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#comparing-models-multiple-trials"><i class="fa fa-check"></i><b>8.10</b> Comparing Models: Multiple Trials</a></li>
<li class="chapter" data-level="8.11" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#re-running-the-big-analysis"><i class="fa fa-check"></i><b>8.11</b> Re-Running the Big Analysis</a></li>
<li class="chapter" data-level="8.12" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#conclusion-1"><i class="fa fa-check"></i><b>8.12</b> Conclusion</a></li>
<li class="chapter" data-level="8.13" data-path="beyond-the-mvp-looking-at-longer-reviews.html"><a href="beyond-the-mvp-looking-at-longer-reviews.html#sessioninfo-3"><i class="fa fa-check"></i><b>8.13</b> SessionInfo</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html"><i class="fa fa-check"></i><b>9</b> Beyond the MVP: Support Vector Machine Classification</a><ul>
<li class="chapter" data-level="9.1" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#introduction-4"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#svm-classifiers"><i class="fa fa-check"></i><b>9.2</b> SVM Classifiers</a></li>
<li class="chapter" data-level="9.3" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#preparing-the-data-1"><i class="fa fa-check"></i><b>9.3</b> Preparing the Data</a></li>
<li class="chapter" data-level="9.4" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#svm-classification"><i class="fa fa-check"></i><b>9.4</b> SVM Classification</a></li>
<li class="chapter" data-level="9.5" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#fitting-and-predicting"><i class="fa fa-check"></i><b>9.5</b> Fitting and Predicting</a></li>
<li class="chapter" data-level="9.6" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#conclusions-1"><i class="fa fa-check"></i><b>9.6</b> Conclusions</a></li>
<li class="chapter" data-level="9.7" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#sessioninfo-4"><i class="fa fa-check"></i><b>9.7</b> SessionInfo</a></li>
<li class="chapter" data-level="9.8" data-path="beyond-the-mvp-support-vector-machine-classification.html"><a href="beyond-the-mvp-support-vector-machine-classification.html#references-1"><i class="fa fa-check"></i><b>9.8</b> References</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-2.html"><a href="references-2.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Telfer 2020 Directed Reading: Natural Language Processing</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="a-first-lasso-attempt" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> A First LASSO Attempt</h1>
<div id="introduction-1" class="section level2">
<h2><span class="header-section-number">5.1</span> Introduction</h2>
<p>This analysis will use regression methods to attemp to predict star ratings from the text and/or titles of the reviews in our Yelp, Goodreads, and MEC datasets. My methods will closely follow those given in Chapter 6 of <a href="https://smltar.com/mlregression.html">Supervised Machine Learning for Text Analysis in R</a> (SMLTAR) by <span class="citation">Silge and Hvitfeldt (<a href="#ref-silge_supervised_2020" role="doc-biblioref">2020</a>)</span>. In the first case I will work through an example in detail to describe the steps (and to learn them!!), and in later sections I will move more quickly to try some different variations on the analysis.</p>
<p>I’m going to use the <strong>tidymodels</strong> framework as much as possible, both because it’s the approach used in SMLTAR and because I’m a fan of the Tidyverse approach to software design and analysis.</p>
</div>
<div id="a-first-regression-yelp-data" class="section level2">
<h2><span class="header-section-number">5.2</span> A First Regression: Yelp Data</h2>
<p>I will begin with the Yelp data because we have a lot of it, and because based on our EDA it seemed to be “cleaner” than the Goodreads data which had a lot of duplicate posts, spam posts, plot summaries, etc.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="a-first-lasso-attempt.html#cb91-1"></a>reviews_yelp &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;../tests/data/ottawa_yelp_reviews.csv&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb91-2"><a href="a-first-lasso-attempt.html#cb91-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> lubridate<span class="op">::</span><span class="kw">mdy</span>(date)) <span class="op">%&gt;%</span></span>
<span id="cb91-3"><a href="a-first-lasso-attempt.html#cb91-3"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">text =</span> comment,</span>
<span id="cb91-4"><a href="a-first-lasso-attempt.html#cb91-4"></a>         <span class="dt">rating_num =</span> rating)</span>
<span id="cb91-5"><a href="a-first-lasso-attempt.html#cb91-5"></a></span>
<span id="cb91-6"><a href="a-first-lasso-attempt.html#cb91-6"></a>reviews_yelp <span class="op">%&gt;%</span></span>
<span id="cb91-7"><a href="a-first-lasso-attempt.html#cb91-7"></a><span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb91-8"><a href="a-first-lasso-attempt.html#cb91-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">text =</span> stringr<span class="op">::</span><span class="kw">str_trunc</span>(text, <span class="dv">100</span>)) <span class="op">%&gt;%</span></span>
<span id="cb91-9"><a href="a-first-lasso-attempt.html#cb91-9"></a><span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="11%" />
<col width="5%" />
<col width="5%" />
<col width="46%" />
<col width="5%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">business</th>
<th align="left">name</th>
<th align="left">date</th>
<th align="left">text</th>
<th align="right">rating_num</th>
<th align="left">url</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">La Squadra</td>
<td align="left">Alain G.</td>
<td align="left">2017-08-21</td>
<td align="left">Confession: I am a foodie and I am a restaurant trained amateur Chef.&lt;br&gt;Been wanting to try t…</td>
<td align="right">5</td>
<td align="left"><a href="http://www.yelp.ca/biz/la-squadra-gatineau" class="uri">http://www.yelp.ca/biz/la-squadra-gatineau</a></td>
</tr>
<tr class="even">
<td align="left">La Squadra</td>
<td align="left">Amelia J.</td>
<td align="left">2018-12-19</td>
<td align="left">I came here for a Christmas lunch with coworkers and we tried the set Christmas menu (appetizer +…</td>
<td align="right">4</td>
<td align="left"><a href="http://www.yelp.ca/biz/la-squadra-gatineau" class="uri">http://www.yelp.ca/biz/la-squadra-gatineau</a></td>
</tr>
<tr class="odd">
<td align="left">La Squadra</td>
<td align="left">Michael C.</td>
<td align="left">2017-07-03</td>
<td align="left">Beautiful venue, great service and incredible food.  Try Squadra pasta and pizza…and the Aranci…</td>
<td align="right">5</td>
<td align="left"><a href="http://www.yelp.ca/biz/la-squadra-gatineau" class="uri">http://www.yelp.ca/biz/la-squadra-gatineau</a></td>
</tr>
<tr class="even">
<td align="left">La Squadra</td>
<td align="left">Cee Y.</td>
<td align="left">2019-03-30</td>
<td align="left">My husband and I stopped into this place as per a recommendation by Yelp. We had a fantastic time…</td>
<td align="right">5</td>
<td align="left"><a href="http://www.yelp.ca/biz/la-squadra-gatineau" class="uri">http://www.yelp.ca/biz/la-squadra-gatineau</a></td>
</tr>
<tr class="odd">
<td align="left">La Squadra</td>
<td align="left">Luc S.</td>
<td align="left">2018-03-04</td>
<td align="left">Best Italian restaurant in Gatineau ! The food is authentic and fresh with good wine recommendati…</td>
<td align="right">5</td>
<td align="left"><a href="http://www.yelp.ca/biz/la-squadra-gatineau" class="uri">http://www.yelp.ca/biz/la-squadra-gatineau</a></td>
</tr>
<tr class="even">
<td align="left">Kallisto Greek Restaurant</td>
<td align="left">Amster S.</td>
<td align="left">2020-04-18</td>
<td align="left">I&amp;#39;ve been here twice. Once with my work friends and second with my family. I will come ba…</td>
<td align="right">5</td>
<td align="left"><a href="http://www.yelp.ca/biz/kallisto-greek-restaurant-ottawa" class="uri">http://www.yelp.ca/biz/kallisto-greek-restaurant-ottawa</a></td>
</tr>
<tr class="odd">
<td align="left">Kallisto Greek Restaurant</td>
<td align="left">Reema D.</td>
<td align="left">2020-01-12</td>
<td align="left">Waitress was pretty slow. Didn&amp;#39;t take our dinner orders until after we finished apps and …</td>
<td align="right">4</td>
<td align="left"><a href="http://www.yelp.ca/biz/kallisto-greek-restaurant-ottawa" class="uri">http://www.yelp.ca/biz/kallisto-greek-restaurant-ottawa</a></td>
</tr>
<tr class="even">
<td align="left">Kallisto Greek Restaurant</td>
<td align="left">Jennifer P.</td>
<td align="left">2018-05-21</td>
<td align="left">My husband and I had dinner here recently and overall it was very good 3.75 stars, rounded up to …</td>
<td align="right">4</td>
<td align="left"><a href="http://www.yelp.ca/biz/kallisto-greek-restaurant-ottawa" class="uri">http://www.yelp.ca/biz/kallisto-greek-restaurant-ottawa</a></td>
</tr>
<tr class="odd">
<td align="left">Kallisto Greek Restaurant</td>
<td align="left">Teena D.</td>
<td align="left">2018-02-07</td>
<td align="left">I had lunch today at Kallisto Greek Restaurant.&lt;br&gt;&lt;br&gt;I love chicken souvlaki and that&amp;amp…</td>
<td align="right">2</td>
<td align="left"><a href="http://www.yelp.ca/biz/kallisto-greek-restaurant-ottawa" class="uri">http://www.yelp.ca/biz/kallisto-greek-restaurant-ottawa</a></td>
</tr>
<tr class="even">
<td align="left">Kallisto Greek Restaurant</td>
<td align="left">Janie M.</td>
<td align="left">2019-06-26</td>
<td align="left">Find there&amp;#39;s always warm and friendly service. Best Greek food in Ottawa!  My son, daught…</td>
<td align="right">5</td>
<td align="left"><a href="http://www.yelp.ca/biz/kallisto-greek-restaurant-ottawa" class="uri">http://www.yelp.ca/biz/kallisto-greek-restaurant-ottawa</a></td>
</tr>
</tbody>
</table>
<div id="splitting-the-data" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Splitting the data</h3>
<p>First we will split our data into a training set and a testing set. This is a standard practice, wherein we build a model using the training data but set aside some other data so we can test it later. Otherwise we might have concerns about overfitting or model validity.</p>
<p>I’m setting the value <code>strata = "rating_num"</code> to ensure that our random sampling has about the same distribution of star ratings as our full population–see the documentation for <code>initial_split()</code>.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="a-first-lasso-attempt.html#cb92-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb92-2"><a href="a-first-lasso-attempt.html#cb92-2"></a></span>
<span id="cb92-3"><a href="a-first-lasso-attempt.html#cb92-3"></a>yelp_split &lt;-<span class="st"> </span>reviews_yelp <span class="op">%&gt;%</span></span>
<span id="cb92-4"><a href="a-first-lasso-attempt.html#cb92-4"></a><span class="st">  </span><span class="kw">initial_split</span>(<span class="dt">strata =</span> <span class="st">&quot;rating_num&quot;</span>)</span>
<span id="cb92-5"><a href="a-first-lasso-attempt.html#cb92-5"></a></span>
<span id="cb92-6"><a href="a-first-lasso-attempt.html#cb92-6"></a>yelp_train &lt;-<span class="st"> </span>yelp_split <span class="op">%&gt;%</span></span>
<span id="cb92-7"><a href="a-first-lasso-attempt.html#cb92-7"></a><span class="st">  </span><span class="kw">training</span>()</span>
<span id="cb92-8"><a href="a-first-lasso-attempt.html#cb92-8"></a></span>
<span id="cb92-9"><a href="a-first-lasso-attempt.html#cb92-9"></a>yelp_test &lt;-<span class="st"> </span>yelp_split <span class="op">%&gt;%</span></span>
<span id="cb92-10"><a href="a-first-lasso-attempt.html#cb92-10"></a><span class="st">  </span><span class="kw">testing</span>()</span></code></pre></div>
<p>The next step is to define our preprocessing steps: the stuff we’ll do to the text before we put it into a regression model. In the <code>tidymodels</code> approach we do this by creating a “recipe” objects and then adding a number of steps to it. We modify the object by using the pipe operator to add a bunch of steps to it using verb functions. This makes it easy to read the step-by-step process and understand what’s going on.</p>
<p>I’ll note, though, that when I follow SMLTAR’s guide the recipe still includes explicit references to the dataset we’re analyzing, so it’s not a completely generic object that could be applied to other datasets: we would need to make other recipes for MEC and Goodreads. There may be more advanced ways to create generic recipes that can be reused.</p>
<p>Here, following SMLTAR, we will use a recipe with the following steps:</p>
<ul>
<li><em>Tokenizing</em> the text, which means breaking it down into constituent bits (words here),</li>
<li><em>Filtering the tokens</em> based on frequency, taking only the 250 most-common tokens, (NOTE this is not many tokens!!)</li>
<li><em>TFIDF</em>, or “term frequency inverse document frequency,” which weights each token based on both how frequent it is and on how common it is across documents (see <code>step_tfidf()</code>’s help page for details), and then</li>
<li><em>Normalizing</em> so our lasso regression will work properly.</li>
</ul>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="a-first-lasso-attempt.html#cb93-1"></a>num_tokens &lt;-<span class="st"> </span><span class="dv">250</span></span>
<span id="cb93-2"><a href="a-first-lasso-attempt.html#cb93-2"></a></span>
<span id="cb93-3"><a href="a-first-lasso-attempt.html#cb93-3"></a>yelp_rec &lt;-<span class="st"> </span><span class="kw">recipe</span>(rating_num <span class="op">~</span><span class="st"> </span>text, <span class="dt">data =</span> yelp_train) <span class="op">%&gt;%</span></span>
<span id="cb93-4"><a href="a-first-lasso-attempt.html#cb93-4"></a><span class="st">  </span><span class="kw">step_tokenize</span>(text) <span class="op">%&gt;%</span></span>
<span id="cb93-5"><a href="a-first-lasso-attempt.html#cb93-5"></a><span class="st">  </span><span class="kw">step_tokenfilter</span>(text, <span class="dt">max_tokens =</span> num_tokens) <span class="op">%&gt;%</span></span>
<span id="cb93-6"><a href="a-first-lasso-attempt.html#cb93-6"></a><span class="st">  </span><span class="kw">step_tfidf</span>(text) <span class="op">%&gt;%</span></span>
<span id="cb93-7"><a href="a-first-lasso-attempt.html#cb93-7"></a><span class="st">  </span><span class="kw">step_normalize</span>(<span class="kw">all_predictors</span>())</span>
<span id="cb93-8"><a href="a-first-lasso-attempt.html#cb93-8"></a>  </span>
<span id="cb93-9"><a href="a-first-lasso-attempt.html#cb93-9"></a><span class="kw">rm</span>(num_tokens)</span>
<span id="cb93-10"><a href="a-first-lasso-attempt.html#cb93-10"></a></span>
<span id="cb93-11"><a href="a-first-lasso-attempt.html#cb93-11"></a>yelp_rec</span></code></pre></div>
<pre><code>## Data Recipe
## 
## Inputs:
## 
##       role #variables
##    outcome          1
##  predictor          1
## 
## Operations:
## 
## Tokenization for text
## Text filtering for text
## Term frequency-inverse document frequency with text
## Centering and scaling for all_predictors()</code></pre>
<p>Next, <span class="citation">Silge and Hvitfeldt (<a href="#ref-silge_supervised_2020" role="doc-biblioref">2020</a>)</span> suggest we create a <code>workflow()</code> object that combines preprocessing steps and models.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="a-first-lasso-attempt.html#cb95-1"></a>yelp_wf &lt;-<span class="st"> </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span></span>
<span id="cb95-2"><a href="a-first-lasso-attempt.html#cb95-2"></a><span class="st">  </span><span class="kw">add_recipe</span>(yelp_rec) </span>
<span id="cb95-3"><a href="a-first-lasso-attempt.html#cb95-3"></a>  </span>
<span id="cb95-4"><a href="a-first-lasso-attempt.html#cb95-4"></a>yelp_wf</span></code></pre></div>
<pre><code>## == Workflow ====================================================================
## Preprocessor: Recipe
## Model: None
## 
## -- Preprocessor ----------------------------------------------------------------
## 4 Recipe Steps
## 
## * step_tokenize()
## * step_tokenfilter()
## * step_tfidf()
## * step_normalize()</code></pre>
<p>We now define a lasso regression model using <code>parsnip</code>. My understanding is that this acts as a “tidy wrapper” around other functions/packages, in this case <code>glmnet</code>, that lets you use them in a tidy way. I believe it can also make it easier to swap out models or parameters without having to completely rewrite your codebase.</p>
<p>Note that <code>penalty = 0.1</code> is arbitrary and we’ll look into that parameter more closely later.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="a-first-lasso-attempt.html#cb97-1"></a>lasso_model &lt;-<span class="st"> </span>parsnip<span class="op">::</span><span class="kw">linear_reg</span>(<span class="dt">penalty =</span> <span class="fl">0.1</span>, <span class="dt">mixture =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb97-2"><a href="a-first-lasso-attempt.html#cb97-2"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">&quot;regression&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb97-3"><a href="a-first-lasso-attempt.html#cb97-3"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>)</span>
<span id="cb97-4"><a href="a-first-lasso-attempt.html#cb97-4"></a></span>
<span id="cb97-5"><a href="a-first-lasso-attempt.html#cb97-5"></a>lasso_model</span></code></pre></div>
<pre><code>## Linear Regression Model Specification (regression)
## 
## Main Arguments:
##   penalty = 0.1
##   mixture = 1
## 
## Computational engine: glmnet</code></pre>
<p>Now we add the lasso model to the workflow and run the model. This takes about 9 seconds on my machine using only 250 tokens. (I expect we’ll need to use more to get a good result.)</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="a-first-lasso-attempt.html#cb99-1"></a><span class="kw">tic</span>()</span>
<span id="cb99-2"><a href="a-first-lasso-attempt.html#cb99-2"></a>lasso_fit &lt;-<span class="st"> </span>yelp_wf <span class="op">%&gt;%</span></span>
<span id="cb99-3"><a href="a-first-lasso-attempt.html#cb99-3"></a><span class="st">  </span><span class="kw">add_model</span>(lasso_model) <span class="op">%&gt;%</span></span>
<span id="cb99-4"><a href="a-first-lasso-attempt.html#cb99-4"></a><span class="st">  </span><span class="kw">fit</span>(<span class="dt">data =</span> yelp_train)</span>
<span id="cb99-5"><a href="a-first-lasso-attempt.html#cb99-5"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>## 10.33 sec elapsed</code></pre>
<p>We can look at the terms with the highest coefficients in the model:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="a-first-lasso-attempt.html#cb101-1"></a>lasso_fit <span class="op">%&gt;%</span></span>
<span id="cb101-2"><a href="a-first-lasso-attempt.html#cb101-2"></a><span class="st">  </span><span class="kw">pull_workflow_fit</span>() <span class="op">%&gt;%</span></span>
<span id="cb101-3"><a href="a-first-lasso-attempt.html#cb101-3"></a><span class="st">  </span><span class="kw">tidy</span>() <span class="op">%&gt;%</span></span>
<span id="cb101-4"><a href="a-first-lasso-attempt.html#cb101-4"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="op">-</span>estimate)</span></code></pre></div>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## 
## Attaching package: &#39;Matrix&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:tidyr&#39;:
## 
##     expand, pack, unpack</code></pre>
<pre><code>## Loaded glmnet 4.0-2</code></pre>
<pre><code>## # A tibble: 251 x 3
##    term                 estimate penalty
##    &lt;chr&gt;                   &lt;dbl&gt;   &lt;dbl&gt;
##  1 (Intercept)           4.16        0.1
##  2 tfidf_text_amazing    0.0490      0.1
##  3 tfidf_text_delicious  0.0395      0.1
##  4 tfidf_text_great      0.0379      0.1
##  5 tfidf_text_best       0.0307      0.1
##  6 tfidf_text_and        0.00624     0.1
##  7 tfidf_text_2          0           0.1
##  8 tfidf_text_3          0           0.1
##  9 tfidf_text_34         0           0.1
## 10 tfidf_text_39         0           0.1
## # ... with 241 more rows</code></pre>
<p>This already doesn’t look too promising; only 5 terms have positive coefficients, and the intercept is 4.16. But let’s see how it goes.</p>
</div>
<div id="evaluating-the-first-model" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Evaluating the first model</h3>
<p>Following <span class="citation">Silge and Hvitfeldt (<a href="#ref-silge_supervised_2020" role="doc-biblioref">2020</a>)</span>, we’ll evaluate the model using cross-fold validation, which is a way of trying to squeeze as much validation as you can out of a finite dataset. We will resample our training dataset to create 10 <em>new</em> datasets, and in each one we’ll use 90% for training and 10% for assessment.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="a-first-lasso-attempt.html#cb107-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb107-2"><a href="a-first-lasso-attempt.html#cb107-2"></a>yelp_folds &lt;-<span class="st"> </span><span class="kw">vfold_cv</span>(yelp_train)</span>
<span id="cb107-3"><a href="a-first-lasso-attempt.html#cb107-3"></a></span>
<span id="cb107-4"><a href="a-first-lasso-attempt.html#cb107-4"></a>lasso_rs &lt;-<span class="st"> </span><span class="kw">fit_resamples</span>(</span>
<span id="cb107-5"><a href="a-first-lasso-attempt.html#cb107-5"></a>  yelp_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_model</span>(lasso_model),</span>
<span id="cb107-6"><a href="a-first-lasso-attempt.html#cb107-6"></a>  yelp_folds,</span>
<span id="cb107-7"><a href="a-first-lasso-attempt.html#cb107-7"></a>  <span class="dt">control =</span> <span class="kw">control_resamples</span>(<span class="dt">save_pred =</span> <span class="ot">TRUE</span>)</span>
<span id="cb107-8"><a href="a-first-lasso-attempt.html#cb107-8"></a>)</span>
<span id="cb107-9"><a href="a-first-lasso-attempt.html#cb107-9"></a></span>
<span id="cb107-10"><a href="a-first-lasso-attempt.html#cb107-10"></a><span class="kw">tic</span>()</span>
<span id="cb107-11"><a href="a-first-lasso-attempt.html#cb107-11"></a>lasso_rs</span></code></pre></div>
<pre><code>## # Resampling results
## # 10-fold cross-validation 
## # A tibble: 10 x 5
##    splits             id     .metrics         .notes           .predictions      
##    &lt;list&gt;             &lt;chr&gt;  &lt;list&gt;           &lt;list&gt;           &lt;list&gt;            
##  1 &lt;split [6.3K/706]&gt; Fold01 &lt;tibble [2 x 3]&gt; &lt;tibble [0 x 1]&gt; &lt;tibble [706 x 3]&gt;
##  2 &lt;split [6.3K/706]&gt; Fold02 &lt;tibble [2 x 3]&gt; &lt;tibble [0 x 1]&gt; &lt;tibble [706 x 3]&gt;
##  3 &lt;split [6.3K/706]&gt; Fold03 &lt;tibble [2 x 3]&gt; &lt;tibble [0 x 1]&gt; &lt;tibble [706 x 3]&gt;
##  4 &lt;split [6.3K/705]&gt; Fold04 &lt;tibble [2 x 3]&gt; &lt;tibble [0 x 1]&gt; &lt;tibble [705 x 3]&gt;
##  5 &lt;split [6.3K/705]&gt; Fold05 &lt;tibble [2 x 3]&gt; &lt;tibble [0 x 1]&gt; &lt;tibble [705 x 3]&gt;
##  6 &lt;split [6.3K/705]&gt; Fold06 &lt;tibble [2 x 3]&gt; &lt;tibble [0 x 1]&gt; &lt;tibble [705 x 3]&gt;
##  7 &lt;split [6.3K/705]&gt; Fold07 &lt;tibble [2 x 3]&gt; &lt;tibble [0 x 1]&gt; &lt;tibble [705 x 3]&gt;
##  8 &lt;split [6.3K/705]&gt; Fold08 &lt;tibble [2 x 3]&gt; &lt;tibble [0 x 1]&gt; &lt;tibble [705 x 3]&gt;
##  9 &lt;split [6.3K/705]&gt; Fold09 &lt;tibble [2 x 3]&gt; &lt;tibble [0 x 1]&gt; &lt;tibble [705 x 3]&gt;
## 10 &lt;split [6.3K/705]&gt; Fold10 &lt;tibble [2 x 3]&gt; &lt;tibble [0 x 1]&gt; &lt;tibble [705 x 3]&gt;</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="a-first-lasso-attempt.html#cb109-1"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>## 0.02 sec elapsed</code></pre>
<p>Our <span class="math inline">\(R^2\)</span> and RMSEs look really quite terrible:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="a-first-lasso-attempt.html#cb111-1"></a>lasso_rs <span class="op">%&gt;%</span></span>
<span id="cb111-2"><a href="a-first-lasso-attempt.html#cb111-2"></a><span class="st">  </span><span class="kw">collect_metrics</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   .metric .estimator  mean     n std_err
##   &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
## 1 rmse    standard   0.985    10 0.00732
## 2 rsq     standard   0.147    10 0.0122</code></pre>
<p>And when we plot predictions vs. true values, that also looks quite terrible:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="a-first-lasso-attempt.html#cb113-1"></a>lasso_rs <span class="op">%&gt;%</span></span>
<span id="cb113-2"><a href="a-first-lasso-attempt.html#cb113-2"></a><span class="st">  </span><span class="kw">collect_predictions</span>() <span class="op">%&gt;%</span></span>
<span id="cb113-3"><a href="a-first-lasso-attempt.html#cb113-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(rating_num, .pred, <span class="dt">color =</span> id)) <span class="op">+</span></span>
<span id="cb113-4"><a href="a-first-lasso-attempt.html#cb113-4"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope=</span><span class="dv">1</span>, <span class="dt">intercept =</span> <span class="dv">0</span>,<span class="dt">color =</span> <span class="st">&quot;gray80&quot;</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span></span>
<span id="cb113-5"><a href="a-first-lasso-attempt.html#cb113-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb113-6"><a href="a-first-lasso-attempt.html#cb113-6"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb113-7"><a href="a-first-lasso-attempt.html#cb113-7"></a>    <span class="dt">x =</span> <span class="st">&quot;Truth&quot;</span>,</span>
<span id="cb113-8"><a href="a-first-lasso-attempt.html#cb113-8"></a>    <span class="dt">y =</span> <span class="st">&quot;Predicted Rating&quot;</span>,</span>
<span id="cb113-9"><a href="a-first-lasso-attempt.html#cb113-9"></a>    <span class="dt">color =</span> <span class="ot">NULL</span>,</span>
<span id="cb113-10"><a href="a-first-lasso-attempt.html#cb113-10"></a>    <span class="dt">title =</span> <span class="st">&quot;Predicted and true star ratings for Yelp reviews&quot;</span>,</span>
<span id="cb113-11"><a href="a-first-lasso-attempt.html#cb113-11"></a>    <span class="dt">subtitle =</span> <span class="st">&quot;Each cross-validation fold is shown in a different color&quot;</span></span>
<span id="cb113-12"><a href="a-first-lasso-attempt.html#cb113-12"></a>  )</span></code></pre></div>
<p><img src="telfer-mba-nlp_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>The model generally predicts that everything will have a star rating of between 3 and 5, and is especially poor at predicting lower values.</p>
<p>We’re now operating without much of a map, since the example in <span class="citation">Silge and Hvitfeldt (<a href="#ref-silge_supervised_2020" role="doc-biblioref">2020</a>)</span> worked beautifully (predicting the year a USA Supreme Court decision was written based on its text). However, we can follow one of their last steps by tuning our lasso hyperparameters.</p>
</div>
<div id="tuning-model-parameters" class="section level3">
<h3><span class="header-section-number">5.2.3</span> Tuning model parameters</h3>
<p>We can repeat the process but use <em>model tuning</em> to set the paramters in our lasso regression. Now instead of choosing a random lasso penalty of 0.1, we’re going to use the <code>tune()</code> function to figure out which penalty gives the best results on our training data.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="a-first-lasso-attempt.html#cb114-1"></a>tune_model &lt;-<span class="st"> </span><span class="kw">linear_reg</span>(<span class="dt">penalty =</span> <span class="kw">tune</span>(), <span class="dt">mixture =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb114-2"><a href="a-first-lasso-attempt.html#cb114-2"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">&quot;regression&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb114-3"><a href="a-first-lasso-attempt.html#cb114-3"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>)</span>
<span id="cb114-4"><a href="a-first-lasso-attempt.html#cb114-4"></a></span>
<span id="cb114-5"><a href="a-first-lasso-attempt.html#cb114-5"></a>tune_model</span></code></pre></div>
<pre><code>## Linear Regression Model Specification (regression)
## 
## Main Arguments:
##   penalty = tune()
##   mixture = 1
## 
## Computational engine: glmnet</code></pre>
<p>We create a grid of values to try:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="a-first-lasso-attempt.html#cb116-1"></a>lambda_grid &lt;-<span class="st"> </span><span class="kw">grid_regular</span>(<span class="kw">penalty</span>(), <span class="dt">levels =</span> <span class="dv">30</span>)</span></code></pre></div>
<p>And now we use the function <code>tune_grid()</code> to fit our model at many different parameter values to see how they fare on our cross-fold validation set. <em>Note: this takes a long time, 81.5 seconds for the 250-token model on my machine.</em></p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="a-first-lasso-attempt.html#cb117-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb117-2"><a href="a-first-lasso-attempt.html#cb117-2"></a><span class="kw">tic</span>()</span>
<span id="cb117-3"><a href="a-first-lasso-attempt.html#cb117-3"></a>tune_rs &lt;-<span class="st"> </span><span class="kw">tune_grid</span>(</span>
<span id="cb117-4"><a href="a-first-lasso-attempt.html#cb117-4"></a>  yelp_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_model</span>(tune_model),</span>
<span id="cb117-5"><a href="a-first-lasso-attempt.html#cb117-5"></a>  yelp_folds,</span>
<span id="cb117-6"><a href="a-first-lasso-attempt.html#cb117-6"></a>  <span class="dt">grid =</span> lambda_grid,</span>
<span id="cb117-7"><a href="a-first-lasso-attempt.html#cb117-7"></a>  <span class="dt">control =</span> <span class="kw">control_resamples</span>(<span class="dt">save_pred =</span> <span class="ot">TRUE</span>)</span>
<span id="cb117-8"><a href="a-first-lasso-attempt.html#cb117-8"></a>)</span></code></pre></div>
<pre><code>## ! Fold01: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold02: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold03: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold04: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold05: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold06: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold07: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold08: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold09: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold10: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="a-first-lasso-attempt.html#cb128-1"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>## 83.83 sec elapsed</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="a-first-lasso-attempt.html#cb130-1"></a>tune_rs</span></code></pre></div>
<pre><code>## Warning: This tuning result has notes. Example notes on model fitting include:
## internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.
## internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.
## internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## # Tuning results
## # 10-fold cross-validation 
## # A tibble: 10 x 5
##    splits             id     .metrics          .notes           .predictions         
##    &lt;list&gt;             &lt;chr&gt;  &lt;list&gt;            &lt;list&gt;           &lt;list&gt;               
##  1 &lt;split [6.3K/706]&gt; Fold01 &lt;tibble [60 x 5]&gt; &lt;tibble [1 x 1]&gt; &lt;tibble [21,180 x 5]&gt;
##  2 &lt;split [6.3K/706]&gt; Fold02 &lt;tibble [60 x 5]&gt; &lt;tibble [1 x 1]&gt; &lt;tibble [21,180 x 5]&gt;
##  3 &lt;split [6.3K/706]&gt; Fold03 &lt;tibble [60 x 5]&gt; &lt;tibble [1 x 1]&gt; &lt;tibble [21,180 x 5]&gt;
##  4 &lt;split [6.3K/705]&gt; Fold04 &lt;tibble [60 x 5]&gt; &lt;tibble [1 x 1]&gt; &lt;tibble [21,150 x 5]&gt;
##  5 &lt;split [6.3K/705]&gt; Fold05 &lt;tibble [60 x 5]&gt; &lt;tibble [1 x 1]&gt; &lt;tibble [21,150 x 5]&gt;
##  6 &lt;split [6.3K/705]&gt; Fold06 &lt;tibble [60 x 5]&gt; &lt;tibble [1 x 1]&gt; &lt;tibble [21,150 x 5]&gt;
##  7 &lt;split [6.3K/705]&gt; Fold07 &lt;tibble [60 x 5]&gt; &lt;tibble [1 x 1]&gt; &lt;tibble [21,150 x 5]&gt;
##  8 &lt;split [6.3K/705]&gt; Fold08 &lt;tibble [60 x 5]&gt; &lt;tibble [1 x 1]&gt; &lt;tibble [21,150 x 5]&gt;
##  9 &lt;split [6.3K/705]&gt; Fold09 &lt;tibble [60 x 5]&gt; &lt;tibble [1 x 1]&gt; &lt;tibble [21,150 x 5]&gt;
## 10 &lt;split [6.3K/705]&gt; Fold10 &lt;tibble [60 x 5]&gt; &lt;tibble [1 x 1]&gt; &lt;tibble [21,150 x 5]&gt;</code></pre>
<p>We can visualize our lasso model’s performance for each parameter value:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="a-first-lasso-attempt.html#cb133-1"></a>tune_rs <span class="op">%&gt;%</span></span>
<span id="cb133-2"><a href="a-first-lasso-attempt.html#cb133-2"></a><span class="st">  </span><span class="kw">collect_metrics</span>() <span class="op">%&gt;%</span></span>
<span id="cb133-3"><a href="a-first-lasso-attempt.html#cb133-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(penalty, mean, <span class="dt">color =</span> .metric)) <span class="op">+</span></span>
<span id="cb133-4"><a href="a-first-lasso-attempt.html#cb133-4"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(</span>
<span id="cb133-5"><a href="a-first-lasso-attempt.html#cb133-5"></a>    <span class="dt">ymin =</span> mean <span class="op">-</span><span class="st"> </span>std_err,</span>
<span id="cb133-6"><a href="a-first-lasso-attempt.html#cb133-6"></a>    <span class="dt">ymax =</span> mean <span class="op">+</span><span class="st"> </span>std_err</span>
<span id="cb133-7"><a href="a-first-lasso-attempt.html#cb133-7"></a>  ),</span>
<span id="cb133-8"><a href="a-first-lasso-attempt.html#cb133-8"></a>  <span class="dt">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb133-9"><a href="a-first-lasso-attempt.html#cb133-9"></a>  ) <span class="op">+</span></span>
<span id="cb133-10"><a href="a-first-lasso-attempt.html#cb133-10"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span></span>
<span id="cb133-11"><a href="a-first-lasso-attempt.html#cb133-11"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>.metric, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">nrow =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb133-12"><a href="a-first-lasso-attempt.html#cb133-12"></a><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></span>
<span id="cb133-13"><a href="a-first-lasso-attempt.html#cb133-13"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span></span>
<span id="cb133-14"><a href="a-first-lasso-attempt.html#cb133-14"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb133-15"><a href="a-first-lasso-attempt.html#cb133-15"></a>    <span class="dt">title =</span> <span class="st">&quot;Lasso model performance across regularization penalties&quot;</span>,</span>
<span id="cb133-16"><a href="a-first-lasso-attempt.html#cb133-16"></a>    <span class="dt">subtitle =</span> <span class="st">&quot;Performance metrics can be used to identity the best penalty&quot;</span></span>
<span id="cb133-17"><a href="a-first-lasso-attempt.html#cb133-17"></a>  )</span></code></pre></div>
<pre><code>## Warning: Removed 2 row(s) containing missing values (geom_path).</code></pre>
<p><img src="telfer-mba-nlp_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<p>Since we want the best model performance possible, we’ll follow <span class="citation">Silge and Hvitfeldt (<a href="#ref-silge_supervised_2020" role="doc-biblioref">2020</a>)</span> and choose the value that minimizes our RMSE.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="a-first-lasso-attempt.html#cb135-1"></a>tune_rs <span class="op">%&gt;%</span></span>
<span id="cb135-2"><a href="a-first-lasso-attempt.html#cb135-2"></a><span class="st">  </span><span class="kw">show_best</span>(<span class="st">&quot;rmse&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##    penalty .metric .estimator  mean     n std_err .config              
##      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
## 1 0.00853  rmse    standard   0.903    10  0.0129 Preprocessor1_Model24
## 2 0.00386  rmse    standard   0.904    10  0.0133 Preprocessor1_Model23
## 3 0.00174  rmse    standard   0.905    10  0.0135 Preprocessor1_Model22
## 4 0.000788 rmse    standard   0.906    10  0.0136 Preprocessor1_Model21
## 5 0.000356 rmse    standard   0.907    10  0.0136 Preprocessor1_Model20</code></pre>
<p>And we can extract the penalty that gives us the lowest RMSE using the <code>select_best()</code> function as follows:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="a-first-lasso-attempt.html#cb137-1"></a>lowest_rmse &lt;-<span class="st"> </span>tune_rs <span class="op">%&gt;%</span></span>
<span id="cb137-2"><a href="a-first-lasso-attempt.html#cb137-2"></a><span class="st">  </span><span class="kw">select_best</span>(<span class="st">&quot;rmse&quot;</span>)</span></code></pre></div>
<p>And we can put it all together into a final workflow:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="a-first-lasso-attempt.html#cb138-1"></a>final_lasso &lt;-<span class="st"> </span><span class="kw">finalize_workflow</span>(</span>
<span id="cb138-2"><a href="a-first-lasso-attempt.html#cb138-2"></a>  yelp_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_model</span>(tune_model),</span>
<span id="cb138-3"><a href="a-first-lasso-attempt.html#cb138-3"></a>  lowest_rmse</span>
<span id="cb138-4"><a href="a-first-lasso-attempt.html#cb138-4"></a>)</span></code></pre></div>
<p>We can then do a final fit by testing our model’s predictions against our testing data using the following command.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="a-first-lasso-attempt.html#cb139-1"></a>lasso_fit &lt;-<span class="st"> </span>final_lasso <span class="op">%&gt;%</span></span>
<span id="cb139-2"><a href="a-first-lasso-attempt.html#cb139-2"></a><span class="st">  </span><span class="kw">last_fit</span>(<span class="dt">split =</span> yelp_split)</span></code></pre></div>
<p>And then we can extract its predictions and plot them against the true values to see how it looks.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="a-first-lasso-attempt.html#cb140-1"></a>lasso_fit <span class="op">%&gt;%</span></span>
<span id="cb140-2"><a href="a-first-lasso-attempt.html#cb140-2"></a><span class="st">  </span><span class="kw">collect_predictions</span>() <span class="op">%&gt;%</span></span>
<span id="cb140-3"><a href="a-first-lasso-attempt.html#cb140-3"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(rating_num, .pred)) <span class="op">+</span></span>
<span id="cb140-4"><a href="a-first-lasso-attempt.html#cb140-4"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope=</span><span class="dv">1</span>, <span class="dt">intercept =</span> <span class="dv">0</span>,<span class="dt">color =</span> <span class="st">&quot;gray80&quot;</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span></span>
<span id="cb140-5"><a href="a-first-lasso-attempt.html#cb140-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb140-6"><a href="a-first-lasso-attempt.html#cb140-6"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb140-7"><a href="a-first-lasso-attempt.html#cb140-7"></a>    <span class="dt">x =</span> <span class="st">&quot;Truth&quot;</span>,</span>
<span id="cb140-8"><a href="a-first-lasso-attempt.html#cb140-8"></a>    <span class="dt">y =</span> <span class="st">&quot;Predicted Rating&quot;</span>,</span>
<span id="cb140-9"><a href="a-first-lasso-attempt.html#cb140-9"></a>    <span class="dt">color =</span> <span class="ot">NULL</span>,</span>
<span id="cb140-10"><a href="a-first-lasso-attempt.html#cb140-10"></a>    <span class="dt">title =</span> <span class="st">&quot;Final lasso model: Predicted and true star ratings for Yelp reviews&quot;</span></span>
<span id="cb140-11"><a href="a-first-lasso-attempt.html#cb140-11"></a>  )</span></code></pre></div>
<p><img src="telfer-mba-nlp_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<p>This model looks better in some ways but worse in others. It’s better in that it gives lower predictions for in-truth lower reviews; it’s worse in that it predicts ratings over 5, and even over 6.5. The spread of predictions is also still quite large, but that may be to be expected with an <span class="math inline">\(R^2\)</span> of only about 0.25.</p>
</div>
</div>
<div id="trying-lasso-again" class="section level2">
<h2><span class="header-section-number">5.3</span> Trying lasso again</h2>
<div id="with-1000-tokens" class="section level3">
<h3><span class="header-section-number">5.3.1</span> With 1000 tokens</h3>
<p>Here is the whole process again in a single code block using 1000 tokens.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="a-first-lasso-attempt.html#cb141-1"></a>num_tokens &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb141-2"><a href="a-first-lasso-attempt.html#cb141-2"></a></span>
<span id="cb141-3"><a href="a-first-lasso-attempt.html#cb141-3"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb141-4"><a href="a-first-lasso-attempt.html#cb141-4"></a></span>
<span id="cb141-5"><a href="a-first-lasso-attempt.html#cb141-5"></a><span class="co"># do initial split</span></span>
<span id="cb141-6"><a href="a-first-lasso-attempt.html#cb141-6"></a></span>
<span id="cb141-7"><a href="a-first-lasso-attempt.html#cb141-7"></a>yelp_split &lt;-<span class="st"> </span>reviews_yelp <span class="op">%&gt;%</span></span>
<span id="cb141-8"><a href="a-first-lasso-attempt.html#cb141-8"></a><span class="st">  </span><span class="kw">initial_split</span>(<span class="dt">strata =</span> <span class="st">&quot;rating_num&quot;</span>)</span>
<span id="cb141-9"><a href="a-first-lasso-attempt.html#cb141-9"></a></span>
<span id="cb141-10"><a href="a-first-lasso-attempt.html#cb141-10"></a>yelp_train &lt;-<span class="st"> </span>yelp_split <span class="op">%&gt;%</span></span>
<span id="cb141-11"><a href="a-first-lasso-attempt.html#cb141-11"></a><span class="st">  </span><span class="kw">training</span>()</span>
<span id="cb141-12"><a href="a-first-lasso-attempt.html#cb141-12"></a></span>
<span id="cb141-13"><a href="a-first-lasso-attempt.html#cb141-13"></a>yelp_test &lt;-<span class="st"> </span>yelp_split <span class="op">%&gt;%</span></span>
<span id="cb141-14"><a href="a-first-lasso-attempt.html#cb141-14"></a><span class="st">  </span><span class="kw">testing</span>()</span>
<span id="cb141-15"><a href="a-first-lasso-attempt.html#cb141-15"></a></span>
<span id="cb141-16"><a href="a-first-lasso-attempt.html#cb141-16"></a><span class="co"># set up recipe</span></span>
<span id="cb141-17"><a href="a-first-lasso-attempt.html#cb141-17"></a></span>
<span id="cb141-18"><a href="a-first-lasso-attempt.html#cb141-18"></a>yelp_rec &lt;-<span class="st"> </span><span class="kw">recipe</span>(rating_num <span class="op">~</span><span class="st"> </span>text, <span class="dt">data =</span> yelp_train) <span class="op">%&gt;%</span></span>
<span id="cb141-19"><a href="a-first-lasso-attempt.html#cb141-19"></a><span class="st">  </span><span class="kw">step_tokenize</span>(text) <span class="op">%&gt;%</span></span>
<span id="cb141-20"><a href="a-first-lasso-attempt.html#cb141-20"></a><span class="st">  </span><span class="kw">step_tokenfilter</span>(text, <span class="dt">max_tokens =</span> num_tokens) <span class="op">%&gt;%</span></span>
<span id="cb141-21"><a href="a-first-lasso-attempt.html#cb141-21"></a><span class="st">  </span><span class="kw">step_tfidf</span>(text) <span class="op">%&gt;%</span></span>
<span id="cb141-22"><a href="a-first-lasso-attempt.html#cb141-22"></a><span class="st">  </span><span class="kw">step_normalize</span>(<span class="kw">all_predictors</span>())</span>
<span id="cb141-23"><a href="a-first-lasso-attempt.html#cb141-23"></a>  </span>
<span id="cb141-24"><a href="a-first-lasso-attempt.html#cb141-24"></a><span class="kw">rm</span>(num_tokens)</span>
<span id="cb141-25"><a href="a-first-lasso-attempt.html#cb141-25"></a></span>
<span id="cb141-26"><a href="a-first-lasso-attempt.html#cb141-26"></a>yelp_wf &lt;-<span class="st"> </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span></span>
<span id="cb141-27"><a href="a-first-lasso-attempt.html#cb141-27"></a><span class="st">  </span><span class="kw">add_recipe</span>(yelp_rec)</span>
<span id="cb141-28"><a href="a-first-lasso-attempt.html#cb141-28"></a></span>
<span id="cb141-29"><a href="a-first-lasso-attempt.html#cb141-29"></a><span class="co"># set up our lasso model using tuning parameters</span></span>
<span id="cb141-30"><a href="a-first-lasso-attempt.html#cb141-30"></a>tune_model &lt;-<span class="st"> </span><span class="kw">linear_reg</span>(<span class="dt">penalty =</span> <span class="kw">tune</span>(), <span class="dt">mixture =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb141-31"><a href="a-first-lasso-attempt.html#cb141-31"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">&quot;regression&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb141-32"><a href="a-first-lasso-attempt.html#cb141-32"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>)</span>
<span id="cb141-33"><a href="a-first-lasso-attempt.html#cb141-33"></a></span>
<span id="cb141-34"><a href="a-first-lasso-attempt.html#cb141-34"></a><span class="co"># create a grid of tuning parameters</span></span>
<span id="cb141-35"><a href="a-first-lasso-attempt.html#cb141-35"></a>lambda_grid &lt;-<span class="st"> </span><span class="kw">grid_regular</span>(<span class="kw">penalty</span>(), <span class="dt">levels =</span> <span class="dv">30</span>)</span>
<span id="cb141-36"><a href="a-first-lasso-attempt.html#cb141-36"></a></span>
<span id="cb141-37"><a href="a-first-lasso-attempt.html#cb141-37"></a><span class="co"># create cross-validation folds</span></span>
<span id="cb141-38"><a href="a-first-lasso-attempt.html#cb141-38"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb141-39"><a href="a-first-lasso-attempt.html#cb141-39"></a>yelp_folds &lt;-<span class="st"> </span><span class="kw">vfold_cv</span>(yelp_train)</span>
<span id="cb141-40"><a href="a-first-lasso-attempt.html#cb141-40"></a></span>
<span id="cb141-41"><a href="a-first-lasso-attempt.html#cb141-41"></a><span class="co"># fit our model at many different parameter values using the cross-fold validation set</span></span>
<span id="cb141-42"><a href="a-first-lasso-attempt.html#cb141-42"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb141-43"><a href="a-first-lasso-attempt.html#cb141-43"></a><span class="kw">tic</span>()</span>
<span id="cb141-44"><a href="a-first-lasso-attempt.html#cb141-44"></a>tune_rs &lt;-<span class="st"> </span><span class="kw">tune_grid</span>(</span>
<span id="cb141-45"><a href="a-first-lasso-attempt.html#cb141-45"></a>  yelp_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_model</span>(tune_model),</span>
<span id="cb141-46"><a href="a-first-lasso-attempt.html#cb141-46"></a>  yelp_folds,</span>
<span id="cb141-47"><a href="a-first-lasso-attempt.html#cb141-47"></a>  <span class="dt">grid =</span> lambda_grid,</span>
<span id="cb141-48"><a href="a-first-lasso-attempt.html#cb141-48"></a>  <span class="dt">control =</span> <span class="kw">control_resamples</span>(<span class="dt">save_pred =</span> <span class="ot">TRUE</span>)</span>
<span id="cb141-49"><a href="a-first-lasso-attempt.html#cb141-49"></a>)</span>
<span id="cb141-50"><a href="a-first-lasso-attempt.html#cb141-50"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>## 182.2 sec elapsed</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="a-first-lasso-attempt.html#cb143-1"></a><span class="co"># extract penalty that gives us the lowest RMSE</span></span>
<span id="cb143-2"><a href="a-first-lasso-attempt.html#cb143-2"></a>lowest_rmse &lt;-<span class="st"> </span>tune_rs <span class="op">%&gt;%</span></span>
<span id="cb143-3"><a href="a-first-lasso-attempt.html#cb143-3"></a><span class="st">  </span><span class="kw">select_best</span>(<span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb143-4"><a href="a-first-lasso-attempt.html#cb143-4"></a></span>
<span id="cb143-5"><a href="a-first-lasso-attempt.html#cb143-5"></a><span class="co"># put it into a final workflow</span></span>
<span id="cb143-6"><a href="a-first-lasso-attempt.html#cb143-6"></a>final_lasso &lt;-<span class="st"> </span><span class="kw">finalize_workflow</span>(</span>
<span id="cb143-7"><a href="a-first-lasso-attempt.html#cb143-7"></a>  yelp_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_model</span>(tune_model),</span>
<span id="cb143-8"><a href="a-first-lasso-attempt.html#cb143-8"></a>  lowest_rmse</span>
<span id="cb143-9"><a href="a-first-lasso-attempt.html#cb143-9"></a>)</span>
<span id="cb143-10"><a href="a-first-lasso-attempt.html#cb143-10"></a></span>
<span id="cb143-11"><a href="a-first-lasso-attempt.html#cb143-11"></a><span class="co"># do a last fit</span></span>
<span id="cb143-12"><a href="a-first-lasso-attempt.html#cb143-12"></a>lasso_fit &lt;-<span class="st"> </span>final_lasso <span class="op">%&gt;%</span></span>
<span id="cb143-13"><a href="a-first-lasso-attempt.html#cb143-13"></a><span class="st">  </span><span class="kw">last_fit</span>(<span class="dt">split =</span> yelp_split)</span>
<span id="cb143-14"><a href="a-first-lasso-attempt.html#cb143-14"></a></span>
<span id="cb143-15"><a href="a-first-lasso-attempt.html#cb143-15"></a><span class="co"># see the metrics</span></span>
<span id="cb143-16"><a href="a-first-lasso-attempt.html#cb143-16"></a>lasso_fit <span class="op">%&gt;%</span></span>
<span id="cb143-17"><a href="a-first-lasso-attempt.html#cb143-17"></a><span class="st">  </span><span class="kw">collect_metrics</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 rmse    standard       0.868
## 2 rsq     standard       0.373</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="a-first-lasso-attempt.html#cb145-1"></a><span class="co"># and plot it</span></span>
<span id="cb145-2"><a href="a-first-lasso-attempt.html#cb145-2"></a>lasso_fit <span class="op">%&gt;%</span></span>
<span id="cb145-3"><a href="a-first-lasso-attempt.html#cb145-3"></a><span class="st">  </span><span class="kw">collect_predictions</span>() <span class="op">%&gt;%</span></span>
<span id="cb145-4"><a href="a-first-lasso-attempt.html#cb145-4"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(rating_num, .pred)) <span class="op">+</span></span>
<span id="cb145-5"><a href="a-first-lasso-attempt.html#cb145-5"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope=</span><span class="dv">1</span>, <span class="dt">intercept =</span> <span class="dv">0</span>,<span class="dt">color =</span> <span class="st">&quot;gray80&quot;</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span></span>
<span id="cb145-6"><a href="a-first-lasso-attempt.html#cb145-6"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb145-7"><a href="a-first-lasso-attempt.html#cb145-7"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb145-8"><a href="a-first-lasso-attempt.html#cb145-8"></a>    <span class="dt">x =</span> <span class="st">&quot;Truth&quot;</span>,</span>
<span id="cb145-9"><a href="a-first-lasso-attempt.html#cb145-9"></a>    <span class="dt">y =</span> <span class="st">&quot;Predicted Rating&quot;</span>,</span>
<span id="cb145-10"><a href="a-first-lasso-attempt.html#cb145-10"></a>    <span class="dt">color =</span> <span class="ot">NULL</span>,</span>
<span id="cb145-11"><a href="a-first-lasso-attempt.html#cb145-11"></a>    <span class="dt">title =</span> <span class="st">&quot;Final lasso model: Predicted and true star ratings for Yelp reviews&quot;</span>,</span>
<span id="cb145-12"><a href="a-first-lasso-attempt.html#cb145-12"></a>    <span class="dt">subtitle =</span> <span class="st">&quot;All reviews, 1000 tokens&quot;</span></span>
<span id="cb145-13"><a href="a-first-lasso-attempt.html#cb145-13"></a>  )</span></code></pre></div>
<p><img src="telfer-mba-nlp_files/figure-html/yelp_lasso_1000_tokens-1.png" width="672" /></p>
<p>This has an <span class="math inline">\(R^2\)</span> of 0.37, which is a big improvement over the 250-token model, but it’s still nowhere near good enough to use in practice.</p>
</div>
<div id="short-reviews-only-125-words" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Short reviews only: &lt;125 words</h3>
<p>Let’s try only using reviews under 125 words. It’s possible that shorter reviews are “denser” and more to the point, and that longer reviews contain too much “noise.” This leaves us with 6,323 reviews.</p>
<p>To begin with, I’m going to define a function to run the lasso regression with different inputs.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="a-first-lasso-attempt.html#cb146-1"></a>run_lasso &lt;-<span class="st"> </span><span class="cf">function</span>(dataset, num_tokens){</span>
<span id="cb146-2"><a href="a-first-lasso-attempt.html#cb146-2"></a>  </span>
<span id="cb146-3"><a href="a-first-lasso-attempt.html#cb146-3"></a>  <span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb146-4"><a href="a-first-lasso-attempt.html#cb146-4"></a></span>
<span id="cb146-5"><a href="a-first-lasso-attempt.html#cb146-5"></a>data_split &lt;-<span class="st"> </span>dataset <span class="op">%&gt;%</span></span>
<span id="cb146-6"><a href="a-first-lasso-attempt.html#cb146-6"></a><span class="st">  </span><span class="kw">initial_split</span>(<span class="dt">strata =</span> <span class="st">&quot;rating_num&quot;</span>)</span>
<span id="cb146-7"><a href="a-first-lasso-attempt.html#cb146-7"></a></span>
<span id="cb146-8"><a href="a-first-lasso-attempt.html#cb146-8"></a>data_train &lt;-<span class="st"> </span>data_split <span class="op">%&gt;%</span></span>
<span id="cb146-9"><a href="a-first-lasso-attempt.html#cb146-9"></a><span class="st">  </span><span class="kw">training</span>()</span>
<span id="cb146-10"><a href="a-first-lasso-attempt.html#cb146-10"></a></span>
<span id="cb146-11"><a href="a-first-lasso-attempt.html#cb146-11"></a>data_test &lt;-<span class="st"> </span>data_split <span class="op">%&gt;%</span></span>
<span id="cb146-12"><a href="a-first-lasso-attempt.html#cb146-12"></a><span class="st">  </span><span class="kw">testing</span>()</span>
<span id="cb146-13"><a href="a-first-lasso-attempt.html#cb146-13"></a></span>
<span id="cb146-14"><a href="a-first-lasso-attempt.html#cb146-14"></a>data_rec &lt;-<span class="st"> </span><span class="kw">recipe</span>(rating_num <span class="op">~</span><span class="st"> </span>text, <span class="dt">data =</span> data_train) <span class="op">%&gt;%</span></span>
<span id="cb146-15"><a href="a-first-lasso-attempt.html#cb146-15"></a><span class="st">  </span><span class="kw">step_tokenize</span>(text) <span class="op">%&gt;%</span></span>
<span id="cb146-16"><a href="a-first-lasso-attempt.html#cb146-16"></a><span class="st">  </span><span class="kw">step_tokenfilter</span>(text, <span class="dt">max_tokens =</span> num_tokens) <span class="op">%&gt;%</span></span>
<span id="cb146-17"><a href="a-first-lasso-attempt.html#cb146-17"></a><span class="st">  </span><span class="kw">step_tfidf</span>(text) <span class="op">%&gt;%</span></span>
<span id="cb146-18"><a href="a-first-lasso-attempt.html#cb146-18"></a><span class="st">  </span><span class="kw">step_normalize</span>(<span class="kw">all_predictors</span>())</span>
<span id="cb146-19"><a href="a-first-lasso-attempt.html#cb146-19"></a>  </span>
<span id="cb146-20"><a href="a-first-lasso-attempt.html#cb146-20"></a><span class="kw">rm</span>(num_tokens)</span>
<span id="cb146-21"><a href="a-first-lasso-attempt.html#cb146-21"></a></span>
<span id="cb146-22"><a href="a-first-lasso-attempt.html#cb146-22"></a>data_wf &lt;-<span class="st"> </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span></span>
<span id="cb146-23"><a href="a-first-lasso-attempt.html#cb146-23"></a><span class="st">  </span><span class="kw">add_recipe</span>(data_rec)</span>
<span id="cb146-24"><a href="a-first-lasso-attempt.html#cb146-24"></a></span>
<span id="cb146-25"><a href="a-first-lasso-attempt.html#cb146-25"></a><span class="co"># set up our lasso model using tuning parameters</span></span>
<span id="cb146-26"><a href="a-first-lasso-attempt.html#cb146-26"></a>tune_model &lt;-<span class="st"> </span><span class="kw">linear_reg</span>(<span class="dt">penalty =</span> <span class="kw">tune</span>(), <span class="dt">mixture =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb146-27"><a href="a-first-lasso-attempt.html#cb146-27"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">&quot;regression&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb146-28"><a href="a-first-lasso-attempt.html#cb146-28"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>)</span>
<span id="cb146-29"><a href="a-first-lasso-attempt.html#cb146-29"></a></span>
<span id="cb146-30"><a href="a-first-lasso-attempt.html#cb146-30"></a><span class="co"># create a grid of tuning parameters</span></span>
<span id="cb146-31"><a href="a-first-lasso-attempt.html#cb146-31"></a>lambda_grid &lt;-<span class="st"> </span><span class="kw">grid_regular</span>(<span class="kw">penalty</span>(), <span class="dt">levels =</span> <span class="dv">30</span>)</span>
<span id="cb146-32"><a href="a-first-lasso-attempt.html#cb146-32"></a></span>
<span id="cb146-33"><a href="a-first-lasso-attempt.html#cb146-33"></a><span class="co"># create cross-validation folds</span></span>
<span id="cb146-34"><a href="a-first-lasso-attempt.html#cb146-34"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb146-35"><a href="a-first-lasso-attempt.html#cb146-35"></a>data_folds &lt;-<span class="st"> </span><span class="kw">vfold_cv</span>(data_train)</span>
<span id="cb146-36"><a href="a-first-lasso-attempt.html#cb146-36"></a></span>
<span id="cb146-37"><a href="a-first-lasso-attempt.html#cb146-37"></a><span class="co"># fit our model at many different parameter values using the cross-fold validation set</span></span>
<span id="cb146-38"><a href="a-first-lasso-attempt.html#cb146-38"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb146-39"><a href="a-first-lasso-attempt.html#cb146-39"></a><span class="kw">tic</span>()</span>
<span id="cb146-40"><a href="a-first-lasso-attempt.html#cb146-40"></a>tune_rs &lt;-<span class="st"> </span><span class="kw">tune_grid</span>(</span>
<span id="cb146-41"><a href="a-first-lasso-attempt.html#cb146-41"></a>  data_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_model</span>(tune_model),</span>
<span id="cb146-42"><a href="a-first-lasso-attempt.html#cb146-42"></a>  data_folds,</span>
<span id="cb146-43"><a href="a-first-lasso-attempt.html#cb146-43"></a>  <span class="dt">grid =</span> lambda_grid,</span>
<span id="cb146-44"><a href="a-first-lasso-attempt.html#cb146-44"></a>  <span class="dt">control =</span> <span class="kw">control_resamples</span>(<span class="dt">save_pred =</span> <span class="ot">TRUE</span>)</span>
<span id="cb146-45"><a href="a-first-lasso-attempt.html#cb146-45"></a>)</span>
<span id="cb146-46"><a href="a-first-lasso-attempt.html#cb146-46"></a><span class="kw">toc</span>()</span>
<span id="cb146-47"><a href="a-first-lasso-attempt.html#cb146-47"></a></span>
<span id="cb146-48"><a href="a-first-lasso-attempt.html#cb146-48"></a><span class="co"># extract penalty that gives us the lowest RMSE</span></span>
<span id="cb146-49"><a href="a-first-lasso-attempt.html#cb146-49"></a>lowest_rmse &lt;-<span class="st"> </span>tune_rs <span class="op">%&gt;%</span></span>
<span id="cb146-50"><a href="a-first-lasso-attempt.html#cb146-50"></a><span class="st">  </span><span class="kw">select_best</span>(<span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb146-51"><a href="a-first-lasso-attempt.html#cb146-51"></a></span>
<span id="cb146-52"><a href="a-first-lasso-attempt.html#cb146-52"></a><span class="co"># put it into a final workflow</span></span>
<span id="cb146-53"><a href="a-first-lasso-attempt.html#cb146-53"></a>final_lasso &lt;-<span class="st"> </span><span class="kw">finalize_workflow</span>(</span>
<span id="cb146-54"><a href="a-first-lasso-attempt.html#cb146-54"></a>  data_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_model</span>(tune_model),</span>
<span id="cb146-55"><a href="a-first-lasso-attempt.html#cb146-55"></a>  lowest_rmse</span>
<span id="cb146-56"><a href="a-first-lasso-attempt.html#cb146-56"></a>)</span>
<span id="cb146-57"><a href="a-first-lasso-attempt.html#cb146-57"></a></span>
<span id="cb146-58"><a href="a-first-lasso-attempt.html#cb146-58"></a><span class="co"># do a last fit</span></span>
<span id="cb146-59"><a href="a-first-lasso-attempt.html#cb146-59"></a>lasso_fit &lt;-<span class="st"> </span>final_lasso <span class="op">%&gt;%</span></span>
<span id="cb146-60"><a href="a-first-lasso-attempt.html#cb146-60"></a><span class="st">  </span><span class="kw">last_fit</span>(<span class="dt">split =</span> data_split)</span>
<span id="cb146-61"><a href="a-first-lasso-attempt.html#cb146-61"></a></span>
<span id="cb146-62"><a href="a-first-lasso-attempt.html#cb146-62"></a><span class="kw">return</span>(lasso_fit)</span>
<span id="cb146-63"><a href="a-first-lasso-attempt.html#cb146-63"></a>}</span></code></pre></div>
<p>Then we can use this function to easily run lasso regressions on different datasets.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="a-first-lasso-attempt.html#cb147-1"></a>max_length &lt;-<span class="st"> </span><span class="dv">125</span></span>
<span id="cb147-2"><a href="a-first-lasso-attempt.html#cb147-2"></a>min_length &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb147-3"><a href="a-first-lasso-attempt.html#cb147-3"></a></span>
<span id="cb147-4"><a href="a-first-lasso-attempt.html#cb147-4"></a>wordcounts_yelp &lt;-<span class="st"> </span>reviews_yelp <span class="op">%&gt;%</span></span>
<span id="cb147-5"><a href="a-first-lasso-attempt.html#cb147-5"></a><span class="st">  </span><span class="kw">select</span>(text) <span class="op">%&gt;%</span></span>
<span id="cb147-6"><a href="a-first-lasso-attempt.html#cb147-6"></a><span class="st">  </span><span class="kw">rowid_to_column</span>() <span class="op">%&gt;%</span></span>
<span id="cb147-7"><a href="a-first-lasso-attempt.html#cb147-7"></a><span class="st">  </span>tidytext<span class="op">::</span><span class="kw">unnest_tokens</span>(word, text) <span class="op">%&gt;%</span></span>
<span id="cb147-8"><a href="a-first-lasso-attempt.html#cb147-8"></a><span class="st">  </span><span class="kw">group_by</span>(rowid) <span class="op">%&gt;%</span></span>
<span id="cb147-9"><a href="a-first-lasso-attempt.html#cb147-9"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></span>
<span id="cb147-10"><a href="a-first-lasso-attempt.html#cb147-10"></a><span class="st">  </span><span class="kw">left_join</span> (reviews_yelp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowid_to_column</span>(), <span class="dt">by =</span><span class="st">&quot;rowid&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb147-11"><a href="a-first-lasso-attempt.html#cb147-11"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>rowid)</span>
<span id="cb147-12"><a href="a-first-lasso-attempt.html#cb147-12"></a></span>
<span id="cb147-13"><a href="a-first-lasso-attempt.html#cb147-13"></a></span>
<span id="cb147-14"><a href="a-first-lasso-attempt.html#cb147-14"></a></span>
<span id="cb147-15"><a href="a-first-lasso-attempt.html#cb147-15"></a>reviews_yelp_short &lt;-<span class="st"> </span>wordcounts_yelp <span class="op">%&gt;%</span></span>
<span id="cb147-16"><a href="a-first-lasso-attempt.html#cb147-16"></a><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&lt;=</span><span class="st"> </span>max_length <span class="op">&amp;</span><span class="st"> </span>n <span class="op">&gt;=</span><span class="st"> </span>min_length )</span>
<span id="cb147-17"><a href="a-first-lasso-attempt.html#cb147-17"></a></span>
<span id="cb147-18"><a href="a-first-lasso-attempt.html#cb147-18"></a></span>
<span id="cb147-19"><a href="a-first-lasso-attempt.html#cb147-19"></a></span>
<span id="cb147-20"><a href="a-first-lasso-attempt.html#cb147-20"></a>lasso_results_short &lt;-<span class="st"> </span><span class="kw">run_lasso</span>(<span class="dt">dataset =</span> reviews_yelp_short, <span class="dt">num_tokens =</span> <span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## 89.07 sec elapsed</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="a-first-lasso-attempt.html#cb149-1"></a><span class="co"># see the metrics</span></span>
<span id="cb149-2"><a href="a-first-lasso-attempt.html#cb149-2"></a>lasso_results_short <span class="op">%&gt;%</span></span>
<span id="cb149-3"><a href="a-first-lasso-attempt.html#cb149-3"></a><span class="st">  </span><span class="kw">collect_metrics</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 rmse    standard       0.821
## 2 rsq     standard       0.391</code></pre>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="a-first-lasso-attempt.html#cb151-1"></a><span class="co"># and plot it</span></span>
<span id="cb151-2"><a href="a-first-lasso-attempt.html#cb151-2"></a>lasso_results_short <span class="op">%&gt;%</span></span>
<span id="cb151-3"><a href="a-first-lasso-attempt.html#cb151-3"></a><span class="st">  </span><span class="kw">collect_predictions</span>() <span class="op">%&gt;%</span></span>
<span id="cb151-4"><a href="a-first-lasso-attempt.html#cb151-4"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(rating_num, .pred)) <span class="op">+</span></span>
<span id="cb151-5"><a href="a-first-lasso-attempt.html#cb151-5"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope=</span><span class="dv">1</span>, <span class="dt">intercept =</span> <span class="dv">0</span>,<span class="dt">color =</span> <span class="st">&quot;gray80&quot;</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span></span>
<span id="cb151-6"><a href="a-first-lasso-attempt.html#cb151-6"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb151-7"><a href="a-first-lasso-attempt.html#cb151-7"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb151-8"><a href="a-first-lasso-attempt.html#cb151-8"></a>    <span class="dt">x =</span> <span class="st">&quot;Truth&quot;</span>,</span>
<span id="cb151-9"><a href="a-first-lasso-attempt.html#cb151-9"></a>    <span class="dt">y =</span> <span class="st">&quot;Predicted Rating&quot;</span>,</span>
<span id="cb151-10"><a href="a-first-lasso-attempt.html#cb151-10"></a>    <span class="dt">color =</span> <span class="ot">NULL</span>,</span>
<span id="cb151-11"><a href="a-first-lasso-attempt.html#cb151-11"></a>    <span class="dt">title =</span> <span class="st">&quot;Final lasso model: Predicted and true star ratings for Yelp reviews&quot;</span>,</span>
<span id="cb151-12"><a href="a-first-lasso-attempt.html#cb151-12"></a>    <span class="dt">subtitle =</span> <span class="st">&quot;Short Reviews &lt; 125 Words, 1000 Tokens&quot;</span></span>
<span id="cb151-13"><a href="a-first-lasso-attempt.html#cb151-13"></a>  )</span></code></pre></div>
<p><img src="telfer-mba-nlp_files/figure-html/yelp_short_reviews_lasso-1.png" width="672" /></p>
<p>This gives us an <span class="math inline">\(R^2\)</span> of 0.39, slightly better than our full dataset. But looking at the chart, we can see that this won’t be useful in practice either.</p>
</div>
<div id="longer-reviews-125-words" class="section level3">
<h3><span class="header-section-number">5.3.3</span> Longer reviews &gt; 125 words</h3>
<p>For completeness, we’ll also try only using the long reviews &gt; 125 words. It’s possible that these reviews contain more useful information due to their length. This leaves us with 3,104 reviews.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="a-first-lasso-attempt.html#cb152-1"></a>max_length &lt;-<span class="st"> </span><span class="dv">10000</span></span>
<span id="cb152-2"><a href="a-first-lasso-attempt.html#cb152-2"></a>min_length &lt;-<span class="st"> </span><span class="dv">125</span></span>
<span id="cb152-3"><a href="a-first-lasso-attempt.html#cb152-3"></a></span>
<span id="cb152-4"><a href="a-first-lasso-attempt.html#cb152-4"></a>wordcounts_yelp &lt;-<span class="st"> </span>reviews_yelp <span class="op">%&gt;%</span></span>
<span id="cb152-5"><a href="a-first-lasso-attempt.html#cb152-5"></a><span class="st">  </span><span class="kw">select</span>(text) <span class="op">%&gt;%</span></span>
<span id="cb152-6"><a href="a-first-lasso-attempt.html#cb152-6"></a><span class="st">  </span><span class="kw">rowid_to_column</span>() <span class="op">%&gt;%</span></span>
<span id="cb152-7"><a href="a-first-lasso-attempt.html#cb152-7"></a><span class="st">  </span>tidytext<span class="op">::</span><span class="kw">unnest_tokens</span>(word, text) <span class="op">%&gt;%</span></span>
<span id="cb152-8"><a href="a-first-lasso-attempt.html#cb152-8"></a><span class="st">  </span><span class="kw">group_by</span>(rowid) <span class="op">%&gt;%</span></span>
<span id="cb152-9"><a href="a-first-lasso-attempt.html#cb152-9"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></span>
<span id="cb152-10"><a href="a-first-lasso-attempt.html#cb152-10"></a><span class="st">  </span><span class="kw">left_join</span> (reviews_yelp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rowid_to_column</span>(), <span class="dt">by =</span><span class="st">&quot;rowid&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb152-11"><a href="a-first-lasso-attempt.html#cb152-11"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>rowid)</span>
<span id="cb152-12"><a href="a-first-lasso-attempt.html#cb152-12"></a></span>
<span id="cb152-13"><a href="a-first-lasso-attempt.html#cb152-13"></a></span>
<span id="cb152-14"><a href="a-first-lasso-attempt.html#cb152-14"></a></span>
<span id="cb152-15"><a href="a-first-lasso-attempt.html#cb152-15"></a>reviews_yelp_long &lt;-<span class="st"> </span>wordcounts_yelp <span class="op">%&gt;%</span></span>
<span id="cb152-16"><a href="a-first-lasso-attempt.html#cb152-16"></a><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&lt;=</span><span class="st"> </span>max_length <span class="op">&amp;</span><span class="st"> </span>n <span class="op">&gt;=</span><span class="st"> </span>min_length )</span>
<span id="cb152-17"><a href="a-first-lasso-attempt.html#cb152-17"></a></span>
<span id="cb152-18"><a href="a-first-lasso-attempt.html#cb152-18"></a></span>
<span id="cb152-19"><a href="a-first-lasso-attempt.html#cb152-19"></a></span>
<span id="cb152-20"><a href="a-first-lasso-attempt.html#cb152-20"></a>lasso_results_long &lt;-<span class="st"> </span><span class="kw">run_lasso</span>(<span class="dt">dataset =</span> reviews_yelp_long, <span class="dt">num_tokens =</span> <span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## 72.61 sec elapsed</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="a-first-lasso-attempt.html#cb154-1"></a><span class="co"># see the metrics</span></span>
<span id="cb154-2"><a href="a-first-lasso-attempt.html#cb154-2"></a>lasso_results_long <span class="op">%&gt;%</span></span>
<span id="cb154-3"><a href="a-first-lasso-attempt.html#cb154-3"></a><span class="st">  </span><span class="kw">collect_metrics</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 rmse    standard       0.824
## 2 rsq     standard       0.429</code></pre>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="a-first-lasso-attempt.html#cb156-1"></a><span class="co"># and plot it</span></span>
<span id="cb156-2"><a href="a-first-lasso-attempt.html#cb156-2"></a>lasso_results_long <span class="op">%&gt;%</span></span>
<span id="cb156-3"><a href="a-first-lasso-attempt.html#cb156-3"></a><span class="st">  </span><span class="kw">collect_predictions</span>() <span class="op">%&gt;%</span></span>
<span id="cb156-4"><a href="a-first-lasso-attempt.html#cb156-4"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(rating_num, .pred)) <span class="op">+</span></span>
<span id="cb156-5"><a href="a-first-lasso-attempt.html#cb156-5"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope=</span><span class="dv">1</span>, <span class="dt">intercept =</span> <span class="dv">0</span>,<span class="dt">color =</span> <span class="st">&quot;gray80&quot;</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span></span>
<span id="cb156-6"><a href="a-first-lasso-attempt.html#cb156-6"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb156-7"><a href="a-first-lasso-attempt.html#cb156-7"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb156-8"><a href="a-first-lasso-attempt.html#cb156-8"></a>    <span class="dt">x =</span> <span class="st">&quot;Truth&quot;</span>,</span>
<span id="cb156-9"><a href="a-first-lasso-attempt.html#cb156-9"></a>    <span class="dt">y =</span> <span class="st">&quot;Predicted Rating&quot;</span>,</span>
<span id="cb156-10"><a href="a-first-lasso-attempt.html#cb156-10"></a>    <span class="dt">color =</span> <span class="ot">NULL</span>,</span>
<span id="cb156-11"><a href="a-first-lasso-attempt.html#cb156-11"></a>    <span class="dt">title =</span> <span class="st">&quot;Final lasso model: Predicted and true star ratings for Yelp reviews&quot;</span>,</span>
<span id="cb156-12"><a href="a-first-lasso-attempt.html#cb156-12"></a>    <span class="dt">subtitle =</span> <span class="st">&quot;Long Reviews &gt; 125 Words, 1000 Tokens&quot;</span></span>
<span id="cb156-13"><a href="a-first-lasso-attempt.html#cb156-13"></a>  )</span></code></pre></div>
<p><img src="telfer-mba-nlp_files/figure-html/yelp_long_reviews_lasso-1.png" width="672" /></p>
<p>Now our <span class="math inline">\(R^2\)</span> has gone up to 0.43, so it is possible that the longer reviews do in fact contain more information. And looking at the chart, the “cloud” of points does creep measurably higher for each true star rating. However, I’m still skeptical that this would be useful for predicting anything in practice.</p>
</div>
</div>
<div id="removing-stop-words" class="section level2">
<h2><span class="header-section-number">5.4</span> Removing stop words</h2>
<p>Stop words are common words that contain little information on their own, like “the” and “to.” If using a bag-of-words approach, where you’re not looking at the input text in a way that considers syntax (or, really, sentence-wise semantics) then it can be helpful to remove stop words.</p>
<p>Here I will follow <span class="citation">Silge and Hvitfeldt (<a href="#ref-silge_supervised_2020" role="doc-biblioref">2020</a>)</span> ’s <a href="https://smltar.com/mlregression.html#casestudystopwords">SMLTAR s6.6</a> to try using three different sets of stopwords, to see which performs best on this dataset.</p>
<p>First, they build a wrapper function to make it easy to build recipes with different stopword sets.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="a-first-lasso-attempt.html#cb157-1"></a>stopword_rec &lt;-<span class="st"> </span><span class="cf">function</span>(stopword_name) {</span>
<span id="cb157-2"><a href="a-first-lasso-attempt.html#cb157-2"></a>  <span class="kw">recipe</span>(rating_num <span class="op">~</span><span class="st"> </span>text, <span class="dt">data =</span> yelp_train) <span class="op">%&gt;%</span></span>
<span id="cb157-3"><a href="a-first-lasso-attempt.html#cb157-3"></a><span class="st">    </span><span class="kw">step_tokenize</span>(text) <span class="op">%&gt;%</span></span>
<span id="cb157-4"><a href="a-first-lasso-attempt.html#cb157-4"></a><span class="st">    </span><span class="kw">step_stopwords</span>(text, <span class="dt">stopword_source =</span> stopword_name) <span class="op">%&gt;%</span></span>
<span id="cb157-5"><a href="a-first-lasso-attempt.html#cb157-5"></a><span class="st">    </span><span class="kw">step_tokenfilter</span>(text, <span class="dt">max_tokens =</span> <span class="dv">1000</span>) <span class="op">%&gt;%</span></span>
<span id="cb157-6"><a href="a-first-lasso-attempt.html#cb157-6"></a><span class="st">    </span><span class="kw">step_tfidf</span>(text)</span>
<span id="cb157-7"><a href="a-first-lasso-attempt.html#cb157-7"></a>}</span></code></pre></div>
<p>Next we set up a workflow that only has a model, using our tunable regularized regression model from before:</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="a-first-lasso-attempt.html#cb158-1"></a>tunable_wf &lt;-<span class="st"> </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span></span>
<span id="cb158-2"><a href="a-first-lasso-attempt.html#cb158-2"></a><span class="st">  </span><span class="kw">add_model</span>(tune_model)</span>
<span id="cb158-3"><a href="a-first-lasso-attempt.html#cb158-3"></a></span>
<span id="cb158-4"><a href="a-first-lasso-attempt.html#cb158-4"></a>tunable_wf</span></code></pre></div>
<pre><code>## == Workflow =======================================================================================================================================================================================
## Preprocessor: None
## Model: linear_reg()
## 
## -- Model ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
## Linear Regression Model Specification (regression)
## 
## Main Arguments:
##   penalty = tune()
##   mixture = 1
## 
## Computational engine: glmnet</code></pre>
<p>Now we will combine our functionized preprocessor with this tunable model and try three different stopword sets: snowball, smart, and stopwords-iso. <em>This takes about 8 minutes on my machine.</em></p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="a-first-lasso-attempt.html#cb160-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb160-2"><a href="a-first-lasso-attempt.html#cb160-2"></a><span class="kw">tic</span>()</span>
<span id="cb160-3"><a href="a-first-lasso-attempt.html#cb160-3"></a>snowball_rs &lt;-<span class="st"> </span><span class="kw">tune_grid</span>(</span>
<span id="cb160-4"><a href="a-first-lasso-attempt.html#cb160-4"></a>  tunable_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_recipe</span>(<span class="kw">stopword_rec</span>(<span class="st">&quot;snowball&quot;</span>)),</span>
<span id="cb160-5"><a href="a-first-lasso-attempt.html#cb160-5"></a>  yelp_folds,</span>
<span id="cb160-6"><a href="a-first-lasso-attempt.html#cb160-6"></a>  <span class="dt">grid =</span> lambda_grid</span>
<span id="cb160-7"><a href="a-first-lasso-attempt.html#cb160-7"></a>)</span>
<span id="cb160-8"><a href="a-first-lasso-attempt.html#cb160-8"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>## 180.16 sec elapsed</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="a-first-lasso-attempt.html#cb162-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb162-2"><a href="a-first-lasso-attempt.html#cb162-2"></a><span class="kw">tic</span>()</span>
<span id="cb162-3"><a href="a-first-lasso-attempt.html#cb162-3"></a>smart_rs &lt;-<span class="st"> </span><span class="kw">tune_grid</span>(</span>
<span id="cb162-4"><a href="a-first-lasso-attempt.html#cb162-4"></a>  tunable_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_recipe</span>(<span class="kw">stopword_rec</span>(<span class="st">&quot;smart&quot;</span>)),</span>
<span id="cb162-5"><a href="a-first-lasso-attempt.html#cb162-5"></a>  yelp_folds,</span>
<span id="cb162-6"><a href="a-first-lasso-attempt.html#cb162-6"></a>  <span class="dt">grid =</span> lambda_grid</span>
<span id="cb162-7"><a href="a-first-lasso-attempt.html#cb162-7"></a>)</span>
<span id="cb162-8"><a href="a-first-lasso-attempt.html#cb162-8"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>## 158.26 sec elapsed</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="a-first-lasso-attempt.html#cb164-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb164-2"><a href="a-first-lasso-attempt.html#cb164-2"></a><span class="kw">tic</span>()</span>
<span id="cb164-3"><a href="a-first-lasso-attempt.html#cb164-3"></a>stopwords_iso_rs &lt;-<span class="st"> </span><span class="kw">tune_grid</span>(</span>
<span id="cb164-4"><a href="a-first-lasso-attempt.html#cb164-4"></a>  tunable_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_recipe</span>(<span class="kw">stopword_rec</span>(<span class="st">&quot;stopwords-iso&quot;</span>)),</span>
<span id="cb164-5"><a href="a-first-lasso-attempt.html#cb164-5"></a>  yelp_folds,</span>
<span id="cb164-6"><a href="a-first-lasso-attempt.html#cb164-6"></a>  <span class="dt">grid =</span> lambda_grid</span>
<span id="cb164-7"><a href="a-first-lasso-attempt.html#cb164-7"></a>)</span>
<span id="cb164-8"><a href="a-first-lasso-attempt.html#cb164-8"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>## 99.92 sec elapsed</code></pre>
<p>And we plot their performance, using code straight from SMLTAR:</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="a-first-lasso-attempt.html#cb166-1"></a>word_counts &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;snowball&quot;</span>, <span class="st">&quot;smart&quot;</span>, <span class="st">&quot;stopwords-iso&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb166-2"><a href="a-first-lasso-attempt.html#cb166-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">words =</span> <span class="kw">map_int</span>(name, <span class="op">~</span><span class="st"> </span><span class="kw">length</span>(stopwords<span class="op">::</span><span class="kw">stopwords</span>(<span class="dt">source =</span> .))))</span>
<span id="cb166-3"><a href="a-first-lasso-attempt.html#cb166-3"></a></span>
<span id="cb166-4"><a href="a-first-lasso-attempt.html#cb166-4"></a><span class="kw">list</span>(</span>
<span id="cb166-5"><a href="a-first-lasso-attempt.html#cb166-5"></a>  <span class="dt">snowball =</span> snowball_rs,</span>
<span id="cb166-6"><a href="a-first-lasso-attempt.html#cb166-6"></a>  <span class="dt">smart =</span> smart_rs,</span>
<span id="cb166-7"><a href="a-first-lasso-attempt.html#cb166-7"></a>  <span class="st">`</span><span class="dt">stopwords-iso</span><span class="st">`</span> =<span class="st"> </span>stopwords_iso_rs</span>
<span id="cb166-8"><a href="a-first-lasso-attempt.html#cb166-8"></a>) <span class="op">%&gt;%</span></span>
<span id="cb166-9"><a href="a-first-lasso-attempt.html#cb166-9"></a><span class="st">  </span><span class="kw">map_dfr</span>(show_best, <span class="st">&quot;rmse&quot;</span>, <span class="dt">.id =</span> <span class="st">&quot;name&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb166-10"><a href="a-first-lasso-attempt.html#cb166-10"></a><span class="st">  </span><span class="kw">left_join</span>(word_counts) <span class="op">%&gt;%</span></span>
<span id="cb166-11"><a href="a-first-lasso-attempt.html#cb166-11"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">paste0</span>(name, <span class="st">&quot; (&quot;</span>, words, <span class="st">&quot; words)&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb166-12"><a href="a-first-lasso-attempt.html#cb166-12"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="kw">fct_reorder</span>(name, words), mean, <span class="dt">color =</span> name)) <span class="op">+</span></span>
<span id="cb166-13"><a href="a-first-lasso-attempt.html#cb166-13"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">alpha =</span> <span class="fl">0.8</span>, <span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb166-14"><a href="a-first-lasso-attempt.html#cb166-14"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb166-15"><a href="a-first-lasso-attempt.html#cb166-15"></a>    <span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="st">&quot;mean RMSE for five best models&quot;</span>,</span>
<span id="cb166-16"><a href="a-first-lasso-attempt.html#cb166-16"></a>    <span class="dt">title =</span> <span class="st">&quot;Model performance for three stop word lexicons&quot;</span>,</span>
<span id="cb166-17"><a href="a-first-lasso-attempt.html#cb166-17"></a>    <span class="dt">subtitle =</span> <span class="st">&quot;For this dataset, the Snowball lexicon performed best&quot;</span></span>
<span id="cb166-18"><a href="a-first-lasso-attempt.html#cb166-18"></a>  )</span></code></pre></div>
<pre><code>## Joining, by = &quot;name&quot;</code></pre>
<p><img src="telfer-mba-nlp_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<p>The RMSE is marginally better using the snowball set of stopwords, but is still quite terrible!</p>
</div>
<div id="adjusting-n-grams" class="section level2">
<h2><span class="header-section-number">5.5</span> Adjusting n-grams</h2>
<p>When tokenizing, we can in general consider text strings of any length. So far we have been considering one-word strings, which we could call “unigrams.” We could also consider two-word strings and three-word strings, called “bigrams” and “trigrams” respectively. We might expect using n-grams, where n&gt;1, to increase our accuracy because it will let us capture more of the syntactic information in our text. For example, if we only consider 1-grams then the short phrase “Not bad!” becomes “not” and “bad,” and our model has no way to differentiate between cases where they occur alone (which might be negative) and together (which might be positive). But if we also consider “not bad,” then the model might learn that that phrase is associated with positive reviews.</p>
<p>As before, we follow <a href="study-varying-n-grams">SMLTAR s6.7</a> and set up a wrapper function that will let us easily change our model recipe to use different n-grams:</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="a-first-lasso-attempt.html#cb168-1"></a>ngram_rec &lt;-<span class="st"> </span><span class="cf">function</span>(ngram_options) {</span>
<span id="cb168-2"><a href="a-first-lasso-attempt.html#cb168-2"></a>  <span class="kw">recipe</span>(rating_num <span class="op">~</span><span class="st"> </span>text, <span class="dt">data =</span> yelp_train) <span class="op">%&gt;%</span></span>
<span id="cb168-3"><a href="a-first-lasso-attempt.html#cb168-3"></a><span class="st">    </span><span class="kw">step_tokenize</span>(text, <span class="dt">token =</span> <span class="st">&quot;ngrams&quot;</span>, <span class="dt">options =</span> ngram_options) <span class="op">%&gt;%</span></span>
<span id="cb168-4"><a href="a-first-lasso-attempt.html#cb168-4"></a><span class="st">    </span><span class="kw">step_tokenfilter</span>(text, <span class="dt">max_tokens =</span> <span class="fl">1e3</span>) <span class="op">%&gt;%</span></span>
<span id="cb168-5"><a href="a-first-lasso-attempt.html#cb168-5"></a><span class="st">    </span><span class="kw">step_tfidf</span>(text)</span>
<span id="cb168-6"><a href="a-first-lasso-attempt.html#cb168-6"></a>}</span></code></pre></div>
<p><code>step_tokenize()</code> takes two arguments, <code>n</code> for the highest-n n-grams to consider, and <code>n_min</code> for the lowest-n ngrams to consider. We will pass these values in the variable <code>ngram_options</code>.</p>
<p>We then out these all together into a wrapper function that will let us run many different models easily:</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="a-first-lasso-attempt.html#cb169-1"></a>tune_ngram &lt;-<span class="st"> </span><span class="cf">function</span>(ngram_options) {</span>
<span id="cb169-2"><a href="a-first-lasso-attempt.html#cb169-2"></a>  <span class="kw">tune_grid</span>(</span>
<span id="cb169-3"><a href="a-first-lasso-attempt.html#cb169-3"></a>    tunable_wf <span class="op">%&gt;%</span></span>
<span id="cb169-4"><a href="a-first-lasso-attempt.html#cb169-4"></a><span class="st">      </span><span class="kw">add_recipe</span>(<span class="kw">ngram_rec</span>(ngram_options)),</span>
<span id="cb169-5"><a href="a-first-lasso-attempt.html#cb169-5"></a>    yelp_folds,</span>
<span id="cb169-6"><a href="a-first-lasso-attempt.html#cb169-6"></a>    <span class="dt">grid =</span> lambda_grid</span>
<span id="cb169-7"><a href="a-first-lasso-attempt.html#cb169-7"></a>  )</span>
<span id="cb169-8"><a href="a-first-lasso-attempt.html#cb169-8"></a>}</span></code></pre></div>
<p>We will try three cases, using n-grams where n=1, n=1,2, and n=1,2,3. I’ve added <code>tic()/toc()</code> calls for loose benchmarking. The processing time goes up with each additional n-gram:</p>
<ul>
<li>1-grams: 186s</li>
<li>2-grams: 267s</li>
<li>3-grams: 495s</li>
</ul>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="a-first-lasso-attempt.html#cb170-1"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb170-2"><a href="a-first-lasso-attempt.html#cb170-2"></a><span class="kw">tic</span>()</span>
<span id="cb170-3"><a href="a-first-lasso-attempt.html#cb170-3"></a>unigram_rs &lt;-<span class="st"> </span><span class="kw">tune_ngram</span>(<span class="kw">list</span>(<span class="dt">n =</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## ! Fold01: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold02: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold03: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold04: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold05: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold06: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold07: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold08: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold09: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold10: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="a-first-lasso-attempt.html#cb181-1"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>## 174.64 sec elapsed</code></pre>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="a-first-lasso-attempt.html#cb183-1"></a><span class="kw">tic</span>()</span>
<span id="cb183-2"><a href="a-first-lasso-attempt.html#cb183-2"></a><span class="kw">set.seed</span>(<span class="dv">234</span>)</span>
<span id="cb183-3"><a href="a-first-lasso-attempt.html#cb183-3"></a>bigram_rs &lt;-<span class="st"> </span><span class="kw">tune_ngram</span>(<span class="kw">list</span>(<span class="dt">n =</span> <span class="dv">2</span>, <span class="dt">n_min =</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## ! Fold01: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold02: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold03: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold04: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold05: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold06: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold07: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold08: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold09: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold10: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="a-first-lasso-attempt.html#cb194-1"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>## 254.42 sec elapsed</code></pre>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="a-first-lasso-attempt.html#cb196-1"></a><span class="kw">tic</span>()</span>
<span id="cb196-2"><a href="a-first-lasso-attempt.html#cb196-2"></a><span class="kw">set.seed</span>(<span class="dv">345</span>)</span>
<span id="cb196-3"><a href="a-first-lasso-attempt.html#cb196-3"></a>trigram_rs &lt;-<span class="st"> </span><span class="kw">tune_ngram</span>(<span class="kw">list</span>(<span class="dt">n =</span> <span class="dv">3</span>, <span class="dt">n_min =</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## ! Fold01: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold02: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold03: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold04: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold05: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold06: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold07: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold08: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold09: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<pre><code>## ! Fold10: internal: A correlation computation is required, but `estimate` is constant and has 0 standard deviation, resulting in a divide by 0 error. `NA` will be returned.</code></pre>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="a-first-lasso-attempt.html#cb207-1"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>## 452.24 sec elapsed</code></pre>
<p>And we can plot the results using a dot-plot, as per SMLTAR:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="a-first-lasso-attempt.html#cb209-1"></a><span class="kw">list</span>(</span>
<span id="cb209-2"><a href="a-first-lasso-attempt.html#cb209-2"></a>  <span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> </span>unigram_rs,</span>
<span id="cb209-3"><a href="a-first-lasso-attempt.html#cb209-3"></a>  <span class="st">`</span><span class="dt">1 and 2</span><span class="st">`</span> =<span class="st"> </span>bigram_rs,</span>
<span id="cb209-4"><a href="a-first-lasso-attempt.html#cb209-4"></a>  <span class="st">`</span><span class="dt">1, 2, and 3</span><span class="st">`</span> =<span class="st"> </span>trigram_rs</span>
<span id="cb209-5"><a href="a-first-lasso-attempt.html#cb209-5"></a>) <span class="op">%&gt;%</span></span>
<span id="cb209-6"><a href="a-first-lasso-attempt.html#cb209-6"></a><span class="st">  </span><span class="kw">map_dfr</span>(collect_metrics, <span class="dt">.id =</span> <span class="st">&quot;name&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb209-7"><a href="a-first-lasso-attempt.html#cb209-7"></a><span class="st">  </span><span class="kw">filter</span>(.metric <span class="op">==</span><span class="st"> &quot;rmse&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb209-8"><a href="a-first-lasso-attempt.html#cb209-8"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(name, mean, <span class="dt">fill =</span> name)) <span class="op">+</span></span>
<span id="cb209-9"><a href="a-first-lasso-attempt.html#cb209-9"></a><span class="st">  </span><span class="kw">geom_dotplot</span>(</span>
<span id="cb209-10"><a href="a-first-lasso-attempt.html#cb209-10"></a>    <span class="dt">binaxis =</span> <span class="st">&quot;y&quot;</span>, <span class="dt">stackdir =</span> <span class="st">&quot;center&quot;</span>, <span class="dt">binpositions =</span> <span class="st">&quot;all&quot;</span>,</span>
<span id="cb209-11"><a href="a-first-lasso-attempt.html#cb209-11"></a>    <span class="dt">show.legend =</span> <span class="ot">FALSE</span></span>
<span id="cb209-12"><a href="a-first-lasso-attempt.html#cb209-12"></a>  ) <span class="op">+</span></span>
<span id="cb209-13"><a href="a-first-lasso-attempt.html#cb209-13"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb209-14"><a href="a-first-lasso-attempt.html#cb209-14"></a>    <span class="dt">x =</span> <span class="st">&quot;Degree of n-grams&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;mean RMSE&quot;</span>,</span>
<span id="cb209-15"><a href="a-first-lasso-attempt.html#cb209-15"></a>    <span class="dt">title =</span> <span class="st">&quot;Model performance for different degrees of n-gram tokenization&quot;</span>,</span>
<span id="cb209-16"><a href="a-first-lasso-attempt.html#cb209-16"></a>    <span class="dt">subtitle =</span> <span class="st">&quot;For the same number of tokens, unigrams alone performed best&quot;</span></span>
<span id="cb209-17"><a href="a-first-lasso-attempt.html#cb209-17"></a>  )</span></code></pre></div>
<p><img src="telfer-mba-nlp_files/figure-html/plot_ngrams-1.png" width="672" /></p>
<p>Amusingly, the fastest &amp; simplest approach of using only 1-grams worked best.</p>
</div>
<div id="full-final-regression" class="section level2">
<h2><span class="header-section-number">5.6</span> Full final regression</h2>
<p>After working through each piece of the regression preprocessing and recipe, we’ll now followed <a href="https://smltar.com/mlregression.html#the-full-game-regression">SMLTAR s6.10</a>’s lead and put it all together.</p>
<p>We will:</p>
<ul>
<li>Train on the cross-validation resamples;</li>
<li>Tune <em>both</em> the lasso regularization parameter and the number of tokens used in the model;</li>
<li>Only include unigrams;</li>
<li>Remove the snowball stop words;</li>
<li>And evaluate on the testing set.</li>
</ul>
<p>Here is our final recipe. note that we are using <code>tune()</code> as our <code>max_tokens</code> value. This will let us fit the model to a grid of values and see which one performs best.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="a-first-lasso-attempt.html#cb210-1"></a> final_rec &lt;-<span class="st"> </span><span class="kw">recipe</span>(rating_num <span class="op">~</span><span class="st"> </span>text, <span class="dt">data =</span> yelp_train) <span class="op">%&gt;%</span></span>
<span id="cb210-2"><a href="a-first-lasso-attempt.html#cb210-2"></a><span class="st">  </span><span class="kw">step_tokenize</span>(text) <span class="op">%&gt;%</span></span>
<span id="cb210-3"><a href="a-first-lasso-attempt.html#cb210-3"></a><span class="st">  </span><span class="kw">step_stopwords</span>(text, <span class="dt">stopword_source =</span> <span class="st">&quot;snowball&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb210-4"><a href="a-first-lasso-attempt.html#cb210-4"></a><span class="st">  </span><span class="kw">step_tokenfilter</span>(text, <span class="dt">max_tokens =</span> <span class="kw">tune</span>()) <span class="op">%&gt;%</span></span>
<span id="cb210-5"><a href="a-first-lasso-attempt.html#cb210-5"></a><span class="st">  </span><span class="kw">step_tfidf</span>(text)</span>
<span id="cb210-6"><a href="a-first-lasso-attempt.html#cb210-6"></a></span>
<span id="cb210-7"><a href="a-first-lasso-attempt.html#cb210-7"></a>final_rec</span></code></pre></div>
<pre><code>## Data Recipe
## 
## Inputs:
## 
##       role #variables
##    outcome          1
##  predictor          1
## 
## Operations:
## 
## Tokenization for text
## Stop word removal for text
## Text filtering for text
## Term frequency-inverse document frequency with text</code></pre>
<p>Then we specify our model again:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="a-first-lasso-attempt.html#cb212-1"></a>tune_model &lt;-<span class="st"> </span><span class="kw">linear_reg</span>( <span class="dt">penalty =</span> <span class="kw">tune</span>(), <span class="dt">mixture =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb212-2"><a href="a-first-lasso-attempt.html#cb212-2"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">&quot;regression&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb212-3"><a href="a-first-lasso-attempt.html#cb212-3"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>)</span>
<span id="cb212-4"><a href="a-first-lasso-attempt.html#cb212-4"></a></span>
<span id="cb212-5"><a href="a-first-lasso-attempt.html#cb212-5"></a>tune_model</span></code></pre></div>
<pre><code>## Linear Regression Model Specification (regression)
## 
## Main Arguments:
##   penalty = tune()
##   mixture = 1
## 
## Computational engine: glmnet</code></pre>
<p>Then we set up our workflow:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="a-first-lasso-attempt.html#cb214-1"></a>tune_wf &lt;-<span class="st"> </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span></span>
<span id="cb214-2"><a href="a-first-lasso-attempt.html#cb214-2"></a><span class="st">  </span><span class="kw">add_recipe</span>(final_rec) <span class="op">%&gt;%</span></span>
<span id="cb214-3"><a href="a-first-lasso-attempt.html#cb214-3"></a><span class="st">  </span><span class="kw">add_model</span>(tune_model)</span>
<span id="cb214-4"><a href="a-first-lasso-attempt.html#cb214-4"></a></span>
<span id="cb214-5"><a href="a-first-lasso-attempt.html#cb214-5"></a>tune_wf</span></code></pre></div>
<pre><code>## == Workflow ====================================================================
## Preprocessor: Recipe
## Model: linear_reg()
## 
## -- Preprocessor ----------------------------------------------------------------
## 4 Recipe Steps
## 
## * step_tokenize()
## * step_stopwords()
## * step_tokenfilter()
## * step_tfidf()
## 
## -- Model -----------------------------------------------------------------------
## Linear Regression Model Specification (regression)
## 
## Main Arguments:
##   penalty = tune()
##   mixture = 1
## 
## Computational engine: glmnet</code></pre>
<p>Next we’ll tune the model. To do so, we need to choose the set of parameter values for the penalty and number of tokens we’ll test. We do this by setting up a “grid” of the value combinations using <code>grid_regular()</code>. With 20 steps for the penalty and with 6 steps for the tokens, we’ll have 120 combinations to test in total. <em>This took 2180s on my machine.</em></p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="a-first-lasso-attempt.html#cb216-1"></a>final_grid &lt;-<span class="st"> </span><span class="kw">grid_regular</span>(</span>
<span id="cb216-2"><a href="a-first-lasso-attempt.html#cb216-2"></a>  <span class="kw">penalty</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">4</span>,<span class="dv">0</span>)),</span>
<span id="cb216-3"><a href="a-first-lasso-attempt.html#cb216-3"></a>  <span class="kw">max_tokens</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="fl">1e3</span>, <span class="fl">6e3</span>)),</span>
<span id="cb216-4"><a href="a-first-lasso-attempt.html#cb216-4"></a>  <span class="dt">levels =</span> <span class="kw">c</span>(<span class="dt">penalty =</span> <span class="dv">20</span>, <span class="dt">max_tokens =</span> <span class="dv">6</span>)</span>
<span id="cb216-5"><a href="a-first-lasso-attempt.html#cb216-5"></a>)</span>
<span id="cb216-6"><a href="a-first-lasso-attempt.html#cb216-6"></a></span>
<span id="cb216-7"><a href="a-first-lasso-attempt.html#cb216-7"></a>final_grid <span class="op">%&gt;%</span></span>
<span id="cb216-8"><a href="a-first-lasso-attempt.html#cb216-8"></a><span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 2
##     penalty max_tokens
##       &lt;dbl&gt;      &lt;int&gt;
##  1 0.0001         1000
##  2 0.000162       1000
##  3 0.000264       1000
##  4 0.000428       1000
##  5 0.000695       1000
##  6 0.00113        1000
##  7 0.00183        1000
##  8 0.00298        1000
##  9 0.00483        1000
## 10 0.00785        1000</code></pre>
<p>Next we train our models using the tuning grid:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="a-first-lasso-attempt.html#cb218-1"></a><span class="kw">tic</span>()</span>
<span id="cb218-2"><a href="a-first-lasso-attempt.html#cb218-2"></a>final_rs &lt;-<span class="st"> </span><span class="kw">tune_grid</span>(</span>
<span id="cb218-3"><a href="a-first-lasso-attempt.html#cb218-3"></a>  tune_wf,</span>
<span id="cb218-4"><a href="a-first-lasso-attempt.html#cb218-4"></a>  yelp_folds,</span>
<span id="cb218-5"><a href="a-first-lasso-attempt.html#cb218-5"></a>  <span class="dt">grid =</span> final_grid,</span>
<span id="cb218-6"><a href="a-first-lasso-attempt.html#cb218-6"></a>  <span class="dt">metrics =</span> <span class="kw">metric_set</span>(rmse, mae, mape)</span>
<span id="cb218-7"><a href="a-first-lasso-attempt.html#cb218-7"></a>)</span>
<span id="cb218-8"><a href="a-first-lasso-attempt.html#cb218-8"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>## 2063.39 sec elapsed</code></pre>
<p>Now we can plot each model’s performance for the different numbers of tokens and regularization penalties. We see the familiar dip-shaped graph we expect in lasso regularization but the dips are much more pronounced for larger token numbers, suggesting that regularization is much more important as we use more tokens. Also note that the best performance happens with an intermediate number of tokens: for some reason, model performace gets worse on this dataset if you use more than 3000 tokens.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="a-first-lasso-attempt.html#cb220-1"></a>final_rs <span class="op">%&gt;%</span></span>
<span id="cb220-2"><a href="a-first-lasso-attempt.html#cb220-2"></a><span class="st">  </span><span class="kw">collect_metrics</span>() <span class="op">%&gt;%</span></span>
<span id="cb220-3"><a href="a-first-lasso-attempt.html#cb220-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(penalty, mean, <span class="dt">color =</span> <span class="kw">as.factor</span>(max_tokens))) <span class="op">+</span></span>
<span id="cb220-4"><a href="a-first-lasso-attempt.html#cb220-4"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb220-5"><a href="a-first-lasso-attempt.html#cb220-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">alpha =</span> <span class="fl">0.9</span>) <span class="op">+</span></span>
<span id="cb220-6"><a href="a-first-lasso-attempt.html#cb220-6"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>.metric, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="op">+</span></span>
<span id="cb220-7"><a href="a-first-lasso-attempt.html#cb220-7"></a><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></span>
<span id="cb220-8"><a href="a-first-lasso-attempt.html#cb220-8"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb220-9"><a href="a-first-lasso-attempt.html#cb220-9"></a>    <span class="dt">color =</span> <span class="st">&quot;Number of tokens&quot;</span>,</span>
<span id="cb220-10"><a href="a-first-lasso-attempt.html#cb220-10"></a>    <span class="dt">title =</span> <span class="st">&quot;Lasso model performance across regularization penalties and number of tokens&quot;</span>,</span>
<span id="cb220-11"><a href="a-first-lasso-attempt.html#cb220-11"></a>    <span class="dt">subtitle =</span> <span class="st">&quot;The best model includes a high number of tokens but also significant regularization&quot;</span></span>
<span id="cb220-12"><a href="a-first-lasso-attempt.html#cb220-12"></a>  )</span></code></pre></div>
<p><img src="telfer-mba-nlp_files/figure-html/final_rs_plot-1.png" width="672" /></p>
<p>We can extract the lowest MAE value from our models:</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="a-first-lasso-attempt.html#cb221-1"></a>lowest_mae &lt;-<span class="st"> </span>final_rs <span class="op">%&gt;%</span></span>
<span id="cb221-2"><a href="a-first-lasso-attempt.html#cb221-2"></a><span class="st">  </span><span class="kw">select_best</span>(<span class="st">&quot;mae&quot;</span>)</span>
<span id="cb221-3"><a href="a-first-lasso-attempt.html#cb221-3"></a></span>
<span id="cb221-4"><a href="a-first-lasso-attempt.html#cb221-4"></a>lowest_mae</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   penalty max_tokens .config        
##     &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;          
## 1  0.0127       3000 Recipe3_Model11</code></pre>
<p>And then we can use this value to set a final workflow:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="a-first-lasso-attempt.html#cb223-1"></a>final_wf &lt;-<span class="st"> </span><span class="kw">finalize_workflow</span>(</span>
<span id="cb223-2"><a href="a-first-lasso-attempt.html#cb223-2"></a>  tune_wf,</span>
<span id="cb223-3"><a href="a-first-lasso-attempt.html#cb223-3"></a>  lowest_mae</span>
<span id="cb223-4"><a href="a-first-lasso-attempt.html#cb223-4"></a>)</span>
<span id="cb223-5"><a href="a-first-lasso-attempt.html#cb223-5"></a></span>
<span id="cb223-6"><a href="a-first-lasso-attempt.html#cb223-6"></a>final_wf</span></code></pre></div>
<pre><code>## == Workflow ====================================================================
## Preprocessor: Recipe
## Model: linear_reg()
## 
## -- Preprocessor ----------------------------------------------------------------
## 4 Recipe Steps
## 
## * step_tokenize()
## * step_stopwords()
## * step_tokenfilter()
## * step_tfidf()
## 
## -- Model -----------------------------------------------------------------------
## Linear Regression Model Specification (regression)
## 
## Main Arguments:
##   penalty = 0.0127427498570313
##   mixture = 1
## 
## Computational engine: glmnet</code></pre>
<p>Which we can then use to do one last final fit and view its metrics:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="a-first-lasso-attempt.html#cb225-1"></a><span class="kw">tic</span>()</span>
<span id="cb225-2"><a href="a-first-lasso-attempt.html#cb225-2"></a>final_fitted &lt;-<span class="st"> </span><span class="kw">last_fit</span>(final_wf, yelp_split)</span>
<span id="cb225-3"><a href="a-first-lasso-attempt.html#cb225-3"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>## 21.69 sec elapsed</code></pre>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="a-first-lasso-attempt.html#cb227-1"></a><span class="kw">collect_metrics</span>(final_fitted)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 rmse    standard       0.845
## 2 rsq     standard       0.406</code></pre>
<p>This plot uses the <strong>vip</strong> package to extract the most important positive and negative terms, so we can see what our lasso regression is picking up on. Overall, the terms look kind of random. I would have expected words like “delicious,” “great,” and “awesome” to have been strongly correlated with positive reviews, and so I’m not what to make of the fact that “talked,” “sounded,” and “dipped” are the top three most-associated-with-positive-review words. The negative words look a bit better–“unfortunate” is #1 and “worst” is #3–but there are still some head-scratchers, like “2.50” and “striploin.” (Although if you spend $2.50 on a striploin you have no one to blame but yourself.)</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="a-first-lasso-attempt.html#cb229-1"></a><span class="kw">library</span>(vip)</span>
<span id="cb229-2"><a href="a-first-lasso-attempt.html#cb229-2"></a></span>
<span id="cb229-3"><a href="a-first-lasso-attempt.html#cb229-3"></a>scotus_imp &lt;-<span class="st"> </span><span class="kw">pull_workflow_fit</span>(final_fitted<span class="op">$</span>.workflow[[<span class="dv">1</span>]]) <span class="op">%&gt;%</span></span>
<span id="cb229-4"><a href="a-first-lasso-attempt.html#cb229-4"></a><span class="st">  </span><span class="kw">vi</span>(<span class="dt">lambda =</span> lowest_mae<span class="op">$</span>penalty)</span>
<span id="cb229-5"><a href="a-first-lasso-attempt.html#cb229-5"></a></span>
<span id="cb229-6"><a href="a-first-lasso-attempt.html#cb229-6"></a>scotus_imp <span class="op">%&gt;%</span></span>
<span id="cb229-7"><a href="a-first-lasso-attempt.html#cb229-7"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb229-8"><a href="a-first-lasso-attempt.html#cb229-8"></a>    <span class="dt">Sign =</span> <span class="kw">case_when</span>(</span>
<span id="cb229-9"><a href="a-first-lasso-attempt.html#cb229-9"></a>      Sign <span class="op">==</span><span class="st"> &quot;POS&quot;</span> <span class="op">~</span><span class="st"> &quot;Better&quot;</span>,</span>
<span id="cb229-10"><a href="a-first-lasso-attempt.html#cb229-10"></a>      Sign <span class="op">==</span><span class="st"> &quot;NEG&quot;</span> <span class="op">~</span><span class="st"> &quot;Worse&quot;</span>,</span>
<span id="cb229-11"><a href="a-first-lasso-attempt.html#cb229-11"></a>    ),</span>
<span id="cb229-12"><a href="a-first-lasso-attempt.html#cb229-12"></a>    <span class="dt">Importance =</span> <span class="kw">abs</span>(Importance),</span>
<span id="cb229-13"><a href="a-first-lasso-attempt.html#cb229-13"></a>    <span class="dt">Variable =</span> <span class="kw">str_remove_all</span>(Variable, <span class="st">&quot;tfidf_text_&quot;</span>)</span>
<span id="cb229-14"><a href="a-first-lasso-attempt.html#cb229-14"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb229-15"><a href="a-first-lasso-attempt.html#cb229-15"></a><span class="st">  </span><span class="kw">group_by</span>(Sign) <span class="op">%&gt;%</span></span>
<span id="cb229-16"><a href="a-first-lasso-attempt.html#cb229-16"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">20</span>, Importance) <span class="op">%&gt;%</span></span>
<span id="cb229-17"><a href="a-first-lasso-attempt.html#cb229-17"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb229-18"><a href="a-first-lasso-attempt.html#cb229-18"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(</span>
<span id="cb229-19"><a href="a-first-lasso-attempt.html#cb229-19"></a>    <span class="dt">x =</span> Importance,</span>
<span id="cb229-20"><a href="a-first-lasso-attempt.html#cb229-20"></a>    <span class="dt">y =</span> <span class="kw">fct_reorder</span>(Variable, Importance),</span>
<span id="cb229-21"><a href="a-first-lasso-attempt.html#cb229-21"></a>    <span class="dt">fill =</span> Sign</span>
<span id="cb229-22"><a href="a-first-lasso-attempt.html#cb229-22"></a>  )) <span class="op">+</span></span>
<span id="cb229-23"><a href="a-first-lasso-attempt.html#cb229-23"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb229-24"><a href="a-first-lasso-attempt.html#cb229-24"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb229-25"><a href="a-first-lasso-attempt.html#cb229-25"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Sign, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></span>
<span id="cb229-26"><a href="a-first-lasso-attempt.html#cb229-26"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb229-27"><a href="a-first-lasso-attempt.html#cb229-27"></a>    <span class="dt">y =</span> <span class="ot">NULL</span>,</span>
<span id="cb229-28"><a href="a-first-lasso-attempt.html#cb229-28"></a>    <span class="dt">title =</span> <span class="st">&quot;Variable importance for predicting Yelp review star ratings&quot;</span></span>
<span id="cb229-29"><a href="a-first-lasso-attempt.html#cb229-29"></a>  )</span></code></pre></div>
<p><img src="telfer-mba-nlp_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<p>Finally, we can again plot our final lasso model’s predicted ratings vs. the actual ratings to see how they compare. There is a definite improvement from the first model, but the results ultimately still aren’t workable. The range of predictions is still much too wide, and true lower reviews are still predicted as much too high.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="a-first-lasso-attempt.html#cb230-1"></a>final_fitted <span class="op">%&gt;%</span></span>
<span id="cb230-2"><a href="a-first-lasso-attempt.html#cb230-2"></a><span class="st">  </span><span class="kw">collect_predictions</span>() <span class="op">%&gt;%</span></span>
<span id="cb230-3"><a href="a-first-lasso-attempt.html#cb230-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(rating_num, .pred)) <span class="op">+</span></span>
<span id="cb230-4"><a href="a-first-lasso-attempt.html#cb230-4"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;gray80&quot;</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span></span>
<span id="cb230-5"><a href="a-first-lasso-attempt.html#cb230-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb230-6"><a href="a-first-lasso-attempt.html#cb230-6"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb230-7"><a href="a-first-lasso-attempt.html#cb230-7"></a>    <span class="dt">x =</span> <span class="st">&quot;Truth&quot;</span>,</span>
<span id="cb230-8"><a href="a-first-lasso-attempt.html#cb230-8"></a>    <span class="dt">y =</span> <span class="st">&quot;Predicted year&quot;</span>,</span>
<span id="cb230-9"><a href="a-first-lasso-attempt.html#cb230-9"></a>    <span class="dt">title =</span> <span class="st">&quot;Predicted and true ratings for Yelp Reviews&quot;</span></span>
<span id="cb230-10"><a href="a-first-lasso-attempt.html#cb230-10"></a>  )</span></code></pre></div>
<p><img src="telfer-mba-nlp_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
</div>
<div id="conclusion" class="section level2">
<h2><span class="header-section-number">5.7</span> Conclusion</h2>
<p>In this section I followed <span class="citation">Silge and Hvitfeldt (<a href="#ref-silge_supervised_2020" role="doc-biblioref">2020</a>)</span> ‘s recipe and tried to predict a Yelp review’s star rating from its text using a lasso regression model. I varied a number of parameters, including the lasso regularization penalty, the number of tokens used in the model, the number and type of n-grams, and the lengths of the reviews. Although the models’ accuracy did improve as I refined them, none of the models were especially effective and none come close to being workable in practice.</p>
<p>There are at least two possibilities:</p>
<ul>
<li><strong>The problem might be with the dataset.</strong> The dataset may be too small, or too imbalanced (there are far fewer negative reviews than positive reviews), or have some other deficiency that makes it unsuitable for lasso regression.</li>
<li><strong>Linear regression may not be the right tool for the job.</strong> Given the relatively small number of discrete rating categories, this might be better modeled as a classification problem.</li>
</ul>
<p>We will look at both of these possibilities in subsequent entries.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-silge_supervised_2020">
<p>Silge, Julia, and Emil Hvitfeldt. 2020. <em>Supervised Machine Learning for Text Analysis in R</em>. <a href="https://smltar.com/">https://smltar.com/</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-summary-eda-initial-model-attempts.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="yelp-classification-and-sentiment-test.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/04-first-lasso.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["telfer-mba-nlp.pdf", "telfer-mba-nlp.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
